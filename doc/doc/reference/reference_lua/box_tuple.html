

<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Submodule box.tuple &mdash; Tarantool Dev Docs  documentation</title>
  

  
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../../_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../index.html" class="icon icon-home" alt="Documentation Home"> Tarantool Dev Docs
          

          
            
            <img src="../../../../_static/logo_white_text.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../dev_guide/index.html">Contributor’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/index.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../internals/source/index.html">Tarantool internals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../internals/source/index.html#indices-and-tables">Indices and tables</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">Tarantool Dev Docs</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Submodule <cite>box.tuple</cite></li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../../_sources/doc/doc/reference/reference_lua/box_tuple.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="module-box.tuple">
<span id="submodule-box-tuple"></span><span id="box-tuple"></span><h1>Submodule <cite>box.tuple</cite><a class="headerlink" href="#module-box.tuple" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">box.tuple</span></code> submodule provides read-only access for the <code class="docutils literal notranslate"><span class="pre">tuple</span></code>
userdata type. It allows, for a single <a class="reference internal" href="../../book/box/data_model.html#index-box-tuple"><span class="std std-ref">tuple</span></a>: selective
retrieval of the field contents, retrieval of information about size, iteration
over all the fields, and conversion to a <a class="reference external" href="https://www.lua.org/pil/2.5.html">Lua table</a>.</p>
</div>
<div class="section" id="index">
<h2>Index<a class="headerlink" href="#index" title="Permalink to this headline">¶</a></h2>
<p>Below is a list of all <code class="docutils literal notranslate"><span class="pre">box.tuple</span></code> functions.</p>
<div class="table docutils container">
<table border="1" class="left-align-column-1 left-align-column-2 docutils">
<colgroup>
<col width="54%" />
<col width="46%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Use</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><a class="reference internal" href="#box-tuple-new"><span class="std std-ref">box.tuple.new()</span></a></td>
<td>Create a tuple</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#box-tuple-count-fields"><span class="std std-ref">#tuple_object</span></a></td>
<td>Count tuple fields</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#box-tuple-bsize"><span class="std std-ref">tuple_object:bsize()</span></a></td>
<td>Get count of bytes in a tuple</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#box-tuple-field-number"><span class="std std-ref">tuple_object[field-number]</span></a></td>
<td>Get a tuple’s field by
specifying a number</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#box-tuple-field-name"><span class="std std-ref">tuple_object[field-name]</span></a></td>
<td>Get a tuple’s field by
specifying a name</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#box-tuple-field-path"><span class="std std-ref">tuple_object[field-path]</span></a></td>
<td>Get a tuple’s fields or parts
by specifying a path</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#box-tuple-find"><span class="std std-ref">tuple_object:find()</span></a></td>
<td>Get the number of the first
field matching the search value</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#box-tuple-find"><span class="std std-ref">tuple_object:findall()</span></a></td>
<td>Get the number of all fields
matching the search value</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#box-tuple-next"><span class="std std-ref">tuple_object:next()</span></a></td>
<td>Get the next field value from
tuple</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#box-tuple-pairs"><span class="std std-ref">tuple_object:ipairs()</span></a></td>
<td>Prepare for iterating</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#box-tuple-pairs"><span class="std std-ref">tuple_object:pairs()</span></a></td>
<td>Prepare for iterating</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#box-tuple-totable"><span class="std std-ref">tuple_object:totable()</span></a></td>
<td>Get a tuple’s fields as a table</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#box-tuple-tomap"><span class="std std-ref">tuple_object:tomap()</span></a></td>
<td>Get a tuple’s fields as a table
along with key:value pairs</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#box-tuple-transform"><span class="std std-ref">tuple_object:transform()</span></a></td>
<td>Remove (and replace) a tuple’s
fields</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#box-tuple-unpack"><span class="std std-ref">tuple_object:unpack()</span></a></td>
<td>Get a tuple’s fields</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#box-tuple-update"><span class="std std-ref">tuple_object:update()</span></a></td>
<td>Update a tuple</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#box-tuple-upsert"><span class="std std-ref">tuple_object:upsert()</span></a></td>
<td>Update a tuple ignoring errors</td>
</tr>
</tbody>
</table>
</div>
<span class="target" id="box-tuple-new"></span><dl class="function">
<dt id="box.tuple.new">
<code class="descclassname">box.tuple.</code><code class="descname">new</code><span class="sig-paren">(</span><em>value</em><span class="sig-paren">)</span><a class="headerlink" href="#box.tuple.new" title="Permalink to this definition">¶</a></dt>
<dd><p>Construct a new tuple from either a scalar or a Lua table. Alternatively,
one can get new tuples from tarantool’s <a class="reference internal" href="box_space_index.html#box-space-select"><span class="std std-ref">select</span></a>
or <a class="reference internal" href="box_space_index.html#box-space-insert"><span class="std std-ref">insert</span></a> or <a class="reference internal" href="box_space_index.html#box-space-replace"><span class="std std-ref">replace</span></a>
or <a class="reference internal" href="box_space_index.html#box-space-update"><span class="std std-ref">update</span></a> requests,
which can be regarded as statements that do
<code class="docutils literal notranslate"><span class="pre">new()</span></code> implicitly.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>value</strong> (<em>lua-value</em>) – the value that will become the tuple contents.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">a new tuple</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">tuple</td>
</tr>
</tbody>
</table>
<p>In the following example, <code class="docutils literal notranslate"><span class="pre">x</span></code> will be a new table object containing one
tuple and <code class="docutils literal notranslate"><span class="pre">t</span></code> will be a new tuple object. Saying <code class="docutils literal notranslate"><span class="pre">t</span></code> returns the
entire tuple <code class="docutils literal notranslate"><span class="pre">t</span></code>.</p>
<p><strong>Example:</strong></p>
<div class="highlight-tarantoolsession notranslate"><div class="highlight"><pre><span></span>tarantool&gt; x = box.space.tester:insert{
         &gt;   33,
         &gt;   tonumber(&#39;1&#39;),
         &gt;   tonumber64(&#39;2&#39;)
         &gt; }:totable()
---
...
tarantool&gt; t = box.tuple.new{&#39;abc&#39;, &#39;def&#39;, &#39;ghi&#39;, &#39;abc&#39;}
---
...
tarantool&gt; t
---
- [&#39;abc&#39;, &#39;def&#39;, &#39;ghi&#39;, &#39;abc&#39;]
...
</pre></div>
</div>
</dd></dl>

<dl class="class">
<dt id="box.tuple.tuple_object">
<em class="property">class </em><code class="descclassname">box.tuple.</code><code class="descname">tuple_object</code><a class="headerlink" href="#box.tuple.tuple_object" title="Permalink to this definition">¶</a></dt>
<dd><span class="target" id="box-tuple-bsize"></span><dl class="method">
<dt id="box.tuple.tuple_object.bsize">
<code class="descname">bsize</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#box.tuple.tuple_object.bsize" title="Permalink to this definition">¶</a></dt>
<dd><p>If <code class="docutils literal notranslate"><span class="pre">t</span></code> is a tuple instance, <code class="docutils literal notranslate"><span class="pre">t:bsize()</span></code> will return the number of
bytes in the tuple. With both the memtx storage engine and the vinyl
storage engine the default maximum is one megabyte
(<a class="reference internal" href="../configuration/index.html#cfg-storage-memtx-max-tuple-size"><span class="std std-ref">memtx_max_tuple_size</span></a> or
<a class="reference internal" href="../configuration/index.html#cfg-storage-vinyl-max-tuple-size"><span class="std std-ref">vinyl_max_tuple_size</span></a>). Every
field has one or more “length” bytes preceding the actual contents, so
<code class="docutils literal notranslate"><span class="pre">bsize()</span></code> returns a value which is slightly greater than the sum of
the lengths of the contents.</p>
<p>The value does not include the size of “struct tuple” (for the current
size of this structure look in the
<a class="reference external" href="https://github.com/tarantool/tarantool/blob/1.10/src/box/tuple.h">tuple.h</a>
file in Tarantool’s source code).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">number of bytes</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">number</td>
</tr>
</tbody>
</table>
<p>In the following example, a tuple named <code class="docutils literal notranslate"><span class="pre">t</span></code> is created which has
three fields, and for each field it takes one byte to store the length
and three bytes to store the contents, and then there is one more byte
to store a count of the number of fields, so <code class="docutils literal notranslate"><span class="pre">bsize()</span></code> returns
<code class="docutils literal notranslate"><span class="pre">3*(1+3)+1</span></code>. This is the same as the size of the string that
<span class="xref std std-ref">msgpack.encode({‘aaa’,’bbb’,’ccc’})</span> would return.</p>
<div class="highlight-tarantoolsession notranslate"><div class="highlight"><pre><span></span>tarantool&gt; t = box.tuple.new{&#39;aaa&#39;, &#39;bbb&#39;, &#39;ccc&#39;}
---
...
tarantool&gt; t:bsize()
---
- 13
...
</pre></div>
</div>
</dd></dl>

<span class="target" id="box-tuple-find"></span><dl class="method">
<dt id="box.tuple.tuple_object.find">
<code class="descname">find</code><span class="sig-paren">(</span><span class="optional">[</span><em>field-number</em>, <span class="optional">]</span><em>search-value</em><span class="sig-paren">)</span><a class="headerlink" href="#box.tuple.tuple_object.find" title="Permalink to this definition">¶</a></dt>
<dt id="box.tuple.tuple_object.findall">
<code class="descname">findall</code><span class="sig-paren">(</span><span class="optional">[</span><em>field-number</em>, <span class="optional">]</span><em>search-value</em><span class="sig-paren">)</span><a class="headerlink" href="#box.tuple.tuple_object.findall" title="Permalink to this definition">¶</a></dt>
<dd><p>If <code class="docutils literal notranslate"><span class="pre">t</span></code> is a tuple instance, <code class="docutils literal notranslate"><span class="pre">t:find(search-value)</span></code> will return the
number of the first field in <code class="docutils literal notranslate"><span class="pre">t</span></code> that matches the search value,
and <code class="docutils literal notranslate"><span class="pre">t:findall(search-value</span> <span class="pre">[,</span> <span class="pre">search-value</span> <span class="pre">...])</span></code> will return numbers
of all fields in <code class="docutils literal notranslate"><span class="pre">t</span></code> that match the search value. Optionally one can
put a numeric argument <code class="docutils literal notranslate"><span class="pre">field-number</span></code> before the search-value to
indicate “start searching at field number <code class="docutils literal notranslate"><span class="pre">field-number</span></code>.”</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">the number of the field in the tuple.</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">number</td>
</tr>
</tbody>
</table>
<p>In the following example, a tuple named <code class="docutils literal notranslate"><span class="pre">t</span></code> is created and then: the
number of the first field in <code class="docutils literal notranslate"><span class="pre">t</span></code> which matches ‘a’ is returned, then
the numbers of all the fields in <code class="docutils literal notranslate"><span class="pre">t</span></code> which match ‘a’ are returned,
then the numbers of all the fields in t which match ‘a’ and are at or
after the second field are returned.</p>
<div class="highlight-tarantoolsession notranslate"><div class="highlight"><pre><span></span>tarantool&gt; t = box.tuple.new{&#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;a&#39;}
---
...
tarantool&gt; t:find(&#39;a&#39;)
---
- 1
...
tarantool&gt; t:findall(&#39;a&#39;)
---
- 1
- 4
...
tarantool&gt; t:findall(2, &#39;a&#39;)
---
- 4
...
</pre></div>
</div>
</dd></dl>

<span class="target" id="box-tuple-next"></span><dl class="method">
<dt id="box.tuple.tuple_object.next">
<code class="descname">next</code><span class="sig-paren">(</span><em>tuple</em><span class="optional">[</span>, <em>pos</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#box.tuple.tuple_object.next" title="Permalink to this definition">¶</a></dt>
<dd><p>An analogue of the Lua <code class="docutils literal notranslate"><span class="pre">next()</span></code> function, but for a tuple object.
When called without arguments, <code class="docutils literal notranslate"><span class="pre">tuple:next()</span></code> returns the first field
from a tuple. Otherwise, it returns the field next to the indicated position.</p>
<p>However <code class="docutils literal notranslate"><span class="pre">tuple:next()</span></code> is not really efficient, and it is better
to use <a class="reference internal" href="#box-tuple-pairs"><span class="std std-ref">tuple:pairs()/ipairs()</span></a>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">field number and field value</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">number and field type</td>
</tr>
</tbody>
</table>
<div class="highlight-tarantoolsession notranslate"><div class="highlight"><pre><span></span>tarantool&gt; tuple = box.tuple.new({5, 4, 3, 2, 0})
---
...

tarantool&gt; tuple:next()
---
- 1
- 5
...

tarantool&gt; tuple:next(1)
---
- 2
- 4
...

tarantool&gt; ctx, field = tuple:next()
---
...

tarantool&gt; while field do
         &gt; print(field)
         &gt; ctx, field = tuple:next(ctx)
         &gt; end
5
4
3
2
0
---
...
</pre></div>
</div>
</dd></dl>

<span class="target" id="box-tuple-pairs"></span><dl class="method">
<dt id="box.tuple.tuple_object.pairs">
<code class="descname">pairs</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#box.tuple.tuple_object.pairs" title="Permalink to this definition">¶</a></dt>
<dt id="box.tuple.tuple_object.ipairs">
<code class="descname">ipairs</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#box.tuple.tuple_object.ipairs" title="Permalink to this definition">¶</a></dt>
<dd><p>In Lua, <a class="reference external" href="https://www.lua.org/pil/7.3.html">lua-table-value:pairs()</a> is a method which returns:
<code class="docutils literal notranslate"><span class="pre">function</span></code>, <code class="docutils literal notranslate"><span class="pre">lua-table-value</span></code>, <code class="docutils literal notranslate"><span class="pre">nil</span></code>. Tarantool has extended
this so that <code class="docutils literal notranslate"><span class="pre">tuple-value:pairs()</span></code> returns: <code class="docutils literal notranslate"><span class="pre">function</span></code>,
<code class="docutils literal notranslate"><span class="pre">tuple-value</span></code>, <code class="docutils literal notranslate"><span class="pre">nil</span></code>. It is useful for Lua iterators, because Lua
iterators traverse a value’s components until an end marker is reached.</p>
<p><code class="docutils literal notranslate"><span class="pre">tuple_object:ipairs()</span></code> is the same as <code class="docutils literal notranslate"><span class="pre">pairs()</span></code>, because tuple
fields are always integers.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">function, tuple-value, nil</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">function, lua-value, nil</td>
</tr>
</tbody>
</table>
<p>In the following example, a tuple named <code class="docutils literal notranslate"><span class="pre">t</span></code> is created and then all
its fields are selected using a Lua for-end loop.</p>
<div class="highlight-tarantoolsession notranslate"><div class="highlight"><pre><span></span>tarantool&gt; t = box.tuple.new{&#39;Fld#1&#39;, &#39;Fld#2&#39;, &#39;Fld#3&#39;, &#39;Fld#4&#39;, &#39;Fld#5&#39;}
---
...
tarantool&gt; tmp = &#39;&#39;
---
...
tarantool&gt; for k, v in t:pairs() do
         &gt;   tmp = tmp .. v
         &gt; end
---
...
tarantool&gt; tmp
---
- Fld#1Fld#2Fld#3Fld#4Fld#5
...
</pre></div>
</div>
</dd></dl>

<span class="target" id="box-tuple-totable"></span><dl class="method">
<dt id="box.tuple.tuple_object.totable">
<code class="descname">totable</code><span class="sig-paren">(</span><span class="optional">[</span><em>start-field-number</em><span class="optional">[</span>, <em>end-field-number</em><span class="optional">]</span><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#box.tuple.tuple_object.totable" title="Permalink to this definition">¶</a></dt>
<dd><p>If <code class="docutils literal notranslate"><span class="pre">t</span></code> is a tuple instance, <code class="docutils literal notranslate"><span class="pre">t:totable()</span></code> will return all fields,
<code class="docutils literal notranslate"><span class="pre">t:totable(1)</span></code> will return all fields starting with field number 1,
<code class="docutils literal notranslate"><span class="pre">t:totable(1,5)</span></code> will return all fields between field number 1 and field number 5.</p>
<p>It is preferable to use <code class="docutils literal notranslate"><span class="pre">t:totable()</span></code> rather than <code class="docutils literal notranslate"><span class="pre">t:unpack()</span></code>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">field(s) from the tuple</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">lua-table</td>
</tr>
</tbody>
</table>
<p>In the following example, a tuple named <code class="docutils literal notranslate"><span class="pre">t</span></code> is created, then all
its fields are selected, then the result is returned.</p>
<div class="highlight-tarantoolsession notranslate"><div class="highlight"><pre><span></span>tarantool&gt; t = box.tuple.new{&#39;Fld#1&#39;, &#39;Fld#2&#39;, &#39;Fld#3&#39;, &#39;Fld#4&#39;, &#39;Fld#5&#39;}
---
...
tarantool&gt; t:totable()
---
- [&#39;Fld#1&#39;, &#39;Fld#2&#39;, &#39;Fld#3&#39;, &#39;Fld#4&#39;, &#39;Fld#5&#39;]
...
</pre></div>
</div>
</dd></dl>

<span class="target" id="box-tuple-tomap"></span><dl class="method">
<dt id="box.tuple.tuple_object.tomap">
<code class="descname">tomap</code><span class="sig-paren">(</span><span class="optional">[</span><em>options</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#box.tuple.tuple_object.tomap" title="Permalink to this definition">¶</a></dt>
<dd><p>A <a class="reference external" href="https://www.lua.org/pil/2.5.html">Lua table</a> can have indexed values,
also called key:value pairs.
For example, here:</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="p">{};</span> <span class="n">a</span><span class="p">[</span><span class="s1">&#39;field1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span> <span class="n">a</span><span class="p">[</span><span class="s1">&#39;field2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">20</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">a</span></code> is a table with “field1: 10” and “field2: 20”.</p>
<p>The <a class="reference internal" href="#box-tuple-totable"><span class="std std-ref">tuple_object:totable()</span></a>
function only returns a table containing the values.
But the <code class="docutils literal notranslate"><span class="pre">tuple_object:tomap()</span></code> function returns a table containing
not only the values, but also the key:value pairs.</p>
<p>This only works if the tuple comes from a space that has
been formatted with a <a class="reference internal" href="box_space_index.html#box-space-format"><span class="std std-ref">format clause</span></a>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>options</strong> (<em>table</em>) – <p>the only possible option is <code class="docutils literal notranslate"><span class="pre">names_only</span></code>.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">names_only</span></code> is false or omitted (default),
then all the fields will appear twice,
first with numeric headings and
second with name headings.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">names_only</span></code> is true, then all the
fields will appear only once, with
name headings.</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">field-number:value pair(s) and key:value pair(s) from the tuple</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">lua-table</td>
</tr>
</tbody>
</table>
<p>In the following example, a tuple named <code class="docutils literal notranslate"><span class="pre">t1</span></code> is returned
from a space that has been formatted, then tables named <code class="docutils literal notranslate"><span class="pre">t1map1</span></code>
and <code class="docutils literal notranslate"><span class="pre">t1map2</span></code> are produced from <code class="docutils literal notranslate"><span class="pre">t1</span></code>.</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">format</span> <span class="o">=</span> <span class="p">{{</span><span class="s1">&#39;field1&#39;</span><span class="p">,</span> <span class="s1">&#39;unsigned&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;field2&#39;</span><span class="p">,</span> <span class="s1">&#39;unsigned&#39;</span><span class="p">}}</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">box</span><span class="p">.</span><span class="n">schema</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="p">{</span><span class="n">format</span> <span class="o">=</span> <span class="n">format</span><span class="p">})</span>
<span class="n">s</span><span class="p">:</span><span class="n">create_index</span><span class="p">(</span><span class="s1">&#39;pk&#39;</span><span class="p">,{</span><span class="n">parts</span><span class="o">=</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;unsigned&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;unsigned&#39;</span><span class="p">}})</span>
<span class="n">t1</span> <span class="o">=</span> <span class="n">s</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">}</span>
<span class="n">t1map</span> <span class="o">=</span> <span class="n">t1</span><span class="p">:</span><span class="n">tomap</span><span class="p">()</span>
<span class="n">t1map_names_only</span> <span class="o">=</span> <span class="n">t1</span><span class="p">:</span><span class="n">tomap</span><span class="p">({</span><span class="n">names_only</span><span class="o">=</span><span class="kc">true</span><span class="p">})</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">t1map</span></code> will contain “1: 10”, “2: 20”, “field1: 10”, “field2: 20”.</p>
<p><code class="docutils literal notranslate"><span class="pre">t1map_names_only</span></code> will contain “field1: 10”, “field2: 20”.</p>
</dd></dl>

<span class="target" id="box-tuple-transform"></span><dl class="method">
<dt id="box.tuple.tuple_object.transform">
<code class="descname">transform</code><span class="sig-paren">(</span><em>start-field-number</em>, <em>fields-to-remove</em><span class="optional">[</span>, <em>field-value</em>, <em>...</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#box.tuple.tuple_object.transform" title="Permalink to this definition">¶</a></dt>
<dd><p>If <code class="docutils literal notranslate"><span class="pre">t</span></code> is a tuple instance, <code class="samp docutils literal notranslate"><span class="pre">t:transform(</span><em><span class="pre">start-field-number</span></em><span class="pre">,</span><em><span class="pre">fields-to-remove</span></em><span class="pre">)</span></code>
will return a tuple where, starting from field <code class="docutils literal notranslate"><span class="pre">start-field-number</span></code>,
a number of fields (<code class="docutils literal notranslate"><span class="pre">fields-to-remove</span></code>) are removed. Optionally one
can add more arguments after <code class="docutils literal notranslate"><span class="pre">fields-to-remove</span></code> to indicate new
values that will replace what was removed.</p>
<p>If the original tuple comes from a space that has been formatted with a
<a class="reference internal" href="box_space_index.html#box-space-format"><span class="std std-ref">format clause</span></a>, the formatting will not be
preserved for the result tuple.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>start-field-number</strong> (<em>integer</em>) – base 1, may be negative</li>
<li><strong>fields-to-remove</strong> (<em>integer</em>) – </li>
<li><strong>field-value</strong><strong>(</strong><strong>s</strong><strong>)</strong> (<em>lua-value</em>) – </li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">tuple</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">tuple</p>
</td>
</tr>
</tbody>
</table>
<p>In the following example, a tuple named <code class="docutils literal notranslate"><span class="pre">t</span></code> is created and then,
starting from the second field, two fields are removed but one new
one is added, then the result is returned.</p>
<div class="highlight-tarantoolsession notranslate"><div class="highlight"><pre><span></span>tarantool&gt; t = box.tuple.new{&#39;Fld#1&#39;, &#39;Fld#2&#39;, &#39;Fld#3&#39;, &#39;Fld#4&#39;, &#39;Fld#5&#39;}
---
...
tarantool&gt; t:transform(2, 2, &#39;x&#39;)
---
- [&#39;Fld#1&#39;, &#39;x&#39;, &#39;Fld#4&#39;, &#39;Fld#5&#39;]
...
</pre></div>
</div>
</dd></dl>

<span class="target" id="box-tuple-unpack"></span><dl class="method">
<dt id="box.tuple.tuple_object.unpack">
<code class="descname">unpack</code><span class="sig-paren">(</span><span class="optional">[</span><em>start-field-number</em><span class="optional">[</span>, <em>end-field-number</em><span class="optional">]</span><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#box.tuple.tuple_object.unpack" title="Permalink to this definition">¶</a></dt>
<dd><p>If <code class="docutils literal notranslate"><span class="pre">t</span></code> is a tuple instance, <code class="docutils literal notranslate"><span class="pre">t:unpack()</span></code> will return all fields,
<code class="docutils literal notranslate"><span class="pre">t:unpack(1)</span></code> will return all fields starting with field number 1,
<code class="docutils literal notranslate"><span class="pre">t:unpack(1,5)</span></code> will return all fields between field number 1 and field number 5.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">field(s) from the tuple.</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">lua-value(s)</td>
</tr>
</tbody>
</table>
<p>In the following example, a tuple named <code class="docutils literal notranslate"><span class="pre">t</span></code> is created and then all
its fields are selected, then the result is returned.</p>
<div class="highlight-tarantoolsession notranslate"><div class="highlight"><pre><span></span>tarantool&gt; t = box.tuple.new{&#39;Fld#1&#39;, &#39;Fld#2&#39;, &#39;Fld#3&#39;, &#39;Fld#4&#39;, &#39;Fld#5&#39;}
---
...
tarantool&gt; t:unpack()
---
- Fld#1
- Fld#2
- Fld#3
- Fld#4
- Fld#5
...
</pre></div>
</div>
</dd></dl>

<span class="target" id="box-tuple-update"></span><dl class="method">
<dt id="box.tuple.tuple_object.update">
<code class="descname">update</code><span class="sig-paren">(</span><em>{{operator</em>, <em>field_no</em>, <em>value}</em>, <em>...}</em><span class="sig-paren">)</span><a class="headerlink" href="#box.tuple.tuple_object.update" title="Permalink to this definition">¶</a></dt>
<dd><p>Update a tuple.</p>
<p>This function updates a tuple which is not in a space. Compare the function
<a href="#id2"><span class="problematic" id="id3">:extsamp:`box.space.{*{space-name}*}:update({*{key}*}, {{{*{format}*}, {*{field_no}*}, {*{value}*}}, ...})`</span></a>
which updates a tuple in a space.</p>
<p>For details: see the description for <code class="docutils literal notranslate"><span class="pre">operator</span></code>, <code class="docutils literal notranslate"><span class="pre">field_no</span></code>, and
<code class="docutils literal notranslate"><span class="pre">value</span></code> in the section <a class="reference internal" href="box_space_index.html#box-space-update"><span class="std std-ref">box.space.space-name:update{key, format,
{field_number, value}…)</span></a>.</p>
<p>If the original tuple comes from a space that has been formatted with a
<a class="reference internal" href="box_space_index.html#box-space-format"><span class="std std-ref">format clause</span></a>, the formatting will be
preserved for the result tuple.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>operator</strong> (<em>string</em>) – operation type represented in string (e.g.
‘<code class="docutils literal notranslate"><span class="pre">=</span></code>’ for ‘assign new value’)</li>
<li><strong>field_no</strong> (<em>number</em>) – what field the operation will apply to. The
field number can be negative, meaning the
position from the end of tuple.
(#tuple + negative field number + 1)</li>
<li><strong>value</strong> (<em>lua_value</em>) – what value will be applied</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">new tuple</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">tuple</p>
</td>
</tr>
</tbody>
</table>
<p>In the following example, a tuple named <code class="docutils literal notranslate"><span class="pre">t</span></code> is created and then its
second field is updated to equal ‘B’.</p>
<div class="highlight-tarantoolsession notranslate"><div class="highlight"><pre><span></span>tarantool&gt; t = box.tuple.new{&#39;Fld#1&#39;, &#39;Fld#2&#39;, &#39;Fld#3&#39;, &#39;Fld#4&#39;, &#39;Fld#5&#39;}
---
...
tarantool&gt; t:update({{&#39;=&#39;, 2, &#39;B&#39;}})
---
- [&#39;Fld#1&#39;, &#39;B&#39;, &#39;Fld#3&#39;, &#39;Fld#4&#39;, &#39;Fld#5&#39;]
...
</pre></div>
</div>
</dd></dl>

<span class="target" id="box-tuple-upsert"></span><dl class="method">
<dt id="box.tuple.tuple_object.upsert">
<code class="descname">upsert</code><span class="sig-paren">(</span><em>{{operator</em>, <em>field_no</em>, <em>value}</em>, <em>...}</em><span class="sig-paren">)</span><a class="headerlink" href="#box.tuple.tuple_object.upsert" title="Permalink to this definition">¶</a></dt>
<dd><p>The same as <code class="docutils literal notranslate"><span class="pre">tuple_object:update()</span></code>, but ignores errors. In case
of an error the tuple is left intact, but an error message is
printed. Only client errors are ignored, such as a bad field type,
or wrong field index/name. System errors, such as OOM, are not
ignored and raised just like with a normal <code class="docutils literal notranslate"><span class="pre">update()</span></code>. Note that
only bad operations are ignored. All correct operations are
applied.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>operator</strong> (<em>string</em>) – operation type represented as a string (e.g.
‘<code class="docutils literal notranslate"><span class="pre">=</span></code>’ for ‘assign new value’)</li>
<li><strong>field_no</strong> (<em>number</em>) – the field to which the operation will be applied. The
field number can be negative, meaning the
position from the end of tuple.
(#tuple + negative field number + 1)</li>
<li><strong>value</strong> (<em>lua_value</em>) – the value which will be applied</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">new tuple</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">tuple</p>
</td>
</tr>
</tbody>
</table>
<p>See the following example where one operation is applied, and one is not.</p>
<div class="highlight-tarantoolsession notranslate"><div class="highlight"><pre><span></span>tarantool&gt; t = box.tuple.new({1, 2, 3})
tarantool&gt; t2 = t:upsert({{&#39;=&#39;, 5, 100}})
UPSERT operation failed:
ER_NO_SUCH_FIELD_NO: Field 5 was not found in the tuple
---
...

tarantool&gt; t
---
- [1, 2, 3]
...

tarantool&gt; t2
---
- [1, 2, 3]
...

tarantool&gt; t2 = t:upsert({{&#39;=&#39;, 5, 100}, {&#39;+&#39;, 1, 3}})
UPSERT operation failed:
ER_NO_SUCH_FIELD_NO: Field 5 was not found in the tuple
---
...

tarantool&gt; t
---
- [1, 2, 3]
...

tarantool&gt; t2
---
- [4, 2, 3]
...
</pre></div>
</div>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="example">
<h2>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h2>
<p>This function will illustrate how to convert tuples to/from Lua tables and lists
of scalars:</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">tuple</span> <span class="o">=</span> <span class="n">box</span><span class="p">.</span><span class="n">tuple</span><span class="p">.</span><span class="n">new</span><span class="p">({</span><span class="n">scalar1</span><span class="p">,</span> <span class="n">scalar2</span><span class="p">,</span> <span class="p">...</span> <span class="n">scalar_n</span><span class="p">})</span> <span class="c1">-- scalars to tuple</span>
<span class="n">lua_table</span> <span class="o">=</span> <span class="p">{</span><span class="n">tuple</span><span class="p">:</span><span class="n">unpack</span><span class="p">()}</span>                            <span class="c1">-- tuple to Lua table</span>
<span class="n">lua_table</span> <span class="o">=</span> <span class="n">tuple</span><span class="p">:</span><span class="n">totable</span><span class="p">()</span>                             <span class="c1">-- tuple to Lua table</span>
<span class="n">scalar1</span><span class="p">,</span> <span class="n">scalar2</span><span class="p">,</span> <span class="p">...</span> <span class="n">scalar_n</span> <span class="o">=</span> <span class="n">tuple</span><span class="p">:</span><span class="n">unpack</span><span class="p">()</span>         <span class="c1">-- tuple to scalars</span>
<span class="n">tuple</span> <span class="o">=</span> <span class="n">box</span><span class="p">.</span><span class="n">tuple</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="n">lua_table</span><span class="p">)</span>                        <span class="c1">-- Lua table to tuple</span>
</pre></div>
</div>
<p>Then it will find the field that contains ‘b’, remove that field from the tuple,
and display how many bytes remain in the tuple. The function uses Tarantool
<code class="docutils literal notranslate"><span class="pre">box.tuple</span></code> functions <code class="docutils literal notranslate"><span class="pre">new()</span></code>, <code class="docutils literal notranslate"><span class="pre">unpack()</span></code>, <code class="docutils literal notranslate"><span class="pre">find()</span></code>, <code class="docutils literal notranslate"><span class="pre">transform()</span></code>,
<code class="docutils literal notranslate"><span class="pre">bsize()</span></code>.</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="kr">function</span> <span class="nf">example</span><span class="p">()</span>
  <span class="kd">local</span> <span class="n">tuple1</span><span class="p">,</span> <span class="n">tuple2</span><span class="p">,</span> <span class="n">lua_table_1</span><span class="p">,</span> <span class="n">scalar1</span><span class="p">,</span> <span class="n">scalar2</span><span class="p">,</span> <span class="n">scalar3</span><span class="p">,</span> <span class="n">field_number</span>
  <span class="kd">local</span> <span class="n">luatable1</span> <span class="o">=</span> <span class="p">{}</span>
  <span class="n">tuple1</span> <span class="o">=</span> <span class="n">box</span><span class="p">.</span><span class="n">tuple</span><span class="p">.</span><span class="n">new</span><span class="p">({</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">})</span>
  <span class="n">luatable1</span> <span class="o">=</span> <span class="n">tuple1</span><span class="p">:</span><span class="n">totable</span><span class="p">()</span>
  <span class="n">scalar1</span><span class="p">,</span> <span class="n">scalar2</span><span class="p">,</span> <span class="n">scalar3</span> <span class="o">=</span> <span class="n">tuple1</span><span class="p">:</span><span class="n">unpack</span><span class="p">()</span>
  <span class="n">tuple2</span> <span class="o">=</span> <span class="n">box</span><span class="p">.</span><span class="n">tuple</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="n">luatable1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">luatable1</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">luatable1</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
  <span class="n">field_number</span> <span class="o">=</span> <span class="n">tuple2</span><span class="p">:</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
  <span class="n">tuple2</span> <span class="o">=</span> <span class="n">tuple2</span><span class="p">:</span><span class="n">transform</span><span class="p">(</span><span class="n">field_number</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
  <span class="kr">return</span> <span class="s1">&#39;tuple2 = &#39;</span> <span class="p">,</span> <span class="n">tuple2</span> <span class="p">,</span> <span class="s1">&#39; # of bytes = &#39;</span> <span class="p">,</span> <span class="n">tuple2</span><span class="p">:</span><span class="n">bsize</span><span class="p">()</span>
<span class="kr">end</span>
</pre></div>
</div>
<p>… And here is what happens when one invokes the function:</p>
<div class="highlight-tarantoolsession notranslate"><div class="highlight"><pre><span></span>tarantool&gt; example()
---
- tuple2 =
- [&#39;a&#39;, &#39;c&#39;]
- &#39; # of bytes = &#39;
- 5
...
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Tarantool Core Team

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>