

<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Submodule box.space &mdash; Tarantool Dev Docs  documentation</title>
  

  
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../../_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../index.html" class="icon icon-home" alt="Documentation Home"> Tarantool Dev Docs
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../dev_guide/index.html">Contributor’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/index.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../internals/source/index.html">Tarantool internals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../internals/source/index.html#indices-and-tables">Indices and tables</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">Tarantool Dev Docs</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Submodule <cite>box.space</cite></li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../../_sources/doc/doc/reference/reference_lua/box_space.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="submodule-box-space">
<span id="box-space"></span><h1>Submodule <cite>box.space</cite><a class="headerlink" href="#submodule-box-space" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p><strong>CRUD operations</strong> in Tarantool are implemented by the <code class="docutils literal notranslate"><span class="pre">box.space</span></code> submodule.
It has the data-manipulation functions <code class="docutils literal notranslate"><span class="pre">select</span></code>, <code class="docutils literal notranslate"><span class="pre">insert</span></code>, <code class="docutils literal notranslate"><span class="pre">replace</span></code>,
<code class="docutils literal notranslate"><span class="pre">update</span></code>, <code class="docutils literal notranslate"><span class="pre">upsert</span></code>, <code class="docutils literal notranslate"><span class="pre">delete</span></code>, <code class="docutils literal notranslate"><span class="pre">get</span></code>, <code class="docutils literal notranslate"><span class="pre">put</span></code>. It also has members,
such as id, and whether or not a space is enabled. Submodule source code
is available in file
<a class="reference external" href="https://github.com/tarantool/tarantool/blob/1.7/src/box/lua/schema.lua">src/box/lua/schema.lua</a>.</p>
</div>
<div class="section" id="index">
<h2>Index<a class="headerlink" href="#index" title="Permalink to this headline">¶</a></h2>
<p>Below is a list of all <code class="docutils literal notranslate"><span class="pre">box.space</span></code> functions and members.</p>
<div class="table docutils container">
<table border="1" class="left-align-column-1 left-align-column-2 docutils">
<colgroup>
<col width="54%" />
<col width="46%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Use</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><a class="reference internal" href="box_space_index.html#box-space-auto-increment"><span class="std std-ref">space_object:auto_increment()</span></a></td>
<td>Generate key + Insert a tuple</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="box_space_index.html#box-space-bsize"><span class="std std-ref">space_object:bsize()</span></a></td>
<td>Get count of bytes</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="box_space_index.html#box-space-count"><span class="std std-ref">space_object:count()</span></a></td>
<td>Get count of tuples</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="box_space_index.html#box-space-create-index"><span class="std std-ref">space_object:create_index()</span></a></td>
<td>Create an index</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="box_space_index.html#box-space-delete"><span class="std std-ref">space_object:delete()</span></a></td>
<td>Delete a tuple</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="box_space_index.html#box-space-drop"><span class="std std-ref">space_object:drop()</span></a></td>
<td>Destroy a space</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="box_space_index.html#box-space-format"><span class="std std-ref">space_object:format()</span></a></td>
<td>Declare field names and types</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="box_space_index.html#box-space-frommap"><span class="std std-ref">space_object:frommap()</span></a></td>
<td>Convert from map to tuple or
table</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="box_space_index.html#box-space-get"><span class="std std-ref">space_object:get()</span></a></td>
<td>Select a tuple</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="box_space_index.html#box-space-insert"><span class="std std-ref">space_object:insert()</span></a></td>
<td>Insert a tuple</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="box_space_index.html#box-space-len"><span class="std std-ref">space_object:len()</span></a></td>
<td>Get count of tuples</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="box_space_index.html#box-space-on-replace"><span class="std std-ref">space_object:on_replace()</span></a></td>
<td>Create a replace trigger
with a function that cannot
change the tuple</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="box_space_index.html#box-space-before-replace"><span class="std std-ref">space_object:before_replace()</span></a></td>
<td>Create a replace trigger
with a function that can
change the tuple</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="box_space_index.html#box-space-pairs"><span class="std std-ref">space_object:pairs()</span></a></td>
<td>Prepare for iterating</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="box_space_index.html#box-space-replace"><span class="std std-ref">space_object:put()</span></a></td>
<td>Insert or replace a tuple</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="box_space_index.html#box-space-rename"><span class="std std-ref">space_object:rename()</span></a></td>
<td>Rename a space</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="box_space_index.html#box-space-replace"><span class="std std-ref">space_object:replace()</span></a></td>
<td>Insert or replace a tuple</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="box_space_index.html#box-space-run-triggers"><span class="std std-ref">space_object:run_triggers()</span></a></td>
<td>Enable/disable a replace
trigger</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="box_space_index.html#box-space-select"><span class="std std-ref">space_object:select()</span></a></td>
<td>Select one or more tuples</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="box_space_index.html#box-space-truncate"><span class="std std-ref">space_object:truncate()</span></a></td>
<td>Delete all tuples</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="box_space_index.html#box-space-update"><span class="std std-ref">space_object:update()</span></a></td>
<td>Update a tuple</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="box_space_index.html#box-space-upsert"><span class="std std-ref">space_object:upsert()</span></a></td>
<td>Update a tuple</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="box_space_index.html#box-space-user-defined"><span class="std std-ref">space_object:user_defined()</span></a></td>
<td>Any function / method that any
user wants to add</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="box_space_index.html#box-space-enabled"><span class="std std-ref">space_object.enabled</span></a></td>
<td>Flag, true if space is enabled</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="box_space_index.html#box-space-field-count"><span class="std std-ref">space_object.field_count</span></a></td>
<td>Required number of fields</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="box_space_index.html#box-space-id"><span class="std std-ref">space_object.id</span></a></td>
<td>Numeric identifier of space</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="box_space_index.html#box-space-space-index"><span class="std std-ref">space_object.index</span></a></td>
<td>Container of space’s indexes</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="box_space_index.html#box-space-cluster"><span class="std std-ref">box.space._cluster</span></a></td>
<td>(Metadata) List of replica sets</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="box_space_index.html#box-space-func"><span class="std std-ref">box.space._func</span></a></td>
<td>(Metadata) List of function
tuples</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="box_space_index.html#box-space-index"><span class="std std-ref">box.space._index</span></a></td>
<td>(Metadata) List of indexes</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="box_space_index.html#box-space-vindex"><span class="std std-ref">box.space._vindex</span></a></td>
<td>(Metadata) List of indexes
accessible for the current user</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="box_space_index.html#box-space-priv"><span class="std std-ref">box.space._priv</span></a></td>
<td>(Metadata) List of privileges</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="box_space_index.html#box-space-vpriv"><span class="std std-ref">box.space._vpriv</span></a></td>
<td>(Metadata) List of privileges
accessible for the current user</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="box_space_index.html#box-space-schema"><span class="std std-ref">box.space._schema</span></a></td>
<td>(Metadata) List of schemas</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="box_space_index.html#box-space-sequence"><span class="std std-ref">box.space._sequence</span></a></td>
<td>(Metadata) List of sequences</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="box_space_index.html#box-space-sequence-data"><span class="std std-ref">box.space._sequence_data</span></a></td>
<td>(Metadata) List of sequences</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="box_space_index.html#box-space-space"><span class="std std-ref">box.space._space</span></a></td>
<td>(Metadata) List of spaces</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="box_space_index.html#box-space-vspace"><span class="std std-ref">box.space._vspace</span></a></td>
<td>(Metadata) List of spaces
accessible for the current user</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="box_space_index.html#box-space-user"><span class="std std-ref">box.space._user</span></a></td>
<td>(Metadata) List of users</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="box_space_index.html#box-space-vuser"><span class="std std-ref">box.space._vuser</span></a></td>
<td>(Metadata) List of users
accessible for the current user</td>
</tr>
</tbody>
</table>
</div>
<span class="target" id="module-box.space"></span><dl class="class">
<dt id="box.space.space_object">
<em class="property">class </em><code class="descclassname">box.space.</code><code class="descname">space_object</code><a class="headerlink" href="#box.space.space_object" title="Permalink to this definition">¶</a></dt>
<dd><span class="target" id="box-space-auto-increment"></span><dl class="method">
<dt id="box.space.space_object.auto_increment">
<code class="descname">auto_increment</code><span class="sig-paren">(</span><em>tuple</em><span class="sig-paren">)</span><a class="headerlink" href="#box.space.space_object.auto_increment" title="Permalink to this definition">¶</a></dt>
<dd><p>Insert a new tuple using an auto-increment primary key. The space
specified by space_object must have an
<a class="reference internal" href="../../book/box/data_model.html#index-box-indexed-field-types"><span class="std std-ref">‘unsigned’ or ‘integer’ or ‘number’</span></a>
primary key index of type <code class="docutils literal notranslate"><span class="pre">TREE</span></code>. The primary-key field
will be incremented before the insert.</p>
<p>Since version 1.7.5 this method is deprecated – it is better to use a
<a class="reference internal" href="../../book/box/data_model.html#index-box-sequence"><span class="std std-ref">sequence</span></a>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>space_object</strong> (<a class="reference internal" href="box_space_index.html#box.space.space_object" title="box.space.space_object"><em>space_object</em></a>) – an <a class="reference internal" href="../lua_tips.html#app-server-object-reference"><span class="std std-ref">object reference</span></a></li>
<li><strong>tuple</strong> (<em>table/tuple</em>) – tuple’s fields, other than the
primary-key field</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">the inserted tuple.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">tuple</p>
</td>
</tr>
</tbody>
</table>
<p><strong>Complexity factors:</strong> Index size, Index type,
Number of indexes accessed, <a class="reference internal" href="../configuration/index.html#cfg-binary-logging-snapshots-rows-per-wal"><span class="std std-ref">WAL settings</span></a>.</p>
<p><strong>Possible errors:</strong></p>
<ul class="simple">
<li>index has wrong type;</li>
<li>primary-key indexed field is not a number.</li>
</ul>
<p><strong>Example:</strong></p>
<div class="highlight-tarantoolsession notranslate"><div class="highlight"><pre><span></span>tarantool&gt; box.space.tester:auto_increment{&#39;Fld#1&#39;, &#39;Fld#2&#39;}
---
- [1, &#39;Fld#1&#39;, &#39;Fld#2&#39;]
...
tarantool&gt; box.space.tester:auto_increment{&#39;Fld#3&#39;}
---
- [2, &#39;Fld#3&#39;]
...
</pre></div>
</div>
</dd></dl>

<span class="target" id="box-space-bsize"></span><dl class="method">
<dt id="box.space.space_object.bsize">
<code class="descname">bsize</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#box.space.space_object.bsize" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>space_object</strong> (<a class="reference internal" href="box_space_index.html#box.space.space_object" title="box.space.space_object"><em>space_object</em></a>) – an <a class="reference internal" href="../lua_tips.html#app-server-object-reference"><span class="std std-ref">object reference</span></a></td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">Number of bytes in the space. This number, which is stored
in Tarantool’s internal memory, represents the total number
of bytes in all tuples, not including index keys.
For a measure of index size,
see <a class="reference internal" href="box_index.html#box-index-bsize"><span class="std std-ref">index_object:bsize()</span></a>.</td>
</tr>
</tbody>
</table>
<p><strong>Example:</strong></p>
<div class="highlight-tarantoolsession notranslate"><div class="highlight"><pre><span></span>tarantool&gt; box.space.tester:bsize()
---
- 22
...
</pre></div>
</div>
</dd></dl>

<span class="target" id="box-space-count"></span><dl class="method">
<dt id="box.space.space_object.count">
<code class="descname">count</code><span class="sig-paren">(</span><span class="optional">[</span><em>key</em><span class="optional">]</span><span class="optional">[</span>, <em>iterator</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#box.space.space_object.count" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the number of tuples.
If compared with <a class="reference internal" href="box_space_index.html#box-space-len"><span class="std std-ref">len()</span></a>, this method works
slower because <code class="docutils literal notranslate"><span class="pre">count()</span></code> scans the entire space to count the
tuples.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>space_object</strong> (<a class="reference internal" href="box_space_index.html#box.space.space_object" title="box.space.space_object"><em>space_object</em></a>) – an <a class="reference internal" href="../lua_tips.html#app-server-object-reference"><span class="std std-ref">object reference</span></a></li>
<li><strong>key</strong> (<em>scalar/table</em>) – primary-key field values, must be passed as a
Lua table if key is multi-part</li>
<li><strong>iterator</strong> – comparison method</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">Number of tuples.</p>
</td>
</tr>
</tbody>
</table>
<p><strong>Example:</strong></p>
<div class="highlight-tarantoolsession notranslate"><div class="highlight"><pre><span></span>tarantool&gt; box.space.tester:count(2, {iterator=&#39;GE&#39;})
---
- 1
...
</pre></div>
</div>
</dd></dl>

<span class="target" id="box-space-create-index"></span><dl class="method">
<dt id="box.space.space_object.create_index">
<code class="descname">create_index</code><span class="sig-paren">(</span><em>index-name</em><span class="optional">[</span>, <em>options</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#box.space.space_object.create_index" title="Permalink to this definition">¶</a></dt>
<dd><p>Create an <a class="reference internal" href="../../book/box/indexes.html#index-box-index"><span class="std std-ref">index</span></a>.
It is mandatory to create an index for a space
before trying to insert tuples into it, or select tuples from it. The
first created index, which will be used as the primary-key index, must be
unique.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>space_object</strong> (<a class="reference internal" href="box_space_index.html#box.space.space_object" title="box.space.space_object"><em>space_object</em></a>) – an <a class="reference internal" href="../lua_tips.html#app-server-object-reference"><span class="std std-ref">object reference</span></a></li>
<li><strong>index_name</strong> (<em>string</em>) – name of index, which should conform to the
<a class="reference internal" href="../lua_tips.html#app-server-names"><span class="std std-ref">rules for object names</span></a></li>
<li><strong>options</strong> (<em>table</em>) – see “Options for space_object:create_index()”,
below</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">index object</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last"><a class="reference internal" href="box_index.html#box.index.index_object" title="box.index.index_object">index_object</a></p>
</td>
</tr>
</tbody>
</table>
<p id="box-space-create-index-options"><strong>Options for space_object:create_index()</strong></p>
<div class="table docutils container">
<table border="1" class="docutils">
<colgroup>
<col width="15%" />
<col width="39%" />
<col width="24%" />
<col width="22%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Effect</th>
<th class="head">Type</th>
<th class="head">Default</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>type</td>
<td>type of index</td>
<td>string
(‘HASH’ or ‘TREE’ or
‘BITSET’ or ‘RTREE’)
Note re storage engine:
vinyl only supports ‘TREE’</td>
<td>‘TREE’</td>
</tr>
<tr class="row-odd"><td>id</td>
<td>unique identifier</td>
<td>number</td>
<td>last index’s id, +1</td>
</tr>
<tr class="row-even"><td>unique</td>
<td>index is unique</td>
<td>boolean</td>
<td><code class="docutils literal notranslate"><span class="pre">true</span></code></td>
</tr>
<tr class="row-odd"><td>if_not_exists</td>
<td>no error if duplicate name</td>
<td>boolean</td>
<td><code class="docutils literal notranslate"><span class="pre">false</span></code></td>
</tr>
<tr class="row-even"><td>parts</td>
<td>field-numbers  + types</td>
<td>{field_no, ‘unsigned’ or
‘string’ or ‘integer’ or
‘number’ or ‘boolean’ or
‘array’ or ‘scalar’,
and optional collation,
and optional is_nullable value}</td>
<td><code class="docutils literal notranslate"><span class="pre">{1,</span> <span class="pre">'unsigned'}</span></code></td>
</tr>
<tr class="row-odd"><td>dimension</td>
<td>affects <a class="reference internal" href="box_index.html#box-index-rtree"><span class="std std-ref">RTREE</span></a> only</td>
<td>number</td>
<td>2</td>
</tr>
<tr class="row-even"><td>distance</td>
<td>affects RTREE only</td>
<td>string (‘euclid’ or
‘manhattan’)</td>
<td>‘euclid’</td>
</tr>
<tr class="row-odd"><td>bloom_fpr</td>
<td>affects vinyl only</td>
<td>number</td>
<td><code class="docutils literal notranslate"><span class="pre">vinyl_bloom_fpr</span></code></td>
</tr>
<tr class="row-even"><td>page_size</td>
<td>affects vinyl only</td>
<td>number</td>
<td><code class="docutils literal notranslate"><span class="pre">vinyl_page_size</span></code></td>
</tr>
<tr class="row-odd"><td>range_size</td>
<td>affects vinyl only</td>
<td>number</td>
<td><code class="docutils literal notranslate"><span class="pre">vinyl_range_size</span></code></td>
</tr>
<tr class="row-even"><td>run_count_per_level</td>
<td>affects vinyl only</td>
<td>number</td>
<td><code class="docutils literal notranslate"><span class="pre">vinyl_run_count_per_level</span></code></td>
</tr>
<tr class="row-odd"><td>run_size_ratio</td>
<td>affects vinyl only</td>
<td>number</td>
<td><code class="docutils literal notranslate"><span class="pre">vinyl_run_size_ratio</span></code></td>
</tr>
<tr class="row-even"><td>sequence</td>
<td>see section regarding
<a class="reference internal" href="box_schema.html#box-schema-sequence-create-index"><span class="std std-ref">specifying a sequence in create_index()</span></a></td>
<td>string or number</td>
<td>not present</td>
</tr>
</tbody>
</table>
</div>
<p>The options in the above chart are also applicable for <a class="reference internal" href="box_index.html#box-index-alter"><span class="std std-ref">index_object:alter()</span></a>.</p>
<p><strong>Note re storage engine:</strong> vinyl has extra options which by default are
based on configuration parameters
<a class="reference internal" href="../configuration/index.html#cfg-storage-vinyl-bloom-fpr"><span class="std std-ref">vinyl_bloom_fpr</span></a>,
<a class="reference internal" href="../configuration/index.html#cfg-storage-vinyl-page-size"><span class="std std-ref">vinyl_page_size</span></a>,
<a class="reference internal" href="../configuration/index.html#cfg-storage-vinyl-range-size"><span class="std std-ref">vinyl_range_size</span></a>,
<a class="reference internal" href="../configuration/index.html#cfg-storage-vinyl-run-count-per-level"><span class="std std-ref">vinyl_run_count_per_level</span></a>, and
<a class="reference internal" href="../configuration/index.html#cfg-storage-vinyl-run-size-ratio"><span class="std std-ref">vinyl_run_size_ratio</span></a>
– see the description of those parameters.
The current values can be seen by selecting from
<a class="reference internal" href="box_space_index.html#box-space-index"><span class="std std-ref">box.space._index</span></a>.</p>
<p><strong>Possible errors:</strong></p>
<ul class="simple">
<li>too many parts;</li>
<li>index ‘…’ already exists;</li>
<li>primary key must be unique.</li>
</ul>
<div class="highlight-tarantoolsession notranslate"><div class="highlight"><pre><span></span>tarantool&gt; s = box.space.tester
---
...
tarantool&gt; s:create_index(&#39;primary&#39;, {unique = true, parts = { {field = 1, type = &#39;unsigned&#39;}, {field = 2, type = &#39;string&#39;}} })
---
...
</pre></div>
</div>
</dd></dl>

<p id="details-about-index-field-types"><strong>Details about index field types:</strong></p>
<p>The seven index field types (unsigned | string | integer | number |
boolean | array | scalar) differ depending on what values are allowed, and
what index types are allowed.</p>
<ul class="simple">
<li><strong>unsigned</strong>: unsigned integers between 0 and 18446744073709551615,
about 18 quintillion. May also be called ‘uint’ or ‘num’, but ‘num’
is deprecated. Legal in memtx TREE or HASH indexes, and in vinyl TREE
indexes.</li>
<li><strong>string</strong>: any set of octets, up to the <a class="reference internal" href="../../book/box/limitations.html#limitations-bytes-in-index-key"><span class="std std-ref">maximum length</span></a>. May also be called ‘str’. Legal in
memtx TREE or HASH or BITSET indexes, and in vinyl TREE indexes.
A string may have a <a class="reference internal" href="../../book/box/data_model.html#index-collation"><span class="std std-ref">collation</span></a>.</li>
<li><strong>integer</strong>: integers between -9223372036854775808 and 18446744073709551615.
May also be called ‘int’. Legal in memtx TREE or HASH indexes, and in
vinyl TREE indexes.</li>
<li><strong>number</strong>: integers between -9223372036854775808 and 18446744073709551615,
single-precision floating point numbers, or double-precision floating
point numbers. Legal in memtx TREE or HASH indexes, and in vinyl TREE
indexes.</li>
<li><strong>boolean</strong>: true or false. Legal in memtx TREE or HASH indexes, and in
vinyl TREE indexes.</li>
<li><strong>array</strong>: array of numbers. Legal in memtx <a class="reference internal" href="box_index.html#box-index-rtree"><span class="std std-ref">RTREE</span></a> indexes.</li>
<li><strong>scalar</strong>: booleans (true or false), or integers between
-9223372036854775808 and 18446744073709551615, or single-precision
floating point numbers, or double-precison floating-point numbers, or
strings. When there is a mix of types, the key order is:
booleans, then numbers, then strings. Legal in memtx TREE or
HASH indexes, and in vinyl TREE indexes.</li>
</ul>
<p>Additionally, <cite>nil</cite> is allowed with any index field type if
<a class="reference internal" href="box_space_index.html#box-space-is-nullable"><span class="std std-ref">is_nullable=true</span></a> is specified.</p>
<p id="box-space-index-field-types"><strong>Index field types to use in space_object:create_index()</strong></p>
<div class="table stackcolumn docutils container">
<table border="1" class="docutils">
<colgroup>
<col width="17%" />
<col width="26%" />
<col width="38%" />
<col width="18%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Index field type</td>
<td>What can be in it</td>
<td>Where is it legal</td>
<td>Examples</td>
</tr>
<tr class="row-even"><td><strong>unsigned</strong></td>
<td>integers between 0 and
18446744073709551615</td>
<td>memtx TREE or HASH
indexes, <a href="#id5"><span class="problematic" id="id6">|br|</span></a>
vinyl TREE indexes</td>
<td>123456 <a href="#id7"><span class="problematic" id="id8">|br|</span></a></td>
</tr>
<tr class="row-odd"><td><strong>string</strong></td>
<td>strings – any set of
octets</td>
<td>memtx TREE or HASH indexes <a href="#id9"><span class="problematic" id="id10">|br|</span></a>
vinyl TREE indexes</td>
<td>‘A B C’ <a href="#id11"><span class="problematic" id="id12">|br|</span></a>
‘\65 \66 \67’</td>
</tr>
<tr class="row-even"><td><strong>integer</strong></td>
<td>integers between
-9223372036854775808 and
18446744073709551615</td>
<td>memtx TREE or HASH indexes, <a href="#id13"><span class="problematic" id="id14">|br|</span></a>
vinyl TREE indexes</td>
<td>-2^63 <a href="#id15"><span class="problematic" id="id16">|br|</span></a></td>
</tr>
<tr class="row-odd"><td><strong>number</strong></td>
<td>integers between
-9223372036854775808 and
18446744073709551615,
single-precision
floating point numbers,
double-precision
floating point numbers</td>
<td>memtx TREE or HASH indexes, <a href="#id17"><span class="problematic" id="id18">|br|</span></a>
vinyl TREE indexes</td>
<td>1.234 <a href="#id19"><span class="problematic" id="id20">|br|</span></a>
-44 <a href="#id21"><span class="problematic" id="id22">|br|</span></a>
1.447e+44</td>
</tr>
<tr class="row-even"><td><strong>boolean</strong></td>
<td>true or false</td>
<td>memtx TREE or HASH indexes, <a href="#id23"><span class="problematic" id="id24">|br|</span></a>
vinyl TREE indexes</td>
<td>false <a href="#id25"><span class="problematic" id="id26">|br|</span></a>
true</td>
</tr>
<tr class="row-odd"><td><strong>array</strong></td>
<td>array of integers between
-9223372036854775808 and
9223372036854775807</td>
<td>memtx RTREE indexes</td>
<td>{10, 11} <a href="#id27"><span class="problematic" id="id28">|br|</span></a>
{3, 5, 9, 10}</td>
</tr>
<tr class="row-even"><td><strong>scalar</strong></td>
<td>booleans (true or false),
integers between
-9223372036854775808 and
18446744073709551615,
single-precision floating
point numbers,
double-precision floating
point numbers, strings</td>
<td>memtx TREE or HASH indexes, <a href="#id29"><span class="problematic" id="id30">|br|</span></a>
vinyl TREE indexes</td>
<td>true <a href="#id31"><span class="problematic" id="id32">|br|</span></a>
-1 <a href="#id33"><span class="problematic" id="id34">|br|</span></a>
1.234 <a href="#id35"><span class="problematic" id="id36">|br|</span></a>
‘’ <a href="#id37"><span class="problematic" id="id38">|br|</span></a>
‘ру’</td>
</tr>
</tbody>
</table>
</div>
<p id="box-space-is-nullable"><strong>Allowing null for an indexed key:</strong> If the index type is TREE, and the index
is not the primary index, then the <code class="docutils literal notranslate"><span class="pre">parts={...}</span></code> clause may include
<code class="docutils literal notranslate"><span class="pre">is_nullable=true</span></code> or <code class="docutils literal notranslate"><span class="pre">is_nullable=false</span></code> (the default). If <code class="docutils literal notranslate"><span class="pre">is_nullable</span></code> is
true, then it is legal to insert <code class="docutils literal notranslate"><span class="pre">nil</span></code> or an equivalent such as <code class="docutils literal notranslate"><span class="pre">msgpack.NULL</span></code>
(or it is legal to insert nothing at all for trailing nullable fields).
Within indexes, such “null values” are always treated as equal to other null
values, and are always treated as less than non-null values.
Nulls may appear multiple times even in a unique index. Example:</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="n">create_index</span><span class="p">(</span><span class="s1">&#39;I&#39;</span><span class="p">,{</span><span class="n">unique</span><span class="o">=</span><span class="kc">true</span><span class="p">,</span><span class="n">parts</span><span class="o">=</span><span class="p">{{</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;number&#39;</span><span class="p">,</span><span class="n">is_nullable</span><span class="o">=</span><span class="kc">true</span><span class="p">}}})</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">It is legal to create multiple indexes for the same field with different
<code class="docutils literal notranslate"><span class="pre">is_nullable</span></code> values, or to call <a class="reference internal" href="box_space_index.html#box-space-format"><span class="std std-ref">space_object:format()</span></a>
with a different <code class="docutils literal notranslate"><span class="pre">is_nullable</span></code> value from what is used for an index.
When there is a contradiction, the rule is: null is illegal unless
<code class="docutils literal notranslate"><span class="pre">is_nullable=true</span></code> for every index and for the space format.</p>
</div>
<p id="box-space-field-names"><strong>Using field names instead of field numbers:</strong> <code class="docutils literal notranslate"><span class="pre">create_index()</span></code> can use
field names and/or field types described by the optional
<a class="reference internal" href="box_space_index.html#box-space-format"><span class="std std-ref">space_object:format()</span></a> clause.
In the following example, we show <code class="docutils literal notranslate"><span class="pre">format()</span></code> for a space that has two columns
named ‘x’ and ‘y’, and then we show five variations of the <code class="docutils literal notranslate"><span class="pre">parts={}</span></code>
clause of <code class="docutils literal notranslate"><span class="pre">create_index()</span></code>,
first for the ‘x’ column, second for both the ‘x’ and ‘y’ columns.
The variations include omitting the type, using numbers, and adding extra braces.</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="n">format</span><span class="p">({{</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;scalar&#39;</span><span class="p">},</span> <span class="p">{</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;integer&#39;</span><span class="p">}})</span>
<span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="n">create_index</span><span class="p">(</span><span class="s1">&#39;I2&#39;</span><span class="p">,{</span><span class="n">parts</span><span class="o">=</span><span class="p">{{</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;scalar&#39;</span><span class="p">}}})</span>
<span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="n">create_index</span><span class="p">(</span><span class="s1">&#39;I3&#39;</span><span class="p">,{</span><span class="n">parts</span><span class="o">=</span><span class="p">{{</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;scalar&#39;</span><span class="p">},{</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="s1">&#39;integer&#39;</span><span class="p">}}})</span>
<span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="n">create_index</span><span class="p">(</span><span class="s1">&#39;I4&#39;</span><span class="p">,{</span><span class="n">parts</span><span class="o">=</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;scalar&#39;</span><span class="p">}})</span>
<span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="n">create_index</span><span class="p">(</span><span class="s1">&#39;I5&#39;</span><span class="p">,{</span><span class="n">parts</span><span class="o">=</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;scalar&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;integer&#39;</span><span class="p">}})</span>
<span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="n">create_index</span><span class="p">(</span><span class="s1">&#39;I6&#39;</span><span class="p">,{</span><span class="n">parts</span><span class="o">=</span><span class="p">{</span><span class="mi">1</span><span class="p">}})</span>
<span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="n">create_index</span><span class="p">(</span><span class="s1">&#39;I7&#39;</span><span class="p">,{</span><span class="n">parts</span><span class="o">=</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">}})</span>
<span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="n">create_index</span><span class="p">(</span><span class="s1">&#39;I8&#39;</span><span class="p">,{</span><span class="n">parts</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">}})</span>
<span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="n">create_index</span><span class="p">(</span><span class="s1">&#39;I9&#39;</span><span class="p">,{</span><span class="n">parts</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">}})</span>
<span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="n">create_index</span><span class="p">(</span><span class="s1">&#39;I10&#39;</span><span class="p">,{</span><span class="n">parts</span><span class="o">=</span><span class="p">{{</span><span class="s1">&#39;x&#39;</span><span class="p">}}})</span>
<span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="n">create_index</span><span class="p">(</span><span class="s1">&#39;I11&#39;</span><span class="p">,{</span><span class="n">parts</span><span class="o">=</span><span class="p">{{</span><span class="s1">&#39;x&#39;</span><span class="p">},{</span><span class="s1">&#39;y&#39;</span><span class="p">}}})</span>
</pre></div>
</div>
<p><strong>Note re storage engine:</strong> vinyl supports only the TREE index type, and vinyl
secondary indexes must be created before tuples are inserted.</p>
<span class="target" id="box-space-delete"></span><dl class="method">
<dt id="box.space.space_object.delete">
<code class="descname">delete</code><span class="sig-paren">(</span><em>key</em><span class="sig-paren">)</span><a class="headerlink" href="#box.space.space_object.delete" title="Permalink to this definition">¶</a></dt>
<dd><p>Delete a tuple identified by a primary key.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>space_object</strong> (<a class="reference internal" href="box_space_index.html#box.space.space_object" title="box.space.space_object"><em>space_object</em></a>) – an <a class="reference internal" href="../lua_tips.html#app-server-object-reference"><span class="std std-ref">object reference</span></a></li>
<li><strong>key</strong> (<em>scalar/table</em>) – primary-key field values, must be passed as a
Lua table if key is multi-part</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">the deleted tuple</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">tuple</p>
</td>
</tr>
</tbody>
</table>
<p><strong>Complexity factors:</strong> Index size, Index type</p>
<p><strong>Note re storage engine:</strong>
vinyl will return <code class="docutils literal notranslate"><span class="pre">nil</span></code>, rather than the deleted tuple.</p>
<p><strong>Example:</strong></p>
<div class="highlight-tarantoolsession notranslate"><div class="highlight"><pre><span></span>tarantool&gt; box.space.tester:delete(1)
---
- [1, &#39;My first tuple&#39;]
...
tarantool&gt; box.space.tester:delete(1)
---
...
tarantool&gt; box.space.tester:delete(&#39;a&#39;)
---
- error: &#39;Supplied key type of part 0 does not match index part type:
  expected unsigned&#39;
...
</pre></div>
</div>
<p>For more usage scenarios and typical errors see
<a class="reference internal" href="box_space_index.html#box-space-operations-detailed-examples"><span class="std std-ref">Example: using data operations</span></a>
further in this section.</p>
</dd></dl>

<span class="target" id="box-space-drop"></span><dl class="method">
<dt id="box.space.space_object.drop">
<code class="descname">drop</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#box.space.space_object.drop" title="Permalink to this definition">¶</a></dt>
<dd><p>Drop a space. The method is performed in background and doesn’t block
consequent requests.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>space_object</strong> (<a class="reference internal" href="box_space_index.html#box.space.space_object" title="box.space.space_object"><em>space_object</em></a>) – an <a class="reference internal" href="../lua_tips.html#app-server-object-reference"><span class="std std-ref">object reference</span></a></td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">nil</td>
</tr>
</tbody>
</table>
<p><strong>Possible errors:</strong> <code class="docutils literal notranslate"><span class="pre">space_object</span></code> does not exist.</p>
<p><strong>Complexity factors:</strong> Index size, Index type,
Number of indexes accessed, WAL settings.</p>
<p><strong>Example:</strong></p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">space_that_does_not_exist</span><span class="p">:</span><span class="n">drop</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<span class="target" id="box-space-format"></span><dl class="method">
<dt id="box.space.space_object.format">
<code class="descname">format</code><span class="sig-paren">(</span><span class="optional">[</span><em>format-clause</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#box.space.space_object.format" title="Permalink to this definition">¶</a></dt>
<dd><p>Declare field names and <a class="reference internal" href="../../book/box/data_model.html#index-box-data-types"><span class="std std-ref">types</span></a>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>space_object</strong> (<a class="reference internal" href="box_space_index.html#box.space.space_object" title="box.space.space_object"><em>space_object</em></a>) – an <a class="reference internal" href="../lua_tips.html#app-server-object-reference"><span class="std std-ref">object reference</span></a></li>
<li><strong>format-clause</strong> (<em>table</em>) – a list of field names and types</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">nil, unless format-clause is omitted</p>
</td>
</tr>
</tbody>
</table>
<p><strong>Possible errors:</strong></p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">space_object</span></code> does not exist;</li>
<li>field names are duplicated;</li>
<li>type is not legal.</li>
</ul>
<p>Ordinarily Tarantool allows unnamed untyped fields.
But with <code class="docutils literal notranslate"><span class="pre">format</span></code> users can, for example, document
that the Nth field is the surname field and must contain strings.
It is also possible to specify a format clause in
<a class="reference internal" href="box_schema.html#box-schema-space-create"><span class="std std-ref">box.schema.space.create()</span></a>.</p>
<p>The format clause contains, for each field, a definition within braces:
<code class="docutils literal notranslate"><span class="pre">{name='...',type='...'[,is_nullable=...]}</span></code>, where:</p>
<ul class="simple">
<li>the <code class="docutils literal notranslate"><span class="pre">name</span></code> value may be any string, provided that two fields do not
have the same name;</li>
<li>the <code class="docutils literal notranslate"><span class="pre">type</span></code> value may be any of allowed types: any | unsigned | string |
integer | number | boolean | array | map | scalar, but for creating an
index use only <a class="reference internal" href="../../book/box/data_model.html#index-box-indexed-field-types"><span class="std std-ref">indexed fields</span></a>;</li>
<li>the optional <code class="docutils literal notranslate"><span class="pre">is_nullable</span></code> value may be either <code class="docutils literal notranslate"><span class="pre">true</span></code> or <code class="docutils literal notranslate"><span class="pre">false</span></code>
(the same as the requirement in
<a class="reference internal" href="box_space_index.html#box-space-create-index-options"><span class="std std-ref">“Options for space_object:create_index”</span></a>).
See also the warning notice in section
<a class="reference internal" href="box_space_index.html#box-space-is-nullable"><span class="std std-ref">Allowing null for an indexed key</span></a>.</li>
</ul>
<p>It is not legal for tuples to contain values that have the wrong type;
for example after <code class="docutils literal notranslate"><span class="pre">box.space.tester:format({{'</span> <span class="pre">',type='number'}})</span></code> the
request <code class="docutils literal notranslate"><span class="pre">box.space.tester:insert{'string-which-is-not-a-number'}</span></code> will
cause an error.</p>
<p>It is not legal for tuples to contain null values if <code class="docutils literal notranslate"><span class="pre">is_nullable=false</span></code>,
which is the default; for example after
<code class="docutils literal notranslate"><span class="pre">box.space.tester:format({{'</span> <span class="pre">',type='number',is_nullable=false}})</span></code>
the request <code class="docutils literal notranslate"><span class="pre">box.space.tester:insert{nil,2}</span></code> will cause an error.</p>
<p>It is legal for tuples to have more fields than are described by a format
clause. The way to constrain the number of fields is to specify a space’s
<a class="reference internal" href="box_space_index.html#box-space-field-count"><span class="std std-ref">field_count</span></a> member.</p>
<p>It is legal for tuples to have fewer fields than are described by a format
clause, if the omitted trailing fields are described with <code class="docutils literal notranslate"><span class="pre">is_nullable=true</span></code>;
for example after
<code class="docutils literal notranslate"><span class="pre">box.space.tester:format({{'a',type='number'},{'b',type='number',is_nullable=true}})</span></code>
the request <code class="docutils literal notranslate"><span class="pre">box.space.tester:insert{2}</span></code> will not cause a format-related error.</p>
<p>It is legal to use <code class="docutils literal notranslate"><span class="pre">format</span></code> on a space that already has a format,
thus replacing any previous definitions,
provided that there is no conflict with existing data or index definitions.</p>
<p>It is legal to use <code class="docutils literal notranslate"><span class="pre">format</span></code> to change the <code class="docutils literal notranslate"><span class="pre">is_nullable</span></code> flag;
for example after <code class="docutils literal notranslate"><span class="pre">box.space.tester:format({{'</span> <span class="pre">',type='scalar',is_nullable=false}})</span></code>
the request <code class="docutils literal notranslate"><span class="pre">box.space.tester:format({{'</span> <span class="pre">',type='scalar',is_nullable=true}})</span></code>
will not cause an error – and will not cause rebuilding of the space.
But going the other way and changing <code class="docutils literal notranslate"><span class="pre">is_nullable</span></code> from <code class="docutils literal notranslate"><span class="pre">true</span></code>
to <code class="docutils literal notranslate"><span class="pre">false</span></code> might cause rebuilding and might cause an error if there
are existing tuples with nulls.</p>
<p><strong>Example:</strong></p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="n">format</span><span class="p">({{</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;surname&#39;</span><span class="p">,</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;string&#39;</span><span class="p">},{</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;IDX&#39;</span><span class="p">,</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;array&#39;</span><span class="p">}})</span>
<span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="n">format</span><span class="p">({{</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;surname&#39;</span><span class="p">,</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;string&#39;</span><span class="p">,</span><span class="n">is_nullable</span><span class="o">=</span><span class="kc">true</span><span class="p">}})</span>
</pre></div>
</div>
<p>There are legal variations of the format clause:</p>
<ul class="simple">
<li>omitting both ‘name=’ and ‘type=’,</li>
<li>omitting ‘type=’ alone, and</li>
<li>adding extra braces.</li>
</ul>
<p>The following examples show all the variations,
first for one field named ‘x’, second for two fields named ‘x’ and ‘y’.</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="n">format</span><span class="p">({{</span><span class="s1">&#39;x&#39;</span><span class="p">}})</span>
<span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="n">format</span><span class="p">({{</span><span class="s1">&#39;x&#39;</span><span class="p">},{</span><span class="s1">&#39;y&#39;</span><span class="p">}})</span>
<span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="n">format</span><span class="p">({{</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;scalar&#39;</span><span class="p">}})</span>
<span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="n">format</span><span class="p">({{</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;scalar&#39;</span><span class="p">},{</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;unsigned&#39;</span><span class="p">}})</span>
<span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="n">format</span><span class="p">({{</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">}})</span>
<span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="n">format</span><span class="p">({{</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">},{</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">}})</span>
<span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="n">format</span><span class="p">({{</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;scalar&#39;</span><span class="p">}})</span>
<span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="n">format</span><span class="p">({{</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;scalar&#39;</span><span class="p">},{</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;unsigned&#39;</span><span class="p">}})</span>
<span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="n">format</span><span class="p">({{</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;scalar&#39;</span><span class="p">}})</span>
<span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="n">format</span><span class="p">({{</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;scalar&#39;</span><span class="p">},{</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="s1">&#39;unsigned&#39;</span><span class="p">}})</span>
</pre></div>
</div>
<p>The following example shows how to create a space, format it with all
possible types, and insert into it.</p>
<div class="highlight-tarantoolsession notranslate"><div class="highlight"><pre><span></span>tarantool&gt; box.schema.space.create(&#39;t&#39;)
--- ...
tarantool&gt; box.space.t:format({{name=&#39;1&#39;,type=&#39;any&#39;},
         &gt;                     {name=&#39;2&#39;,type=&#39;unsigned&#39;},
         &gt;                     {name=&#39;3&#39;,type=&#39;string&#39;},
         &gt;                     {name=&#39;4&#39;,type=&#39;number&#39;},
         &gt;                     {name=&#39;5&#39;,type=&#39;integer&#39;},
         &gt;                     {name=&#39;6&#39;,type=&#39;boolean&#39;},
         &gt;                     {name=&#39;7&#39;,type=&#39;scalar&#39;},
         &gt;                     {name=&#39;8&#39;,type=&#39;array&#39;},
         &gt;                     {name=&#39;9&#39;,type=&#39;map&#39;}})
--- ...
tarantool&gt; box.space.t:create_index(&#39;i&#39;,{parts={2,&#39;unsigned&#39;}})
--- ...
tarantool&gt; box.space.t:insert{{&#39;a&#39;},      -- any
         &gt;                    1,          -- unsigned
         &gt;                    &#39;W?&#39;,       -- string
         &gt;                    5.5,        -- number
         &gt;                    -0,         -- integer
         &gt;                    true,       -- boolean
         &gt;                    true,       -- scalar
         &gt;                    {{&#39;a&#39;}},    -- array
         &gt;                    {val=1}}    -- map
---
- [[&#39;a&#39;], 1, &#39;W?&#39;, 5.5, 0, true, true, [[&#39;a&#39;]], {&#39;val&#39;: 1}]
...
</pre></div>
</div>
<p>Names specified with the format clause can be used in
<a class="reference internal" href="box_space_index.html#box-space-get"><span class="std std-ref">space_object:get()</span></a> and in
<a class="reference internal" href="box_space_index.html#box-space-create-index"><span class="std std-ref">space_object:create_index()</span></a> and in
<a class="reference internal" href="box_tuple.html#box-tuple-field-name"><span class="std std-ref">tuple_object[field-name]</span></a> and in
<a class="reference internal" href="box_tuple.html#box-tuple-field-path"><span class="std std-ref">tuple_object[field-path]</span></a>.</p>
<p>If the format clause is omitted, then the returned value is the
table that was used in a previous <code class="samp docutils literal notranslate"><em><span class="pre">space_object</span></em><span class="pre">:format(</span><em><span class="pre">format-clause</span></em><span class="pre">)</span></code>
invocation. For example, after <code class="docutils literal notranslate"><span class="pre">box.space.tester:format({{'x','scalar'}})</span></code>,
<code class="docutils literal notranslate"><span class="pre">box.space.tester:format()</span></code> will return <code class="docutils literal notranslate"><span class="pre">[{'name':</span> <span class="pre">'x',</span> <span class="pre">'type':</span> <span class="pre">'scalar'}]</span></code>.</p>
<p><strong>Note re storage engine:</strong> vinyl supports formatting of non-empty
spaces. Primary index definition cannot be formatted.</p>
</dd></dl>

<span class="target" id="box-space-frommap"></span><dl class="method">
<dt id="box.space.space_object.frommap">
<code class="descname">frommap</code><span class="sig-paren">(</span><em>map</em><span class="optional">[</span>, <em>option</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#box.space.space_object.frommap" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert a map to a tuple instance or to a table.
The map must consist of “field name = value” pairs.
The field names and the value types must match names and types
stated previously for the space, via
<a class="reference internal" href="box_space_index.html#box-space-format"><span class="std std-ref">space_object:format()</span></a>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>space_object</strong> (<a class="reference internal" href="box_space_index.html#box.space.space_object" title="box.space.space_object"><em>space_object</em></a>) – an <a class="reference internal" href="../lua_tips.html#app-server-object-reference"><span class="std std-ref">object reference</span></a></li>
<li><strong>map</strong> (<em>field-value-pairs</em>) – a series of “field = value” pairs, in any order.</li>
<li><strong>option</strong> (<em>boolean</em>) – the only legal option is <code class="docutils literal notranslate"><span class="pre">{table</span> <span class="pre">=</span> <span class="pre">true|false}</span></code>; <a href="#id39"><span class="problematic" id="id40">|br|</span></a>
if the option is omitted or if <code class="docutils literal notranslate"><span class="pre">{table</span> <span class="pre">=</span> <span class="pre">false}</span></code>,
then return type will be ‘cdata’ (i.e. tuple); <a href="#id41"><span class="problematic" id="id42">|br|</span></a>
if <code class="docutils literal notranslate"><span class="pre">{table</span> <span class="pre">=</span> <span class="pre">true}</span></code>, then return type will be ‘table’.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">a tuple instance or table.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">tuple or table</p>
</td>
</tr>
</tbody>
</table>
<p><strong>Possible errors:</strong> <code class="docutils literal notranslate"><span class="pre">space_object</span></code> does not exist or has no format; “unknown field”.</p>
<p><strong>Example:</strong></p>
<div class="highlight-tarantoolsession notranslate"><div class="highlight"><pre><span></span>-- Create a format with two fields named &#39;a&#39; and &#39;b&#39;.
-- Create a space with that format.
-- Create a tuple based on a map consistent with that space.
-- Create a table based on a map consistent with that space.
tarantool&gt; format1 = {{name=&#39;a&#39;,type=&#39;unsigned&#39;},{name=&#39;b&#39;,type=&#39;scalar&#39;}}
---
...
tarantool&gt; s = box.schema.create_space(&#39;test&#39;, {format = format1})
---
...
tarantool&gt; s:frommap({b = &#39;x&#39;, a = 123456})
---
- [123456, &#39;x&#39;]
...
tarantool&gt; s:frommap({b = &#39;x&#39;, a = 123456}, {table = true})
---
- - 123456
  - x
...
</pre></div>
</div>
</dd></dl>

<span class="target" id="box-space-get"></span><dl class="method">
<dt id="box.space.space_object.get">
<code class="descname">get</code><span class="sig-paren">(</span><em>key</em><span class="sig-paren">)</span><a class="headerlink" href="#box.space.space_object.get" title="Permalink to this definition">¶</a></dt>
<dd><p>Search for a tuple in the given space.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>space_object</strong> (<a class="reference internal" href="box_space_index.html#box.space.space_object" title="box.space.space_object"><em>space_object</em></a>) – an <a class="reference internal" href="../lua_tips.html#app-server-object-reference"><span class="std std-ref">object reference</span></a></li>
<li><strong>key</strong> (<em>scalar/table</em>) – value to be matched against the index
key, which may be multi-part.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">the tuple whose index key matches <code class="docutils literal notranslate"><span class="pre">key</span></code>, or <code class="docutils literal notranslate"><span class="pre">nil</span></code>.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">tuple</p>
</td>
</tr>
</tbody>
</table>
<p><strong>Possible errors:</strong> <code class="docutils literal notranslate"><span class="pre">space_object</span></code> does not exist.</p>
<p><strong>Complexity factors:</strong> Index size, Index type, Number of indexes
accessed, WAL settings.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">box.space...select</span></code> function returns a set of tuples as a Lua
table; the <code class="docutils literal notranslate"><span class="pre">box.space...get</span></code> function returns at most a single tuple.
And it is possible to get the first tuple in a space by appending
<code class="docutils literal notranslate"><span class="pre">[1]</span></code>. Therefore <code class="docutils literal notranslate"><span class="pre">box.space.tester:get{1}</span></code> has the same effect as
<code class="docutils literal notranslate"><span class="pre">box.space.tester:select{1}[1]</span></code>, if exactly one tuple is found.</p>
<p><strong>Example:</strong></p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="n">get</span><span class="p">{</span><span class="mi">1</span><span class="p">}</span>
</pre></div>
</div>
<p id="box-space-get-field-names"><strong>Using field names instead of field numbers:</strong> <cite>get()</cite> can use field names
described by the optional <a class="reference internal" href="box_space_index.html#box-space-format"><span class="std std-ref">space_object:format()</span></a> clause.
This is similar to a standard Lua feature, where a component can be referenced
by its name instead of its number.
For example, we can format the <cite>tester</cite> space
with a field named <cite>x</cite> and use the name <cite>x</cite> in the index definition:</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="n">format</span><span class="p">({{</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;scalar&#39;</span><span class="p">}})</span>
<span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="n">create_index</span><span class="p">(</span><span class="s1">&#39;I&#39;</span><span class="p">,{</span><span class="n">parts</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">}})</span>
</pre></div>
</div>
<p>Then, if <code class="docutils literal notranslate"><span class="pre">get</span></code> or <code class="docutils literal notranslate"><span class="pre">select</span></code> retrieve a single tuple,
we can reference the field ‘x’ in the tuple by its name:</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="n">get</span><span class="p">{</span><span class="mi">1</span><span class="p">}[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span>
<span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="nb">select</span><span class="p">{</span><span class="mi">1</span><span class="p">}[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;x&#39;</span><span class="p">]</span>
</pre></div>
</div>
</dd></dl>

<span class="target" id="box-space-insert"></span><dl class="method">
<dt id="box.space.space_object.insert">
<code class="descname">insert</code><span class="sig-paren">(</span><em>tuple</em><span class="sig-paren">)</span><a class="headerlink" href="#box.space.space_object.insert" title="Permalink to this definition">¶</a></dt>
<dd><p>Insert a tuple into a space.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>space_object</strong> (<a class="reference internal" href="box_space_index.html#box.space.space_object" title="box.space.space_object"><em>space_object</em></a>) – an <a class="reference internal" href="../lua_tips.html#app-server-object-reference"><span class="std std-ref">object reference</span></a></li>
<li><strong>tuple</strong> (<em>tuple/table</em>) – tuple to be inserted.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">the inserted tuple</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">tuple</p>
</td>
</tr>
</tbody>
</table>
<p><strong>Possible errors:</strong> <a href="#id1"><span class="problematic" id="id2">:errcode:`ER_TUPLE_FOUND`</span></a> if a tuple with the same unique-key value already
exists.</p>
<p><strong>Example:</strong></p>
<div class="highlight-tarantoolsession notranslate"><div class="highlight"><pre><span></span>tarantool&gt; box.space.tester:insert{5000,&#39;tuple number five thousand&#39;}
---
- [5000, &#39;tuple number five thousand&#39;]
...
</pre></div>
</div>
<p>For more usage scenarios and typical errors see
<a class="reference internal" href="box_space_index.html#box-space-operations-detailed-examples"><span class="std std-ref">Example: using data operations</span></a>
further in this section.</p>
</dd></dl>

<span class="target" id="box-space-len"></span><dl class="method">
<dt id="box.space.space_object.len">
<code class="descname">len</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#box.space.space_object.len" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the number of tuples in the space.
If compared with <a class="reference internal" href="box_space_index.html#box-space-count"><span class="std std-ref">count()</span></a>, this method works
faster because <code class="docutils literal notranslate"><span class="pre">len()</span></code> does not scan the entire space to count the
tuples.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>space_object</strong> (<a class="reference internal" href="box_space_index.html#box.space.space_object" title="box.space.space_object"><em>space_object</em></a>) – an <a class="reference internal" href="../lua_tips.html#app-server-object-reference"><span class="std std-ref">object reference</span></a></td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">Number of tuples in the space.</td>
</tr>
</tbody>
</table>
<p><strong>Example:</strong></p>
<div class="highlight-tarantoolsession notranslate"><div class="highlight"><pre><span></span>tarantool&gt; box.space.tester:len()
---
- 2
...
</pre></div>
</div>
<p><strong>Note re storage engine:</strong> vinyl supports <code class="docutils literal notranslate"><span class="pre">len()</span></code> but the result may be approximate.
If an exact result is necessary then use <a class="reference internal" href="box_space_index.html#box-space-count"><span class="std std-ref">count()</span></a>
or <a class="reference internal" href="box_space_index.html#box-space-pairs"><span class="std std-ref">pairs():length()</span></a>.</p>
</dd></dl>

<span class="target" id="box-space-on-replace"></span><dl class="method">
<dt id="box.space.space_object.on_replace">
<code class="descname">on_replace</code><span class="sig-paren">(</span><span class="optional">[</span><em>trigger-function</em><span class="optional">[</span>, <em>old-trigger-function</em><span class="optional">]</span><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#box.space.space_object.on_replace" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a “replace <a class="reference internal" href="../../book/box/triggers.html#triggers"><span class="std std-ref">trigger</span></a>”.
The <code class="docutils literal notranslate"><span class="pre">trigger-function</span></code> will be executed
whenever a <code class="docutils literal notranslate"><span class="pre">replace()</span></code> or <code class="docutils literal notranslate"><span class="pre">insert()</span></code> or <code class="docutils literal notranslate"><span class="pre">update()</span></code> or <code class="docutils literal notranslate"><span class="pre">upsert()</span></code>
or <code class="docutils literal notranslate"><span class="pre">delete()</span></code> happens to a tuple in <code class="docutils literal notranslate"><span class="pre">&lt;space-name&gt;</span></code>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>trigger-function</strong> (<em>function</em>) – function which will become the
trigger function; see Example #2
below for details about
trigger function parameters</li>
<li><strong>old-trigger-function</strong> (<em>function</em>) – existing trigger function which
will be replaced by
<code class="docutils literal notranslate"><span class="pre">trigger-function</span></code></li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">nil or function pointer</p>
</td>
</tr>
</tbody>
</table>
<p>If the parameters are (nil, old-trigger-function), then the old
trigger is deleted.</p>
<p>If both parameters are omitted, then the response is a list of existing
trigger functions.</p>
<p>If it is necessary to know whether the trigger activation
happened due to replication or on a specific connection type,
the function can refer to <a class="reference internal" href="box_session.html#box-session-type"><span class="std std-ref">box.session.type()</span></a>.</p>
<p>Details about trigger characteristics are in the
<a class="reference internal" href="../../book/box/triggers.html#triggers-box-triggers"><span class="std std-ref">triggers</span></a> section.</p>
<p>See also <a class="reference internal" href="box_space_index.html#box-space-before-replace"><span class="std std-ref">space_object:before_replace()</span></a>.</p>
<p><strong>Example #1:</strong></p>
<div class="highlight-tarantoolsession notranslate"><div class="highlight"><pre><span></span>tarantool&gt; function f ()
         &gt;   x = x + 1
         &gt; end
tarantool&gt; box.space.X:on_replace(f)
</pre></div>
</div>
<p><strong>Example #2:</strong></p>
<p>The <code class="docutils literal notranslate"><span class="pre">trigger-function</span></code> can have up to four parameters:</p>
<ul class="simple">
<li>(tuple) old value which has the contents before the request started,</li>
<li>(tuple) new value which has the contents after the request ended,</li>
<li>(string) space name,</li>
<li>(string) type of request which is ‘INSERT’, ‘DELETE’, ‘UPDATE’, or ‘REPLACE’.</li>
</ul>
<p>For example, the following code causes nil and ‘INSERT’ to be printed when the insert
request is processed, and causes [1, ‘Hi’] and ‘DELETE’ to be printed when the delete
request is processed:</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">box</span><span class="p">.</span><span class="n">schema</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="s1">&#39;space_1&#39;</span><span class="p">)</span>
<span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">space_1</span><span class="p">:</span><span class="n">create_index</span><span class="p">(</span><span class="s1">&#39;space_1_index&#39;</span><span class="p">,{})</span>
<span class="kr">function</span> <span class="nf">on_replace_function</span> <span class="p">(</span><span class="n">old</span><span class="p">,</span> <span class="n">new</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">op</span><span class="p">)</span> <span class="nb">print</span><span class="p">(</span><span class="n">old</span><span class="p">)</span> <span class="nb">print</span><span class="p">(</span><span class="n">op</span><span class="p">)</span> <span class="kr">end</span>
<span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">space_1</span><span class="p">:</span><span class="n">on_replace</span><span class="p">(</span><span class="n">on_replace_function</span><span class="p">)</span>
<span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">space_1</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;Hi&#39;</span><span class="p">}</span>
<span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">space_1</span><span class="p">:</span><span class="n">delete</span><span class="p">{</span><span class="mi">1</span><span class="p">}</span>
</pre></div>
</div>
<p><strong>Example #3:</strong></p>
<p>The following series of requests will create a space, create an index,
create a function which increments a counter, create a trigger, do two
inserts, drop the space, and display the counter value - which is 2,
because the function is executed once after each insert.</p>
<div class="highlight-tarantoolsession notranslate"><div class="highlight"><pre><span></span>tarantool&gt; s = box.schema.space.create(&#39;space53&#39;)
tarantool&gt; s:create_index(&#39;primary&#39;, {parts = {{field = 1, type = &#39;unsigned&#39;}}})
tarantool&gt; function replace_trigger()
         &gt;   replace_counter = replace_counter + 1
         &gt; end
tarantool&gt; s:on_replace(replace_trigger)
tarantool&gt; replace_counter = 0
tarantool&gt; t = s:insert{1, &#39;First replace&#39;}
tarantool&gt; t = s:insert{2, &#39;Second replace&#39;}
tarantool&gt; s:drop()
tarantool&gt; replace_counter
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<dl class="docutils">
<dt>You shouldn’t use in trigger-functions for <code class="docutils literal notranslate"><span class="pre">on_replace</span></code> and <code class="docutils literal notranslate"><span class="pre">before_replace</span></code></dt>
<dd><ul class="first last simple">
<li>transactions,</li>
<li>yield-oprations (<a class="reference internal" href="../../book/box/atomic_index.html#atomic-implicit-yields"><span class="std std-ref">explicit</span></a> or not),</li>
<li>actions that are not allowed to be used in transactions
(see <a class="reference internal" href="box_txn_management.html#box-txn-management"><span class="std std-ref">rule #2</span></a>)</li>
</ul>
</dd>
</dl>
<p>because everything executed inside triggers is already in a transaction.</p>
<p><strong>Example:</strong></p>
<div class="last highlight-tarantoolsession notranslate"><div class="highlight"><pre><span></span>tarantool&gt; box.space.test:on_replace(fiber.yield)
tarantool&gt; box.space.test:replace{1, 2, 3}
2020-02-02 21:22:03.073 [73185] main/102/init.lua txn.c:532 E&gt; ER_TRANSACTION_YIELD: Transaction has been aborted by a fiber yield
---
- error: Transaction has been aborted by a fiber yield
...
</pre></div>
</div>
</div>
</dd></dl>

<span class="target" id="box-space-before-replace"></span><dl class="method">
<dt id="box.space.space_object.before_replace">
<code class="descname">before_replace</code><span class="sig-paren">(</span><span class="optional">[</span><em>trigger-function</em><span class="optional">[</span>, <em>old-trigger-function</em><span class="optional">]</span><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#box.space.space_object.before_replace" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a “replace <a class="reference internal" href="../../book/box/triggers.html#triggers"><span class="std std-ref">trigger</span></a>”.
The <code class="docutils literal notranslate"><span class="pre">trigger-function</span></code> will be executed
whenever a <code class="docutils literal notranslate"><span class="pre">replace()</span></code> or <code class="docutils literal notranslate"><span class="pre">insert()</span></code> or <code class="docutils literal notranslate"><span class="pre">update()</span></code> or <code class="docutils literal notranslate"><span class="pre">upsert()</span></code>
or <code class="docutils literal notranslate"><span class="pre">delete()</span></code> happens to a tuple in <code class="docutils literal notranslate"><span class="pre">&lt;space-name&gt;</span></code>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>trigger-function</strong> (<em>function</em>) – function which will become the
trigger function; for the trigger
function’s optional parameters see
the description of
<a class="reference internal" href="box_space_index.html#box-space-on-replace"><span class="std std-ref">on_replace</span></a>.</li>
<li><strong>old-trigger-function</strong> (<em>function</em>) – existing trigger function which
will be replaced by
<code class="docutils literal notranslate"><span class="pre">trigger-function</span></code></li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">nil or function pointer</p>
</td>
</tr>
</tbody>
</table>
<p>If the parameters are <code class="docutils literal notranslate"><span class="pre">(nil,</span> <span class="pre">old-trigger-function)</span></code>, then the old
trigger is deleted.</p>
<p>If both parameters are omitted, then the response is a list of existing trigger functions.</p>
<p>If it is necessary to know whether the trigger activation
happened due to replication or on a specific connection type,
the function can refer to <a class="reference internal" href="box_session.html#box-session-type"><span class="std std-ref">box.session.type()</span></a>.</p>
<p>Details about trigger characteristics are in the
<a class="reference internal" href="../../book/box/triggers.html#triggers-box-triggers"><span class="std std-ref">triggers</span></a> section.</p>
<p>See also <a class="reference internal" href="box_space_index.html#box-space-on-replace"><span class="std std-ref">space_object:on_replace()</span></a>.</p>
<p>Administrators can make replace triggers with <code class="docutils literal notranslate"><span class="pre">on_replace()</span></code>,
or make triggers with <code class="docutils literal notranslate"><span class="pre">before_replace()</span></code>.
If they make both types, then all <code class="docutils literal notranslate"><span class="pre">before_replace</span></code> triggers
are executed before all <code class="docutils literal notranslate"><span class="pre">on_replace</span></code> triggers.
The functions for both <code class="docutils literal notranslate"><span class="pre">on_replace</span></code> and <code class="docutils literal notranslate"><span class="pre">before_replace</span></code>
triggers can make changes to the database, but only the
functions for <code class="docutils literal notranslate"><span class="pre">before_replace</span></code> triggers can change the
tuple that is being replaced.</p>
<p>Since a <code class="docutils literal notranslate"><span class="pre">before_replace</span></code> trigger function has the extra
capability of making a change to the old tuple, it also can have
extra overhead, to fetch the old tuple before making the
change. Therefore an <code class="docutils literal notranslate"><span class="pre">on_replace</span></code> trigger is better if
there is no need to change the old tuple. However, this
only applies for the memtx engine – for the vinyl engine,
the fetch will happen for either kind of trigger.
(With memtx the tuple data is stored along with the
index key so no extra search is necessary;
with vinyl that is not the case so the extra search
is necessary.)</p>
<p>Where the extra capability is not needed,
<code class="docutils literal notranslate"><span class="pre">on_replace</span></code> should be used instead of <code class="docutils literal notranslate"><span class="pre">before_replace</span></code>.
Usually <code class="docutils literal notranslate"><span class="pre">before_replace</span></code> is used only for certain
replication scenarios – it is useful for conflict resolution.</p>
<p>The value that a <code class="docutils literal notranslate"><span class="pre">before_replace</span></code> trigger function can return
affects what will happen after the return. Specifically:</p>
<ul class="simple">
<li>if there is no return value, then execution proceeds,
inserting|replacing the new value;</li>
<li>if the value is nil, then the tuple will be deleted;</li>
<li>if the value is the same as the old parameter, then no
<code class="docutils literal notranslate"><span class="pre">on_replace</span></code> function will be called and the data
change will be skipped. The return value will be absent.</li>
<li>if the value is the same as the new parameter, then it’s as if
the <code class="docutils literal notranslate"><span class="pre">before_replace</span></code> function wasn’t called;</li>
<li>if the value is some other tuple, then it is used for insert/replace.</li>
</ul>
<p>However, if a trigger function returns an old tuple, or if a
trigger function calls <a class="reference internal" href="box_space_index.html#box-space-run-triggers"><span class="std std-ref">run_triggers(false)</span></a>,
that will not affect other triggers that are activated for the same
insert|update|replace request.</p>
<p><strong>Example:</strong></p>
<p>The following are <code class="docutils literal notranslate"><span class="pre">before_replace</span></code> functions that have no return
value, or that return nil, or the same as the old parameter, or the
same as the new parameter, or something else.</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="kr">function</span> <span class="nf">f1</span> <span class="p">(</span><span class="n">old</span><span class="p">,</span> <span class="n">new</span><span class="p">)</span> <span class="kr">return</span> <span class="kr">end</span>
<span class="kr">function</span> <span class="nf">f2</span> <span class="p">(</span><span class="n">old</span><span class="p">,</span> <span class="n">new</span><span class="p">)</span> <span class="kr">return</span> <span class="kc">nil</span> <span class="kr">end</span>
<span class="kr">function</span> <span class="nf">f3</span> <span class="p">(</span><span class="n">old</span><span class="p">,</span> <span class="n">new</span><span class="p">)</span> <span class="kr">return</span> <span class="n">old</span> <span class="kr">end</span>
<span class="kr">function</span> <span class="nf">f4</span> <span class="p">(</span><span class="n">old</span><span class="p">,</span> <span class="n">new</span><span class="p">)</span> <span class="kr">return</span> <span class="n">new</span> <span class="kr">end</span>
<span class="kr">function</span> <span class="nf">f5</span> <span class="p">(</span><span class="n">old</span><span class="p">,</span> <span class="n">new</span><span class="p">)</span> <span class="kr">return</span> <span class="n">box</span><span class="p">.</span><span class="n">tuple</span><span class="p">.</span><span class="n">new</span><span class="p">({</span><span class="n">new</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;b&#39;</span><span class="p">})</span> <span class="kr">end</span>
</pre></div>
</div>
</dd></dl>

<span class="target" id="box-space-pairs"></span><dl class="method">
<dt id="box.space.space_object.pairs">
<code class="descname">pairs</code><span class="sig-paren">(</span><span class="optional">[</span><em>key</em><span class="optional">[</span>, <em>iterator</em><span class="optional">]</span><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#box.space.space_object.pairs" title="Permalink to this definition">¶</a></dt>
<dd><p>Search for a tuple or a set of tuples in the given space, and allow
iterating over one tuple at a time.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>space_object</strong> (<a class="reference internal" href="box_space_index.html#box.space.space_object" title="box.space.space_object"><em>space_object</em></a>) – an <a class="reference internal" href="../lua_tips.html#app-server-object-reference"><span class="std std-ref">object reference</span></a></li>
<li><strong>key</strong> (<em>scalar/table</em>) – value to be matched against the index key,
which may be multi-part</li>
<li><strong>iterator</strong> – see <a class="reference internal" href="box_index.html#box-index-index-pairs"><span class="std std-ref">index_object:pairs</span></a></li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><a class="reference external" href="https://www.lua.org/pil/7.1.html">iterator</a> which can be
used in a for/end loop or with <a class="reference external" href="https://luafun.github.io/reducing.html#fun.totable">totable()</a></p>
</td>
</tr>
</tbody>
</table>
<p><strong>Possible errors:</strong></p>
<ul class="simple">
<li>no such space;</li>
<li>wrong type.</li>
</ul>
<p><strong>Complexity factors:</strong> Index size, Index type.</p>
<p>For examples of complex <code class="docutils literal notranslate"><span class="pre">pairs</span></code> requests, where one can specify which
index to search and what condition to use (for example “greater than”
instead of “equal to”), see the later section <a class="reference internal" href="box_index.html#box-index-index-pairs"><span class="std std-ref">index_object:pairs</span></a>.</p>
<p>For information about iterators’ internal structures see the
<a class="reference external" href="https://luafun.github.io/index.html">“Lua Functional library”</a>
documentation.</p>
<p><strong>Example:</strong></p>
<div class="highlight-tarantoolsession notranslate"><div class="highlight"><pre><span></span>tarantool&gt; s = box.schema.space.create(&#39;space33&#39;)
---
...
tarantool&gt; -- index &#39;X&#39; has default parts {1, &#39;unsigned&#39;}
tarantool&gt; s:create_index(&#39;X&#39;, {})
---
...
tarantool&gt; s:insert{0, &#39;Hello my &#39;}, s:insert{1, &#39;Lua world&#39;}
---
- [0, &#39;Hello my &#39;]
- [1, &#39;Lua world&#39;]
...
tarantool&gt; tmp = &#39;&#39;
---
...
tarantool&gt; for k, v in s:pairs() do
         &gt;   tmp = tmp .. v[2]
         &gt; end
---
...
tarantool&gt; tmp
---
- Hello my Lua world
...
</pre></div>
</div>
</dd></dl>

<span class="target" id="box-space-rename"></span><dl class="method">
<dt id="box.space.space_object.rename">
<code class="descname">rename</code><span class="sig-paren">(</span><em>space-name</em><span class="sig-paren">)</span><a class="headerlink" href="#box.space.space_object.rename" title="Permalink to this definition">¶</a></dt>
<dd><p>Rename a space.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>space_object</strong> (<a class="reference internal" href="box_space_index.html#box.space.space_object" title="box.space.space_object"><em>space_object</em></a>) – an <a class="reference internal" href="../lua_tips.html#app-server-object-reference"><span class="std std-ref">object reference</span></a></li>
<li><strong>space-name</strong> (<em>string</em>) – new name for space</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">nil</p>
</td>
</tr>
</tbody>
</table>
<p><strong>Possible errors:</strong> <code class="docutils literal notranslate"><span class="pre">space_object</span></code> does not exist.</p>
<p><strong>Example:</strong></p>
<div class="highlight-tarantoolsession notranslate"><div class="highlight"><pre><span></span>tarantool&gt; box.space.space55:rename(&#39;space56&#39;)
---
...
tarantool&gt; box.space.space56:rename(&#39;space55&#39;)
---
...
</pre></div>
</div>
</dd></dl>

<span class="target" id="box-space-replace"></span><dl class="method">
<dt id="box.space.space_object.replace">
<code class="descname">replace</code><span class="sig-paren">(</span><em>tuple</em><span class="sig-paren">)</span><a class="headerlink" href="#box.space.space_object.replace" title="Permalink to this definition">¶</a></dt>
<dt id="box.space.space_object.put">
<code class="descname">put</code><span class="sig-paren">(</span><em>tuple</em><span class="sig-paren">)</span><a class="headerlink" href="#box.space.space_object.put" title="Permalink to this definition">¶</a></dt>
<dd><p>Insert a tuple into a space. If a tuple with the same primary key already
exists, <code class="docutils literal notranslate"><span class="pre">box.space...:replace()</span></code> replaces the existing tuple with a new
one. The syntax variants <code class="docutils literal notranslate"><span class="pre">box.space...:replace()</span></code> and
<code class="docutils literal notranslate"><span class="pre">box.space...:put()</span></code> have the same effect; the latter is sometimes used
to show that the effect is the converse of <code class="docutils literal notranslate"><span class="pre">box.space...:get()</span></code>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>space_object</strong> (<a class="reference internal" href="box_space_index.html#box.space.space_object" title="box.space.space_object"><em>space_object</em></a>) – an <a class="reference internal" href="../lua_tips.html#app-server-object-reference"><span class="std std-ref">object reference</span></a></li>
<li><strong>tuple</strong> (<em>table/tuple</em>) – tuple to be inserted</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">the inserted tuple.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">tuple</p>
</td>
</tr>
</tbody>
</table>
<p><strong>Possible errors:</strong> <a href="#id3"><span class="problematic" id="id4">:errcode:`ER_TUPLE_FOUND`</span></a> if a different tuple with the same unique-key
value already exists. (This
will only happen if there is a unique secondary index.)</p>
<p><strong>Complexity factors:</strong> Index size, Index type,
Number of indexes accessed, WAL settings.</p>
<p><strong>Example:</strong></p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="n">replace</span><span class="p">{</span><span class="mi">5000</span><span class="p">,</span> <span class="s1">&#39;tuple number five thousand&#39;</span><span class="p">}</span>
</pre></div>
</div>
<p>For more usage scenarios and typical errors see
<a class="reference internal" href="box_space_index.html#box-space-operations-detailed-examples"><span class="std std-ref">Example: using data operations</span></a>
further in this section.</p>
</dd></dl>

<span class="target" id="box-space-run-triggers"></span><dl class="method">
<dt id="box.space.space_object.run_triggers">
<code class="descname">run_triggers</code><span class="sig-paren">(</span><em>true|false</em><span class="sig-paren">)</span><a class="headerlink" href="#box.space.space_object.run_triggers" title="Permalink to this definition">¶</a></dt>
<dd><p>At the time that a <a class="reference internal" href="../../book/box/triggers.html#triggers"><span class="std std-ref">trigger</span></a> is defined, it is automatically enabled -
that is, it will be executed. <a class="reference internal" href="box_space_index.html#box-space-on-replace"><span class="std std-ref">Replace</span></a> triggers can be disabled with
<code class="samp docutils literal notranslate"><span class="pre">box.space.</span><em><span class="pre">space-name</span></em><span class="pre">:run_triggers(false)</span></code> and re-enabled with
<code class="samp docutils literal notranslate"><span class="pre">box.space.</span><em><span class="pre">space-name</span></em><span class="pre">:run_triggers(true)</span></code>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">nil</td>
</tr>
</tbody>
</table>
<p><strong>Example:</strong></p>
<p>The following series of requests will associate an existing function named <cite>F</cite>
with an existing space named <cite>T</cite>, associate the function a second time with the
same space (so it will be called twice), disable all triggers of <cite>T</cite>, and delete
each trigger by replacing with <code class="docutils literal notranslate"><span class="pre">nil</span></code>.</p>
<div class="highlight-tarantoolsession notranslate"><div class="highlight"><pre><span></span>tarantool&gt; box.space.T:on_replace(F)
tarantool&gt; box.space.T:on_replace(F)
tarantool&gt; box.space.T:run_triggers(false)
tarantool&gt; box.space.T:on_replace(nil, F)
tarantool&gt; box.space.T:on_replace(nil, F)
</pre></div>
</div>
</dd></dl>

<span class="target" id="box-space-select"></span><dl class="method">
<dt id="box.space.space_object.select">
<code class="descname">select</code><span class="sig-paren">(</span><span class="optional">[</span><em>key</em><span class="optional">[</span>, <em>options</em><span class="optional">]</span><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#box.space.space_object.select" title="Permalink to this definition">¶</a></dt>
<dd><p>Search for a tuple or a set of tuples in the given space. This method
doesn’t yield (for details see <a class="reference internal" href="../../book/box/atomic_index.html#atomic-cooperative-multitasking"><span class="std std-ref">Сooperative multitasking</span></a>).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>space_object</strong> (<a class="reference internal" href="box_space_index.html#box.space.space_object" title="box.space.space_object"><em>space_object</em></a>) – an <a class="reference internal" href="../lua_tips.html#app-server-object-reference"><span class="std std-ref">object reference</span></a></li>
<li><strong>key</strong> (<em>scalar/table</em>) – value to be matched against the index
key, which may be multi-part.</li>
<li><strong>options</strong> (<em>table/nil</em>) – <p>none, any or all of the same options that
<a class="reference internal" href="box_index.html#box-index-select"><span class="std std-ref">index_object:select</span></a>
allows:</p>
<ul>
<li><code class="docutils literal notranslate"><span class="pre">options.iterator</span></code> (<a class="reference internal" href="box_index.html#box-index-iterator-types"><span class="std std-ref">type of iterator</span></a>)</li>
<li><code class="docutils literal notranslate"><span class="pre">options.limit</span></code> (maximum number of tuples)</li>
<li><code class="docutils literal notranslate"><span class="pre">options.offset</span></code> (number of tuples to skip)</li>
</ul>
</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">the tuples whose primary-key fields are equal to the fields of
the passed key. If the number of passed fields is less than the
number of fields in the primary key, then only the passed
fields are compared, so <code class="docutils literal notranslate"><span class="pre">select{1,2}</span></code> will match a tuple
whose primary key is <code class="docutils literal notranslate"><span class="pre">{1,2,3}</span></code>.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">array of tuples</p>
</td>
</tr>
</tbody>
</table>
<p>A <code class="docutils literal notranslate"><span class="pre">select</span></code> request can also be done with a specific index and index
options, which are the subject of <a class="reference internal" href="box_index.html#box-index-select"><span class="std std-ref">index_object:select</span></a>.</p>
<p><strong>Possible errors:</strong></p>
<ul class="simple">
<li>no such space;</li>
<li>wrong type.</li>
</ul>
<p><strong>Complexity factors:</strong> Index size, Index type.</p>
<p><strong>Example:</strong></p>
<div class="highlight-tarantoolsession notranslate"><div class="highlight"><pre><span></span>tarantool&gt; s = box.schema.space.create(&#39;tmp&#39;, {temporary=true})
---
...
tarantool&gt; s:create_index(&#39;primary&#39;,{parts = { {field = 1, type = &#39;unsigned&#39;}, {field = 2, type = &#39;string&#39;}} })
---
...
tarantool&gt; s:insert{1,&#39;A&#39;}
---
- [1, &#39;A&#39;]
...
tarantool&gt; s:insert{1,&#39;B&#39;}
---
- [1, &#39;B&#39;]
...
tarantool&gt; s:insert{1,&#39;C&#39;}
---
- [1, &#39;C&#39;]
...
tarantool&gt; s:insert{2,&#39;D&#39;}
---
- [2, &#39;D&#39;]
...
tarantool&gt; -- must equal both primary-key fields
tarantool&gt; s:select{1,&#39;B&#39;}
---
- - [1, &#39;B&#39;]
...
tarantool&gt; -- must equal only one primary-key field
tarantool&gt; s:select{1}
---
- - [1, &#39;A&#39;]
  - [1, &#39;B&#39;]
  - [1, &#39;C&#39;]
...
tarantool&gt; -- must equal 0 fields, so returns all tuples
tarantool&gt; s:select{}
---
- - [1, &#39;A&#39;]
  - [1, &#39;B&#39;]
  - [1, &#39;C&#39;]
  - [2, &#39;D&#39;]
...
tarantool&gt; -- the first field must be greater than 0, and
tarantool&gt; -- skip the first tuple, and return up to
tarantool&gt; -- 2 tuples. This example&#39;s options all
tarantool&gt; -- depend on index characteristics so see
tarantool&gt; -- more explanation in index_object:select().
tarantool&gt; s:select({0},{iterator=&#39;GT&#39;,offset=1,limit=2})
---
- - [1, &#39;B&#39;]
  - [1, &#39;C&#39;]
...
</pre></div>
</div>
<p>As the last request in the above example shows:
to make complex <code class="docutils literal notranslate"><span class="pre">select</span></code> requests, where you can specify which
index to search and what condition to use (for example “greater than”
instead of “equal to”) and how many tuples to return, it will be
necessary to become familiar with <a class="reference internal" href="box_index.html#box-index-select"><span class="std std-ref">index_object:select</span></a>.</p>
<p>Remember that you can get a field from a tuple both by field number and by
field name which is more convenient. See example: <a class="reference internal" href="box_space_index.html#box-space-get-field-names"><span class="std std-ref">using field names
instead of field numbers</span></a>.</p>
<p>For more usage scenarios and typical errors see
<a class="reference internal" href="box_space_index.html#box-space-operations-detailed-examples"><span class="std std-ref">Example: using data operations</span></a>
further in this section.</p>
</dd></dl>

<span class="target" id="box-space-truncate"></span><dl class="method">
<dt id="box.space.space_object.truncate">
<code class="descname">truncate</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#box.space.space_object.truncate" title="Permalink to this definition">¶</a></dt>
<dd><p>Deletes all tuples. The method is performed in background and doesn’t
block consequent requests.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>space_object</strong> (<a class="reference internal" href="box_space_index.html#box.space.space_object" title="box.space.space_object"><em>space_object</em></a>) – an <a class="reference internal" href="../lua_tips.html#app-server-object-reference"><span class="std std-ref">object reference</span></a></td>
</tr>
</tbody>
</table>
<p><strong>Complexity factors:</strong> Index size, Index type, Number of tuples accessed.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">nil</td>
</tr>
</tbody>
</table>
<p>The <code class="docutils literal notranslate"><span class="pre">truncate</span></code> method can only be called by the user who created
the space, or from within a <code class="docutils literal notranslate"><span class="pre">setuid</span></code> function created by the user
who created the space.
Read more about <cite>setuid</cite> functions in the reference for
<a class="reference internal" href="box_schema.html#box-schema-func-create"><span class="std std-ref">box.schema.func.create()</span></a>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">truncate</span></code> method cannot be called from within a transaction.</p>
<p><strong>Example:</strong></p>
<div class="highlight-tarantoolsession notranslate"><div class="highlight"><pre><span></span>tarantool&gt; box.space.tester:truncate()
---
...
tarantool&gt; box.space.tester:len()
---
- 0
...
</pre></div>
</div>
</dd></dl>

<span class="target" id="box-space-update"></span><dl class="method">
<dt id="box.space.space_object.update">
<code class="descname">update</code><span class="sig-paren">(</span><em>key</em>, <em>{{operator</em>, <em>field_no</em>, <em>value}</em>, <em>...}</em><span class="sig-paren">)</span><a class="headerlink" href="#box.space.space_object.update" title="Permalink to this definition">¶</a></dt>
<dd><p>Update a tuple.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">update</span></code> function supports operations on fields — assignment,
arithmetic (if the field is numeric), cutting and pasting
fragments of a field, deleting or inserting a field. Multiple
operations can be combined in a single update request, and in this
case they are performed atomically and sequentially. Each operation
requires specification of a field number. When multiple operations
are present, the field number for each operation is assumed to be
relative to the most recent state of the tuple, that is, as if all
previous operations in a multi-operation update have already been
applied. In other words, it is always safe to merge multiple <code class="docutils literal notranslate"><span class="pre">update</span></code>
invocations into a single invocation, with no change in semantics.</p>
<p>Tarantool does nothing if a tuple with the specified primary key is not found.</p>
<p>Possible operators are:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">+</span></code> for addition (values must be numeric)</li>
<li><code class="docutils literal notranslate"><span class="pre">-</span></code> for subtraction (values must be numeric)</li>
<li><code class="docutils literal notranslate"><span class="pre">&amp;</span></code> for bitwise AND (values must be unsigned numeric)</li>
<li><code class="docutils literal notranslate"><span class="pre">|</span></code> for bitwise OR (values must be unsigned numeric)</li>
<li><code class="docutils literal notranslate"><span class="pre">^</span></code> for bitwise <abbr title="exclusive OR">XOR</abbr> (values must be
unsigned numeric)</li>
<li><code class="docutils literal notranslate"><span class="pre">:</span></code> for string splice</li>
<li><code class="docutils literal notranslate"><span class="pre">!</span></code> for insertion</li>
<li><code class="docutils literal notranslate"><span class="pre">#</span></code> for deletion</li>
<li><code class="docutils literal notranslate"><span class="pre">=</span></code> for assignment</li>
</ul>
</div></blockquote>
<p>For <code class="docutils literal notranslate"><span class="pre">!</span></code> and <code class="docutils literal notranslate"><span class="pre">=</span></code> operations the field number can be <code class="docutils literal notranslate"><span class="pre">-1</span></code>, meaning
the last field in the tuple.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>space_object</strong> (<a class="reference internal" href="box_space_index.html#box.space.space_object" title="box.space.space_object"><em>space_object</em></a>) – an <a class="reference internal" href="../lua_tips.html#app-server-object-reference"><span class="std std-ref">object reference</span></a></li>
<li><strong>key</strong> (<em>scalar/table</em>) – primary-key field values, must be passed as a
Lua table if key is multi-part</li>
<li><strong>operator</strong> (<em>string</em>) – operation type represented in string</li>
<li><strong>field_no</strong> (<em>number</em>) – what field the operation will apply to. The
field number can be negative, meaning the
position from the end of tuple.
(#tuple + negative field number + 1)</li>
<li><strong>value</strong> (<em>lua_value</em>) – what value will be applied</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><ul class="simple">
<li>the updated tuple</li>
<li>nil if the key is not found</li>
</ul>
</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">tuple or nil</p>
</td>
</tr>
</tbody>
</table>
<p><strong>Possible errors:</strong> it is illegal to modify a primary-key field.</p>
<p><strong>Complexity factors:</strong> Index size, Index type, number of indexes
accessed, WAL settings.</p>
<p>Thus, in the instruction:</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">s</span><span class="p">:</span><span class="n">update</span><span class="p">(</span><span class="mi">44</span><span class="p">,</span> <span class="p">{{</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">55</span> <span class="p">},</span> <span class="p">{</span><span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">}})</span>
</pre></div>
</div>
<p>the primary-key value is <code class="docutils literal notranslate"><span class="pre">44</span></code>, the operators are <code class="docutils literal notranslate"><span class="pre">'+'</span></code> and <code class="docutils literal notranslate"><span class="pre">'='</span></code>
meaning <em>add a value to a field and then assign a value to a field</em>, the
first affected field is field <code class="docutils literal notranslate"><span class="pre">1</span></code> and the value which will be added to
it is <code class="docutils literal notranslate"><span class="pre">55</span></code>, the second affected field is field <code class="docutils literal notranslate"><span class="pre">3</span></code> and the value
which will be assigned to it is <code class="docutils literal notranslate"><span class="pre">'x'</span></code>.</p>
<p><strong>Example:</strong></p>
<p>Assume that initially there is a space named <code class="docutils literal notranslate"><span class="pre">tester</span></code> with a
primary-key index whose type is <code class="docutils literal notranslate"><span class="pre">unsigned</span></code>. There is one tuple, with
<code class="docutils literal notranslate"><span class="pre">field[1]</span></code> = <code class="docutils literal notranslate"><span class="pre">999</span></code> and <code class="docutils literal notranslate"><span class="pre">field[2]</span></code> = <code class="docutils literal notranslate"><span class="pre">'A'</span></code>.</p>
<p>In the update: <a href="#id43"><span class="problematic" id="id44">|br|</span></a>
<code class="docutils literal notranslate"><span class="pre">box.space.tester:update(999,</span> <span class="pre">{{'=',</span> <span class="pre">2,</span> <span class="pre">'B'}})</span></code> <a href="#id45"><span class="problematic" id="id46">|br|</span></a>
The first argument is <code class="docutils literal notranslate"><span class="pre">tester</span></code>, that is, the affected space is <code class="docutils literal notranslate"><span class="pre">tester</span></code>.
The second argument is <code class="docutils literal notranslate"><span class="pre">999</span></code>, that is, the affected tuple is identified by
primary key value = 999.
The third argument is <code class="docutils literal notranslate"><span class="pre">=</span></code>, that is, there is one operation —
<em>assignment to a field</em>.
The fourth argument is <code class="docutils literal notranslate"><span class="pre">2</span></code>, that is, the affected field is <code class="docutils literal notranslate"><span class="pre">field[2]</span></code>.
The fifth argument is <code class="docutils literal notranslate"><span class="pre">'B'</span></code>, that is, <code class="docutils literal notranslate"><span class="pre">field[2]</span></code> contents change to <code class="docutils literal notranslate"><span class="pre">'B'</span></code>.
Therefore, after this update, <code class="docutils literal notranslate"><span class="pre">field[1]</span></code> = <code class="docutils literal notranslate"><span class="pre">999</span></code> and <code class="docutils literal notranslate"><span class="pre">field[2]</span></code> = <code class="docutils literal notranslate"><span class="pre">'B'</span></code>.</p>
<p>In the update: <a href="#id47"><span class="problematic" id="id48">|br|</span></a>
<code class="docutils literal notranslate"><span class="pre">box.space.tester:update({999},</span> <span class="pre">{{'=',</span> <span class="pre">2,</span> <span class="pre">'B'}})</span></code> <a href="#id49"><span class="problematic" id="id50">|br|</span></a>
the arguments are the same, except that the key is passed as a Lua table
(inside braces). This is unnecessary when the primary key has only one
field, but would be necessary if the primary key had more than one field.
Therefore, after this update, <code class="docutils literal notranslate"><span class="pre">field[1]</span></code> = <code class="docutils literal notranslate"><span class="pre">999</span></code> and <code class="docutils literal notranslate"><span class="pre">field[2]</span></code> = <code class="docutils literal notranslate"><span class="pre">'B'</span></code> (no change).</p>
<p>In the update: <a href="#id51"><span class="problematic" id="id52">|br|</span></a>
<code class="docutils literal notranslate"><span class="pre">box.space.tester:update({999},</span> <span class="pre">{{'=',</span> <span class="pre">3,</span> <span class="pre">1}})</span></code> <a href="#id53"><span class="problematic" id="id54">|br|</span></a>
the arguments are the same, except that the fourth argument is <code class="docutils literal notranslate"><span class="pre">3</span></code>,
that is, the affected field is <code class="docutils literal notranslate"><span class="pre">field[3]</span></code>. It is okay that, until now,
<code class="docutils literal notranslate"><span class="pre">field[3]</span></code> has not existed. It gets added. Therefore, after this update,
<code class="docutils literal notranslate"><span class="pre">field[1]</span></code> = <code class="docutils literal notranslate"><span class="pre">999</span></code>, <code class="docutils literal notranslate"><span class="pre">field[2]</span></code> = <code class="docutils literal notranslate"><span class="pre">'B'</span></code>, <code class="docutils literal notranslate"><span class="pre">field[3]</span></code> = <code class="docutils literal notranslate"><span class="pre">1</span></code>.</p>
<p>In the update: <a href="#id55"><span class="problematic" id="id56">|br|</span></a>
<code class="docutils literal notranslate"><span class="pre">box.space.tester:update({999},</span> <span class="pre">{{'+',</span> <span class="pre">3,</span> <span class="pre">1}})</span></code> <a href="#id57"><span class="problematic" id="id58">|br|</span></a>
the arguments are the same, except that the third argument is <code class="docutils literal notranslate"><span class="pre">'+'</span></code>,
that is, the operation is addition rather than assignment. Since
<code class="docutils literal notranslate"><span class="pre">field[3]</span></code> previously contained <code class="docutils literal notranslate"><span class="pre">1</span></code>, this means we’re adding <code class="docutils literal notranslate"><span class="pre">1</span></code>
to <code class="docutils literal notranslate"><span class="pre">1</span></code>. Therefore, after this update, <code class="docutils literal notranslate"><span class="pre">field[1]</span></code> = <code class="docutils literal notranslate"><span class="pre">999</span></code>,
<code class="docutils literal notranslate"><span class="pre">field[2]</span></code> = <code class="docutils literal notranslate"><span class="pre">'B'</span></code>, <code class="docutils literal notranslate"><span class="pre">field[3]</span></code> = <code class="docutils literal notranslate"><span class="pre">2</span></code>.</p>
<p>In the update: <a href="#id59"><span class="problematic" id="id60">|br|</span></a>
<code class="docutils literal notranslate"><span class="pre">box.space.tester:update({999},</span> <span class="pre">{{'|',</span> <span class="pre">3,</span> <span class="pre">1},</span> <span class="pre">{'=',</span> <span class="pre">2,</span> <span class="pre">'C'}})</span></code> <a href="#id61"><span class="problematic" id="id62">|br|</span></a>
the idea is to modify two fields at once. The formats are <code class="docutils literal notranslate"><span class="pre">'|'</span></code> and
<code class="docutils literal notranslate"><span class="pre">=</span></code>, that is, there are two operations, OR and assignment. The fourth
and fifth arguments mean that <code class="docutils literal notranslate"><span class="pre">field[3]</span></code> gets OR’ed with <code class="docutils literal notranslate"><span class="pre">1</span></code>. The
seventh and eighth arguments mean that <code class="docutils literal notranslate"><span class="pre">field[2]</span></code> gets assigned <code class="docutils literal notranslate"><span class="pre">'C'</span></code>.
Therefore, after this update, <code class="docutils literal notranslate"><span class="pre">field[1]</span></code> = <code class="docutils literal notranslate"><span class="pre">999</span></code>, <code class="docutils literal notranslate"><span class="pre">field[2]</span></code> = <code class="docutils literal notranslate"><span class="pre">'C'</span></code>,
<code class="docutils literal notranslate"><span class="pre">field[3]</span></code> = <code class="docutils literal notranslate"><span class="pre">3</span></code>.</p>
<p>In the update: <a href="#id63"><span class="problematic" id="id64">|br|</span></a>
<code class="docutils literal notranslate"><span class="pre">box.space.tester:update({999},</span> <span class="pre">{{'#',</span> <span class="pre">2,</span> <span class="pre">1},</span> <span class="pre">{'-',</span> <span class="pre">2,</span> <span class="pre">3}})</span></code> <a href="#id65"><span class="problematic" id="id66">|br|</span></a>
The idea is to delete <code class="docutils literal notranslate"><span class="pre">field[2]</span></code>, then subtract <code class="docutils literal notranslate"><span class="pre">3</span></code> from <code class="docutils literal notranslate"><span class="pre">field[3]</span></code>.
But after the delete, there is a renumbering, so <code class="docutils literal notranslate"><span class="pre">field[3]</span></code> becomes
<code class="docutils literal notranslate"><span class="pre">field[2]</span></code> before we subtract <code class="docutils literal notranslate"><span class="pre">3</span></code> from it, and that’s why the
seventh argument is <code class="docutils literal notranslate"><span class="pre">2</span></code>, not <code class="docutils literal notranslate"><span class="pre">3</span></code>. Therefore, after this update,
<code class="docutils literal notranslate"><span class="pre">field[1]</span></code> = <code class="docutils literal notranslate"><span class="pre">999</span></code>, <code class="docutils literal notranslate"><span class="pre">field[2]</span></code> = <code class="docutils literal notranslate"><span class="pre">0</span></code>.</p>
<p>In the update: <a href="#id67"><span class="problematic" id="id68">|br|</span></a>
<code class="docutils literal notranslate"><span class="pre">box.space.tester:update({999},</span> <span class="pre">{{'=',</span> <span class="pre">2,</span> <span class="pre">'XYZ'}})</span></code> <a href="#id69"><span class="problematic" id="id70">|br|</span></a>
we’re making a long string so that splice will work in the next example.
Therefore, after this update, <code class="docutils literal notranslate"><span class="pre">field[1]</span></code> = <code class="docutils literal notranslate"><span class="pre">999</span></code>, <code class="docutils literal notranslate"><span class="pre">field[2]</span></code> = <code class="docutils literal notranslate"><span class="pre">'XYZ'</span></code>.</p>
<p>In the update: <a href="#id71"><span class="problematic" id="id72">|br|</span></a>
<code class="docutils literal notranslate"><span class="pre">box.space.tester:update({999},</span> <span class="pre">{{':',</span> <span class="pre">2,</span> <span class="pre">2,</span> <span class="pre">1,</span> <span class="pre">'!!'}})</span></code> <a href="#id73"><span class="problematic" id="id74">|br|</span></a>
The third argument is <code class="docutils literal notranslate"><span class="pre">':'</span></code>, that is, this is the example of splice.
The fourth argument is <code class="docutils literal notranslate"><span class="pre">2</span></code> because the change will occur in <code class="docutils literal notranslate"><span class="pre">field[2]</span></code>.
The fifth argument is 2 because deletion will begin with the second byte.
The sixth argument is 1 because the number of bytes to delete is 1.
The seventh argument is <code class="docutils literal notranslate"><span class="pre">'!!'</span></code>, because <code class="docutils literal notranslate"><span class="pre">'!!'</span></code> is to be added at this position.
Therefore, after this update, <code class="docutils literal notranslate"><span class="pre">field[1]</span></code> = <code class="docutils literal notranslate"><span class="pre">999</span></code>, <code class="docutils literal notranslate"><span class="pre">field[2]</span></code> = <code class="docutils literal notranslate"><span class="pre">'X!!Z'</span></code>.</p>
<p>For more usage scenarios and typical errors see
<a class="reference internal" href="box_space_index.html#box-space-operations-detailed-examples"><span class="std std-ref">Example: using data operations</span></a>
further in this section.</p>
</dd></dl>

<span class="target" id="box-space-upsert"></span><dl class="method">
<dt id="box.space.space_object.upsert">
<code class="descname">upsert</code><span class="sig-paren">(</span><em>tuple</em>, <em>{{operator</em>, <em>field_no</em>, <em>value}</em>, <em>...}</em><span class="sig-paren">)</span><a class="headerlink" href="#box.space.space_object.upsert" title="Permalink to this definition">¶</a></dt>
<dd><p>Update or insert a tuple.</p>
<p>If there is an existing tuple which matches the key fields of <code class="docutils literal notranslate"><span class="pre">tuple</span></code>, then the
request has the same effect as <a class="reference internal" href="box_space_index.html#box-space-update"><span class="std std-ref">space_object:update()</span></a> and the
<code class="docutils literal notranslate"><span class="pre">{{operator,</span> <span class="pre">field_no,</span> <span class="pre">value},</span> <span class="pre">...}</span></code> parameter is used.
If there is no existing tuple which matches the key fields of <code class="docutils literal notranslate"><span class="pre">tuple</span></code>, then the
request has the same effect as <a class="reference internal" href="box_space_index.html#box-space-insert"><span class="std std-ref">space_object:insert()</span></a> and the
<code class="docutils literal notranslate"><span class="pre">{tuple}</span></code> parameter is used. However, unlike <code class="docutils literal notranslate"><span class="pre">insert</span></code> or
<code class="docutils literal notranslate"><span class="pre">update</span></code>, <code class="docutils literal notranslate"><span class="pre">upsert</span></code> will not read a tuple and perform
error checks before returning – this is a design feature which
enhances throughput but requires more caution on the part of the user.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>space_object</strong> (<a class="reference internal" href="box_space_index.html#box.space.space_object" title="box.space.space_object"><em>space_object</em></a>) – an <a class="reference internal" href="../lua_tips.html#app-server-object-reference"><span class="std std-ref">object reference</span></a></li>
<li><strong>tuple</strong> (<em>table/tuple</em>) – default tuple to be inserted, if analogue
isn’t found</li>
<li><strong>operator</strong> (<em>string</em>) – operation type represented in string</li>
<li><strong>field_no</strong> (<em>number</em>) – what field the operation will apply to. The
field number can be negative, meaning the
position from the end of tuple.
(#tuple + negative field number + 1)</li>
<li><strong>value</strong> (<em>lua_value</em>) – what value will be applied</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">null</p>
</td>
</tr>
</tbody>
</table>
<p><strong>Possible errors:</strong></p>
<ul class="simple">
<li>It is illegal to modify a primary-key field.</li>
<li>It is illegal to use upsert with a space that has a unique secondary
index.</li>
</ul>
<p><strong>Complexity factors:</strong> Index size, Index type, number of indexes
accessed, WAL settings.</p>
<p><strong>Example:</strong></p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="n">upsert</span><span class="p">({</span><span class="mi">12</span><span class="p">,</span><span class="s1">&#39;c&#39;</span><span class="p">},</span> <span class="p">{{</span><span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">}})</span>
</pre></div>
</div>
<p>For more usage scenarios and typical errors see
<a class="reference internal" href="box_space_index.html#box-space-operations-detailed-examples"><span class="std std-ref">Example: using data operations</span></a>
further in this section.</p>
</dd></dl>

<span class="target" id="box-space-user-defined"></span><dl class="method">
<dt id="box.space.space_object.user_defined">
<code class="descname">user_defined</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#box.space.space_object.user_defined" title="Permalink to this definition">¶</a></dt>
<dd><p>Users can define any functions they want, and associate them with spaces:
in effect they can make their own space methods.
They do this by:</p>
<ol class="arabic simple">
<li>creating a Lua function,</li>
<li>adding the function name to a predefined global variable which has
type = table, and</li>
<li>invoking the function any time thereafter, as long as the server
is up, by saying <code class="docutils literal notranslate"><span class="pre">space_object:function-name([parameters])</span></code>.</li>
</ol>
<p>The predefined global variable is <code class="docutils literal notranslate"><span class="pre">box.schema.space_mt</span></code>.
Adding to <code class="docutils literal notranslate"><span class="pre">box.schema.space_mt</span></code> makes the method available for all spaces.</p>
<p>Alternatively, user-defined methods can be made available for only one space,
by calling <code class="docutils literal notranslate"><span class="pre">getmetatable(space_object)</span></code> and then adding the function name to the
meta table. See also the example for
<a class="reference internal" href="box_index.html#box-index-user-defined"><span class="std std-ref">index_object:user_defined()</span></a>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>index_object</strong> (<a class="reference internal" href="box_index.html#box.index.index_object" title="box.index.index_object"><em>index_object</em></a>) – an <a class="reference internal" href="../lua_tips.html#app-server-object-reference"><span class="std std-ref">object reference</span></a>.</li>
<li><strong>any-name</strong> (<em>any-type</em>) – whatever the user defines</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p><strong>Example:</strong></p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="c1">-- Visible to any space, no parameters.</span>
<span class="c1">-- After these requests, the value of global_variable will be 6.</span>
<span class="n">box</span><span class="p">.</span><span class="n">schema</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">)</span>
<span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">t</span><span class="p">:</span><span class="n">create_index</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">)</span>
<span class="n">global_variable</span> <span class="o">=</span> <span class="mi">5</span>
<span class="kr">function</span> <span class="nf">f</span><span class="p">(</span><span class="n">space_arg</span><span class="p">)</span> <span class="n">global_variable</span> <span class="o">=</span> <span class="n">global_variable</span> <span class="o">+</span> <span class="mi">1</span> <span class="kr">end</span>
<span class="n">box</span><span class="p">.</span><span class="n">schema</span><span class="p">.</span><span class="n">space_mt</span><span class="p">.</span><span class="n">counter</span> <span class="o">=</span> <span class="n">f</span>
<span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">t</span><span class="p">:</span><span class="n">counter</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<span class="target" id="box-space-enabled"></span><dl class="data">
<dt id="box.space.space_object.enabled">
<code class="descname">enabled</code><a class="headerlink" href="#box.space.space_object.enabled" title="Permalink to this definition">¶</a></dt>
<dd><p>Whether or not this space is enabled.
The value is <code class="docutils literal notranslate"><span class="pre">false</span></code> if the space has no index.</p>
</dd></dl>

<span class="target" id="box-space-field-count"></span><dl class="data">
<dt id="box.space.space_object.field_count">
<code class="descname">field_count</code><a class="headerlink" href="#box.space.space_object.field_count" title="Permalink to this definition">¶</a></dt>
<dd><p>The required field count for all tuples in this space. The field_count
can be set initially with:</p>
<pre class="highlight literal-block">
box.schema.space.create(..., {
    ... ,
    field_count = <em>field_count_value</em> ,
    ...
})
</pre>
<p>The default value is <code class="docutils literal notranslate"><span class="pre">0</span></code>, which means there is no required field count.</p>
<p><strong>Example:</strong></p>
<div class="highlight-tarantoolsession notranslate"><div class="highlight"><pre><span></span>tarantool&gt; box.space.tester.field_count
---
- 0
...
</pre></div>
</div>
</dd></dl>

<span class="target" id="box-space-id"></span><dl class="data">
<dt id="box.space.space_object.id">
<code class="descname">id</code><a class="headerlink" href="#box.space.space_object.id" title="Permalink to this definition">¶</a></dt>
<dd><p>Ordinal space number. Spaces can be referenced by either name or
number. Thus, if space <code class="docutils literal notranslate"><span class="pre">tester</span></code> has <code class="docutils literal notranslate"><span class="pre">id</span> <span class="pre">=</span> <span class="pre">800</span></code>, then
<code class="docutils literal notranslate"><span class="pre">box.space.tester:insert{0}</span></code> and <code class="docutils literal notranslate"><span class="pre">box.space[800]:insert{0}</span></code>
are equivalent requests.</p>
<p><strong>Example:</strong></p>
<div class="highlight-tarantoolsession notranslate"><div class="highlight"><pre><span></span>tarantool&gt; box.space.tester.id
---
- 512
...
</pre></div>
</div>
</dd></dl>

</dd></dl>

<span class="target" id="box-space-space-index"></span><dl class="data">
<dt id="box.space.index">
<code class="descclassname">box.space.</code><code class="descname">index</code><a class="headerlink" href="#box.space.index" title="Permalink to this definition">¶</a></dt>
<dd><p>A container for all defined indexes. There is a Lua object of type
<a class="reference internal" href="box_index.html#box-index"><span class="std std-ref">box.index</span></a> with methods to search tuples and iterate
over them in predefined order.</p>
<p>To reset, use <a class="reference internal" href="box_stat.html#box-introspection-box-stat-reset"><span class="std std-ref">box.stat.reset()</span></a>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">table</td>
</tr>
</tbody>
</table>
<p><strong>Example:</strong></p>
<div class="highlight-tarantoolsession notranslate"><div class="highlight"><pre><span></span>-- checking the number of indexes for space &#39;tester&#39;
tarantool&gt; local counter=0; for i=0,#box.space.tester.index do
  if box.space.tester.index[i]~=nil then counter=counter+1 end
  end; print(counter)
1
---
...
-- checking the type of index &#39;primary&#39;
tarantool&gt; box.space.tester.index.primary.type
---
- TREE
...
</pre></div>
</div>
</dd></dl>

<span class="target" id="box-space-cluster"></span><dl class="data">
<dt id="box.space._cluster">
<code class="descclassname">box.space.</code><code class="descname">_cluster</code><a class="headerlink" href="#box.space._cluster" title="Permalink to this definition">¶</a></dt>
<dd><p><code class="docutils literal notranslate"><span class="pre">_cluster</span></code> is a system space
for support of the <a class="reference internal" href="../../book/replication/index.html#replication"><span class="std std-ref">replication feature</span></a>.</p>
</dd></dl>

<span class="target" id="box-space-func"></span><dl class="data">
<dt id="box.space._func">
<code class="descclassname">box.space.</code><code class="descname">_func</code><a class="headerlink" href="#box.space._func" title="Permalink to this definition">¶</a></dt>
<dd><p><code class="docutils literal notranslate"><span class="pre">_func</span></code> is a system space with function tuples made by
<a class="reference internal" href="box_schema.html#box-schema-func-create"><span class="std std-ref">box.schema.func.create()</span></a>.</p>
<p>Tuples in this space contain the following fields:</p>
<ul class="simple">
<li>the numeric function id, a number,</li>
<li>the function name,</li>
<li>flag,</li>
<li>a language name (optional): ‘LUA’ (default) or ‘C’.</li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">_func</span></code> space does not include the function’s body.
You continue to create Lua functions in the usual way, by saying
<code class="docutils literal notranslate"><span class="pre">function</span> <span class="pre">function_name</span> <span class="pre">()</span> <span class="pre">...</span> <span class="pre">end</span></code>, without adding anything
in the <code class="docutils literal notranslate"><span class="pre">_func</span></code> space. The <code class="docutils literal notranslate"><span class="pre">_func</span></code> space only exists for storing
function tuples so that their names can be used within
<a class="reference internal" href="../../book/box/authentication_index.html#authentication-owners-privileges"><span class="std std-ref">grant/revoke</span></a>
functions.</p>
<p>You can:</p>
<ul class="simple">
<li>Create a <code class="docutils literal notranslate"><span class="pre">_func</span></code> tuple with
<a class="reference internal" href="box_schema.html#box-schema-func-create"><span class="std std-ref">box.schema.func.create()</span></a>,</li>
<li>Drop a <code class="docutils literal notranslate"><span class="pre">_func</span></code> tuple with
<a class="reference internal" href="box_schema.html#box-schema-func-drop"><span class="std std-ref">box.schema.func.drop()</span></a>,</li>
<li>Check whether a <code class="docutils literal notranslate"><span class="pre">_func</span></code> tuple exists with
<a class="reference internal" href="box_schema.html#box-schema-func-exists"><span class="std std-ref">box.schema.func.exists()</span></a>.</li>
</ul>
<p><strong>Example:</strong></p>
<p>In the following example, we create a function named ‘f7’, put it into
Tarantool’s <code class="docutils literal notranslate"><span class="pre">_func</span></code> space and grant ‘execute’ privilege for this function
to ‘guest’ user.</p>
<div class="highlight-tarantoolsession notranslate"><div class="highlight"><pre><span></span>tarantool&gt; function f7()
         &gt;  box.session.uid()
         &gt; end
---
...
tarantool&gt; box.schema.func.create(&#39;f7&#39;)
---
...
tarantool&gt; box.schema.user.grant(&#39;guest&#39;, &#39;execute&#39;, &#39;function&#39;, &#39;f7&#39;)
---
...
tarantool&gt; box.schema.user.revoke(&#39;guest&#39;, &#39;execute&#39;, &#39;function&#39;, &#39;f7&#39;)
---
...
</pre></div>
</div>
</dd></dl>

<span class="target" id="box-space-index"></span><dl class="data">
<dt id="box.space._index">
<code class="descclassname">box.space.</code><code class="descname">_index</code><a class="headerlink" href="#box.space._index" title="Permalink to this definition">¶</a></dt>
<dd><p><code class="docutils literal notranslate"><span class="pre">_index</span></code> is a system space.</p>
<p>Tuples in this space contain the following fields:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">id</span></code> (= id of space),</li>
<li><code class="docutils literal notranslate"><span class="pre">iid</span></code> (= index number within space),</li>
<li><code class="docutils literal notranslate"><span class="pre">name</span></code>,</li>
<li><code class="docutils literal notranslate"><span class="pre">type</span></code>,</li>
<li><code class="docutils literal notranslate"><span class="pre">opts</span></code> (e.g. unique option), [<code class="docutils literal notranslate"><span class="pre">tuple-field-no</span></code>, <code class="docutils literal notranslate"><span class="pre">tuple-field-type</span></code> …].</li>
</ul>
<p>Here is what <code class="docutils literal notranslate"><span class="pre">_index</span></code> contains in a typical installation:</p>
<div class="highlight-tarantoolsession notranslate"><div class="highlight"><pre><span></span>tarantool&gt; box.space._index:select{}
---
- - [272, 0, &#39;primary&#39;, &#39;tree&#39;, {&#39;unique&#39;: true}, [[0, &#39;string&#39;]]]
  - [280, 0, &#39;primary&#39;, &#39;tree&#39;, {&#39;unique&#39;: true}, [[0, &#39;unsigned&#39;]]]
  - [280, 1, &#39;owner&#39;, &#39;tree&#39;, {&#39;unique&#39;: false}, [[1, &#39;unsigned&#39;]]]
  - [280, 2, &#39;name&#39;, &#39;tree&#39;, {&#39;unique&#39;: true}, [[2, &#39;string&#39;]]]
  - [281, 0, &#39;primary&#39;, &#39;tree&#39;, {&#39;unique&#39;: true}, [[0, &#39;unsigned&#39;]]]
  - [281, 1, &#39;owner&#39;, &#39;tree&#39;, {&#39;unique&#39;: false}, [[1, &#39;unsigned&#39;]]]
  - [281, 2, &#39;name&#39;, &#39;tree&#39;, {&#39;unique&#39;: true}, [[2, &#39;string&#39;]]]
  - [288, 0, &#39;primary&#39;, &#39;tree&#39;, {&#39;unique&#39;: true}, [[0, &#39;unsigned&#39;], [1, &#39;unsigned&#39;]]]
  - [288, 2, &#39;name&#39;, &#39;tree&#39;, {&#39;unique&#39;: true}, [[0, &#39;unsigned&#39;], [2, &#39;string&#39;]]]
  - [289, 0, &#39;primary&#39;, &#39;tree&#39;, {&#39;unique&#39;: true}, [[0, &#39;unsigned&#39;], [1, &#39;unsigned&#39;]]]
  - [289, 2, &#39;name&#39;, &#39;tree&#39;, {&#39;unique&#39;: true}, [[0, &#39;unsigned&#39;], [2, &#39;string&#39;]]]
  - [296, 0, &#39;primary&#39;, &#39;tree&#39;, {&#39;unique&#39;: true}, [[0, &#39;unsigned&#39;]]]
  - [296, 1, &#39;owner&#39;, &#39;tree&#39;, {&#39;unique&#39;: false}, [[1, &#39;unsigned&#39;]]]
  - [296, 2, &#39;name&#39;, &#39;tree&#39;, {&#39;unique&#39;: true}, [[2, &#39;string&#39;]]]
---
...
</pre></div>
</div>
</dd></dl>

<span class="target" id="box-space-vindex"></span><dl class="data">
<dt id="box.space._vindex">
<code class="descclassname">box.space.</code><code class="descname">_vindex</code><a class="headerlink" href="#box.space._vindex" title="Permalink to this definition">¶</a></dt>
<dd><p><code class="docutils literal notranslate"><span class="pre">_vindex</span></code> is a system space that represents a virtual view. The structure
of its tuples is identical to that of <a class="reference internal" href="box_space_index.html#box-space-index"><span class="std std-ref">_index</span></a>, but
permissions for certain tuples are limited in accordance with user privileges.
<code class="docutils literal notranslate"><span class="pre">_vindex</span></code> contains only those tuples that are accessible to the current user.
See <a class="reference internal" href="../../book/box/authentication.html#authentication"><span class="std std-ref">Access control</span></a> for details about user privileges.</p>
<p>If the user has the full set of privileges (like ‘admin’), the contents
of <code class="docutils literal notranslate"><span class="pre">_vindex</span></code> match the contents of <code class="docutils literal notranslate"><span class="pre">_index</span></code>. If the user has limited
access, <code class="docutils literal notranslate"><span class="pre">_vindex</span></code> contains only tuples accessible to this user.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li><code class="docutils literal notranslate"><span class="pre">_vindex</span></code> is a system view, so it allows only read requests.</li>
<li>While the <code class="docutils literal notranslate"><span class="pre">_index</span></code> space requires proper access privileges, any user
can always read from <code class="docutils literal notranslate"><span class="pre">_vindex</span></code>.</li>
</ul>
</div>
</dd></dl>

<span class="target" id="box-space-priv"></span><dl class="data">
<dt id="box.space._priv">
<code class="descclassname">box.space.</code><code class="descname">_priv</code><a class="headerlink" href="#box.space._priv" title="Permalink to this definition">¶</a></dt>
<dd><p><code class="docutils literal notranslate"><span class="pre">_priv</span></code> is a system space where
<a class="reference internal" href="../../book/box/authentication_index.html#authentication-owners-privileges"><span class="std std-ref">privileges</span></a> are stored.</p>
<p>Tuples in this space contain the following fields:</p>
<ul class="simple">
<li>the numeric id of the user who gave the privilege (“grantor_id”),</li>
<li>the numeric id of the user who received the privilege (“grantee_id”),</li>
<li>the type of object: ‘space’, ‘function’, ‘sequence’ or ‘universe’,</li>
<li>the numeric id of the object,</li>
<li>the type of operation: “read” = 1, “write” = 2, “execute” = 4,
“create” = 32, “drop” = 64, “alter” = 128, or
a combination such as “read,write,execute”.</li>
</ul>
<p>You can:</p>
<ul class="simple">
<li>Grant a privilege with <a class="reference internal" href="box_schema.html#box-schema-user-grant"><span class="std std-ref">box.schema.user.grant()</span></a>.</li>
<li>Revoke a privilege with <a class="reference internal" href="box_schema.html#box-schema-user-revoke"><span class="std std-ref">box.schema.user.revoke()</span></a>.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>Generally, privileges are granted or revoked by the owner of the object
(the user who created it), or by the ‘admin’ user.</li>
<li>Before dropping any objects or users, make sure that all their associated
privileges have been revoked.</li>
<li>Only the <a class="reference internal" href="../../book/box/authentication_index.html#authentication-owners-privileges"><span class="std std-ref">‘admin’ user</span></a>
can grant privileges for the ‘universe’.</li>
<li>Only the ‘admin’ user or the creator of a space can drop, alter, or
truncate the space.</li>
<li>Only the ‘admin’ user or the creator of a user can change a different
user’s password.</li>
</ul>
</div>
</dd></dl>

<span class="target" id="box-space-vpriv"></span><dl class="data">
<dt id="box.space._vpriv">
<code class="descclassname">box.space.</code><code class="descname">_vpriv</code><a class="headerlink" href="#box.space._vpriv" title="Permalink to this definition">¶</a></dt>
<dd><p><code class="docutils literal notranslate"><span class="pre">_vpriv</span></code> is a system space that represents a virtual view. The structure
of its tuples is identical to that of <a class="reference internal" href="box_space_index.html#box-space-priv"><span class="std std-ref">_priv</span></a>, but
permissions for certain tuples are limited in accordance with user privileges.
<code class="docutils literal notranslate"><span class="pre">_vpriv</span></code> contains only those tuples that are accessible to the current user.
See <a class="reference internal" href="../../book/box/authentication.html#authentication"><span class="std std-ref">Access control</span></a> for details about user privileges.</p>
<p>If the user has the full set of privileges (like ‘admin’), the contents
of <code class="docutils literal notranslate"><span class="pre">_vpriv</span></code> match the contents of <code class="docutils literal notranslate"><span class="pre">_priv</span></code>. If the user has limited
access, <code class="docutils literal notranslate"><span class="pre">_vpriv</span></code> contains only tuples accessible to this user.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li><code class="docutils literal notranslate"><span class="pre">_vpriv</span></code> is a system view, so it allows only read requests.</li>
<li>While the <code class="docutils literal notranslate"><span class="pre">_priv</span></code> space requires proper access privileges, any user
can always read from <code class="docutils literal notranslate"><span class="pre">_vpriv</span></code>.</li>
</ul>
</div>
</dd></dl>

<span class="target" id="box-space-schema"></span><dl class="data">
<dt id="box.space._schema">
<code class="descclassname">box.space.</code><code class="descname">_schema</code><a class="headerlink" href="#box.space._schema" title="Permalink to this definition">¶</a></dt>
<dd><p><code class="docutils literal notranslate"><span class="pre">_schema</span></code> is a system space.</p>
<p>This space contains the following tuples:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">version</span></code> tuple with version information for this Tarantool instance,</li>
<li><code class="docutils literal notranslate"><span class="pre">cluster</span></code> tuple with the instance’s replica set ID,</li>
<li><code class="docutils literal notranslate"><span class="pre">max_id</span></code> tuple with the maximal space ID,</li>
<li><code class="docutils literal notranslate"><span class="pre">once...</span></code> tuples that correspond to specific
<a class="reference internal" href="box_once.html#box-once"><span class="std std-ref">box.once()</span></a> blocks from the instance’s
<a class="reference internal" href="../configuration/index.html#index-init-label"><span class="std std-ref">initialization file</span></a>.
The first field in these tuples contains the <code class="docutils literal notranslate"><span class="pre">key</span></code> value from the
corresponding <code class="docutils literal notranslate"><span class="pre">box.once()</span></code> block prefixed with ‘once’ (e.g. <cite>oncehello</cite>),
so you can easily find a tuple that corresponds to a specific
<code class="docutils literal notranslate"><span class="pre">box.once()</span></code> block.</li>
</ul>
<p><strong>Example:</strong></p>
<p>Here is what <code class="docutils literal notranslate"><span class="pre">_schema</span></code> contains in a typical installation (notice the
tuples for two <code class="docutils literal notranslate"><span class="pre">box.once()</span></code> blocks, <code class="docutils literal notranslate"><span class="pre">'oncebye'</span></code> and <code class="docutils literal notranslate"><span class="pre">'oncehello'</span></code>):</p>
<div class="highlight-tarantoolsession notranslate"><div class="highlight"><pre><span></span>tarantool&gt; box.space._schema:select{}
---
- - [&#39;cluster&#39;, &#39;b4e15788-d962-4442-892e-d6c1dd5d13f2&#39;]
  - [&#39;max_id&#39;, 512]
  - [&#39;oncebye&#39;]
  - [&#39;oncehello&#39;]
  - [&#39;version&#39;, 1, 7, 2]
</pre></div>
</div>
</dd></dl>

<span class="target" id="box-space-sequence"></span><dl class="data">
<dt id="box.space._sequence">
<code class="descclassname">box.space.</code><code class="descname">_sequence</code><a class="headerlink" href="#box.space._sequence" title="Permalink to this definition">¶</a></dt>
<dd><p><code class="docutils literal notranslate"><span class="pre">_sequence</span></code> is a system space
for support of the <a class="reference internal" href="../../book/box/data_model.html#index-box-sequence"><span class="std std-ref">sequence feature</span></a>.
It contains persistent information that was established by
<a class="reference internal" href="box_schema.html#box-schema-sequence-create"><span class="std std-ref">box.schema.sequence.create()</span></a> or
<a class="reference internal" href="box_schema.html#box-schema-sequence-alter"><span class="std std-ref">box.schema.sequence.alter()</span></a>.</p>
</dd></dl>

<span class="target" id="box-space-sequence-data"></span><dl class="data">
<dt id="box.space._sequence_data">
<code class="descclassname">box.space.</code><code class="descname">_sequence_data</code><a class="headerlink" href="#box.space._sequence_data" title="Permalink to this definition">¶</a></dt>
<dd><p><code class="docutils literal notranslate"><span class="pre">_sequence_data</span></code> is a system space
for support of the <a class="reference internal" href="../../book/box/data_model.html#index-box-sequence"><span class="std std-ref">sequence feature</span></a>.</p>
<p>Each tuple in <code class="docutils literal notranslate"><span class="pre">_sequence_data</span></code> contains two fields:</p>
<ul class="simple">
<li>the id of the sequence, and</li>
<li>the last value that the sequence generator returned
(non-persistent information).</li>
</ul>
</dd></dl>

<span class="target" id="box-space-space"></span><dl class="data">
<dt id="box.space._space">
<code class="descclassname">box.space.</code><code class="descname">_space</code><a class="headerlink" href="#box.space._space" title="Permalink to this definition">¶</a></dt>
<dd><p><code class="docutils literal notranslate"><span class="pre">_space</span></code> is a system space. It contains all spaces hosted on the current
Tarantool instance, both system ones and created by users.</p>
<p>Tuples in this space contain the following fields:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">id</span></code>,</li>
<li><code class="docutils literal notranslate"><span class="pre">owner</span></code> (= id of user who owns the space),</li>
<li><code class="docutils literal notranslate"><span class="pre">name</span></code>, <code class="docutils literal notranslate"><span class="pre">engine</span></code>, <code class="docutils literal notranslate"><span class="pre">field_count</span></code>,</li>
<li><code class="docutils literal notranslate"><span class="pre">flags</span></code> (e.g. temporary),</li>
<li><code class="docutils literal notranslate"><span class="pre">format</span></code> (as made by a <a class="reference internal" href="box_space_index.html#box-space-format"><span class="std std-ref">format clause</span></a>).</li>
</ul>
<p>These fields are established by <a class="reference internal" href="box_schema.html#box-schema-space-create"><span class="std std-ref">space.create()</span></a>.</p>
<p><strong>Example #1:</strong></p>
<p>The following function will display every simple field in all tuples of
<code class="docutils literal notranslate"><span class="pre">_space</span></code>.</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="kr">function</span> <span class="nf">example</span><span class="p">()</span>
  <span class="kd">local</span> <span class="n">ta</span> <span class="o">=</span> <span class="p">{}</span>
  <span class="kd">local</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span>
  <span class="kr">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="kr">in</span> <span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">_space</span><span class="p">:</span><span class="nb">pairs</span><span class="p">()</span> <span class="kr">do</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">line</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="kr">while</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="o">#</span><span class="n">v</span> <span class="kr">do</span>
      <span class="kr">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">~=</span> <span class="s1">&#39;table&#39;</span> <span class="kr">then</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">line</span> <span class="o">..</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">..</span> <span class="s1">&#39; &#39;</span>
      <span class="kr">end</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="kr">end</span>
    <span class="nb">table.insert</span><span class="p">(</span><span class="n">ta</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
  <span class="kr">end</span>
  <span class="kr">return</span> <span class="n">ta</span>
<span class="kr">end</span>
</pre></div>
</div>
<p>Here is what <code class="docutils literal notranslate"><span class="pre">example()</span></code> returns in a typical installation:</p>
<div class="highlight-tarantoolsession notranslate"><div class="highlight"><pre><span></span>tarantool&gt; example()
---
- - &#39;272 1 _schema memtx 0  &#39;
  - &#39;280 1 _space memtx 0  &#39;
  - &#39;281 1 _vspace sysview 0  &#39;
  - &#39;288 1 _index memtx 0  &#39;
  - &#39;296 1 _func memtx 0  &#39;
  - &#39;304 1 _user memtx 0  &#39;
  - &#39;305 1 _vuser sysview 0  &#39;
  - &#39;312 1 _priv memtx 0  &#39;
  - &#39;313 1 _vpriv sysview 0  &#39;
  - &#39;320 1 _cluster memtx 0  &#39;
  - &#39;512 1 tester memtx 0  &#39;
  - &#39;513 1 origin vinyl 0  &#39;
  - &#39;514 1 archive memtx 0  &#39;
...
</pre></div>
</div>
<p><strong>Example #2:</strong></p>
<p>The following requests will create a space using
<code class="docutils literal notranslate"><span class="pre">box.schema.space.create()</span></code> with a <a class="reference internal" href="box_space_index.html#box-space-format"><span class="std std-ref">format clause</span></a>, then retrieve
the <code class="docutils literal notranslate"><span class="pre">_space</span></code> tuple for the new space. This illustrates the typical use of
the <code class="docutils literal notranslate"><span class="pre">format</span></code> clause, it shows the recommended names and data types for the
fields.</p>
<div class="highlight-tarantoolsession notranslate"><div class="highlight"><pre><span></span>tarantool&gt; box.schema.space.create(&#39;TM&#39;, {
         &gt;   id = 12345,
         &gt;   format = {
         &gt;     [1] = {[&quot;name&quot;] = &quot;field_1&quot;},
         &gt;     [2] = {[&quot;type&quot;] = &quot;unsigned&quot;}
         &gt;   }
         &gt; })
---
- index: []
  on_replace: &#39;function: 0x41c67338&#39;
  temporary: false
  id: 12345
  engine: memtx
  enabled: false
  name: TM
  field_count: 0
- created
...
tarantool&gt; box.space._space:select(12345)
---
- - [12345, 1, &#39;TM&#39;, &#39;memtx&#39;, 0, {}, [{&#39;name&#39;: &#39;field_1&#39;}, {&#39;type&#39;: &#39;unsigned&#39;}]]
...
</pre></div>
</div>
</dd></dl>

<span class="target" id="box-space-vspace"></span><dl class="data">
<dt id="box.space._vspace">
<code class="descclassname">box.space.</code><code class="descname">_vspace</code><a class="headerlink" href="#box.space._vspace" title="Permalink to this definition">¶</a></dt>
<dd><p><code class="docutils literal notranslate"><span class="pre">_vspace</span></code> is a system space that represents a virtual view. The structure
of its tuples is identical to that of <a class="reference internal" href="box_space_index.html#box-space-space"><span class="std std-ref">_space</span></a>, but
permissions for certain tuples are limited in accordance with user privileges.
<code class="docutils literal notranslate"><span class="pre">_vspace</span></code> contains only those tuples that are accessible to the current user.
See <a class="reference internal" href="../../book/box/authentication.html#authentication"><span class="std std-ref">Access control</span></a> for details about user privileges.</p>
<p>If the user has the full set of privileges (like ‘admin’), the contents
of <code class="docutils literal notranslate"><span class="pre">_vspace</span></code> match the contents of <code class="docutils literal notranslate"><span class="pre">_space</span></code>. If the user has limited
access, <code class="docutils literal notranslate"><span class="pre">_vspace</span></code> contains only tuples accessible to this user.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li><code class="docutils literal notranslate"><span class="pre">_vspace</span></code> is a system view, so it allows only read requests.</li>
<li>While the <code class="docutils literal notranslate"><span class="pre">_space</span></code> space requires proper access privileges, any user
can always read from <code class="docutils literal notranslate"><span class="pre">_vspace</span></code>.</li>
</ul>
</div>
</dd></dl>

<span class="target" id="box-space-user"></span><dl class="data">
<dt id="box.space._user">
<code class="descclassname">box.space.</code><code class="descname">_user</code><a class="headerlink" href="#box.space._user" title="Permalink to this definition">¶</a></dt>
<dd><p><code class="docutils literal notranslate"><span class="pre">_user</span></code> is a system space where user-names and password hashes are stored.</p>
<p>Tuples in this space contain the following fields:</p>
<ul class="simple">
<li>the numeric id of the tuple (“id”),</li>
<li>the numeric id of the tuple’s creator,</li>
<li>the name,</li>
<li>the type: ‘user’ or ‘role’,</li>
<li>optional password.</li>
</ul>
<p>There are five special tuples in the <code class="docutils literal notranslate"><span class="pre">_user</span></code> space: ‘guest’, ‘admin’,
‘public’, ‘replication’, and ‘super’.</p>
<div class="table docutils container">
<table border="1" class="docutils">
<colgroup>
<col width="15%" />
<col width="5%" />
<col width="7%" />
<col width="74%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">ID</th>
<th class="head">Type</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>guest</td>
<td>0</td>
<td>user</td>
<td>Default user when connecting remotely.
Usually an untrusted user with few privileges.</td>
</tr>
<tr class="row-odd"><td>admin</td>
<td>1</td>
<td>user</td>
<td>Default user when using Tarantool as a console.
Usually an
<a class="reference internal" href="../../book/box/authentication_index.html#authentication-owners-privileges"><span class="std std-ref">administrative user</span></a>
with all privileges.</td>
</tr>
<tr class="row-even"><td>public</td>
<td>2</td>
<td>role</td>
<td>Pre-defined <a class="reference internal" href="../../book/box/authentication_index.html#authentication-roles"><span class="std std-ref">role</span></a>,
automatically granted to new users when they are
created with
<code class="docutils literal notranslate"><span class="pre">box.schema.user.create(user-name)</span></code>.
Therefore a convenient way to grant ‘read’ on space
‘t’ to every user that will ever exist is with
<code class="docutils literal notranslate"><span class="pre">box.schema.role.grant('public','read','space','t')</span></code>.</td>
</tr>
<tr class="row-odd"><td>replication</td>
<td>3</td>
<td>role</td>
<td>Pre-defined <a class="reference internal" href="../../book/box/authentication_index.html#authentication-roles"><span class="std std-ref">role</span></a>,
which the ‘admin’ user can grant to users who need to use
<a class="reference internal" href="../../book/replication/index.html#replication"><span class="std std-ref">replication</span></a> features.</td>
</tr>
<tr class="row-even"><td>super</td>
<td>31</td>
<td>role</td>
<td>Pre-defined <a class="reference internal" href="../../book/box/authentication_index.html#authentication-roles"><span class="std std-ref">role</span></a>,
which the ‘admin’ user can grant to users who need all
privileges on all objects.
The ‘super’ role has these privileges on
‘universe’:
read, write, execute, create, drop, alter.</td>
</tr>
</tbody>
</table>
</div>
<p>To select a tuple from the <code class="docutils literal notranslate"><span class="pre">_user</span></code> space, use <code class="docutils literal notranslate"><span class="pre">box.space._user:select()</span></code>.
For example, here is what happens with a select for user id = 0, which is
the ‘guest’ user, which by default has no password:</p>
<div class="highlight-tarantoolsession notranslate"><div class="highlight"><pre><span></span>tarantool&gt; box.space._user:select{0}
---
- - [0, 1, &#39;guest&#39;, &#39;user&#39;]
...
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">To change tuples in the <code class="docutils literal notranslate"><span class="pre">_user</span></code> space, do not use ordinary <code class="docutils literal notranslate"><span class="pre">box.space</span></code>
functions for insert or update or delete. The <code class="docutils literal notranslate"><span class="pre">_user</span></code> space is special,
so there are special functions which have appropriate error checking.</p>
</div>
<p>To create a new user, use <a class="reference internal" href="box_schema.html#box-schema-user-create"><span class="std std-ref">box.schema.user.create()</span></a>:</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">box</span><span class="p">.</span><span class="n">schema</span><span class="p">.</span><span class="n">user</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="o">*</span><span class="n">user</span><span class="o">-</span><span class="n">name</span><span class="o">*</span><span class="p">)</span>
<span class="n">box</span><span class="p">.</span><span class="n">schema</span><span class="p">.</span><span class="n">user</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="o">*</span><span class="n">user</span><span class="o">-</span><span class="n">name</span><span class="o">*</span><span class="p">,</span> <span class="p">{</span><span class="n">if_not_exists</span> <span class="o">=</span> <span class="kc">true</span><span class="p">})</span>
<span class="n">box</span><span class="p">.</span><span class="n">schema</span><span class="p">.</span><span class="n">user</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="o">*</span><span class="n">user</span><span class="o">-</span><span class="n">name</span><span class="o">*</span><span class="p">,</span> <span class="p">{</span><span class="n">password</span> <span class="o">=</span> <span class="o">*</span><span class="n">password</span><span class="o">*</span><span class="p">})</span>
</pre></div>
</div>
<p>To change the user’s password, use <a class="reference internal" href="box_schema.html#box-schema-user-password"><span class="std std-ref">box.schema.user.password()</span></a>:</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="c1">-- To change the current user&#39;s password</span>
<span class="n">box</span><span class="p">.</span><span class="n">schema</span><span class="p">.</span><span class="n">user</span><span class="p">.</span><span class="n">passwd</span><span class="p">(</span><span class="o">*</span><span class="n">password</span><span class="o">*</span><span class="p">)</span>

<span class="c1">-- To change a different user&#39;s password</span>
<span class="c1">-- (usually only &#39;admin&#39; can do it)</span>
<span class="n">box</span><span class="p">.</span><span class="n">schema</span><span class="p">.</span><span class="n">user</span><span class="p">.</span><span class="n">passwd</span><span class="p">(</span><span class="o">*</span><span class="n">user</span><span class="o">-</span><span class="n">name</span><span class="o">*</span><span class="p">,</span> <span class="o">*</span><span class="n">password</span><span class="o">*</span><span class="p">)</span>
</pre></div>
</div>
<p>To drop a user, use <a class="reference internal" href="box_schema.html#box-schema-user-drop"><span class="std std-ref">box.schema.user.drop()</span></a>:</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">box</span><span class="p">.</span><span class="n">schema</span><span class="p">.</span><span class="n">user</span><span class="p">.</span><span class="n">drop</span><span class="p">(</span><span class="o">*</span><span class="n">user</span><span class="o">-</span><span class="n">name</span><span class="o">*</span><span class="p">)</span>
</pre></div>
</div>
<p>To check whether a user exists, use <a class="reference internal" href="box_schema.html#box-schema-user-exists"><span class="std std-ref">box.schema.user.exists()</span></a>,
which returns <code class="docutils literal notranslate"><span class="pre">true</span></code> or <code class="docutils literal notranslate"><span class="pre">false</span></code>:</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">box</span><span class="p">.</span><span class="n">schema</span><span class="p">.</span><span class="n">user</span><span class="p">.</span><span class="n">exists</span><span class="p">(</span><span class="o">*</span><span class="n">user</span><span class="o">-</span><span class="n">name</span><span class="o">*</span><span class="p">)</span>
</pre></div>
</div>
<p>To find what privileges a user has, use <a class="reference internal" href="box_schema.html#box-schema-user-info"><span class="std std-ref">box.schema.user.info()</span></a>:</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">box</span><span class="p">.</span><span class="n">schema</span><span class="p">.</span><span class="n">user</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="o">*</span><span class="n">user</span><span class="o">-</span><span class="n">name</span><span class="o">*</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The maximum number of users is 32.</p>
</div>
<p><strong>Example:</strong></p>
<p>Here is a session which creates a new user with a strong password, selects a
tuple in the <code class="docutils literal notranslate"><span class="pre">_user</span></code> space, and then drops the user.</p>
<div class="highlight-tarantoolsession notranslate"><div class="highlight"><pre><span></span>tarantool&gt; box.schema.user.create(&#39;JeanMartin&#39;, {password = &#39;Iwtso_6_os$$&#39;})
---
...
tarantool&gt; box.space._user.index.name:select{&#39;JeanMartin&#39;}
---
- - [17, 1, &#39;JeanMartin&#39;, &#39;user&#39;, {&#39;chap-sha1&#39;: &#39;t3xjUpQdrt857O+YRvGbMY5py8Q=&#39;}]
...
tarantool&gt; box.schema.user.drop(&#39;JeanMartin&#39;)
---
...
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="example-using-box-space-functions-to-read-space-tuples">
<h2>Example: using box.space functions to read _space tuples<a class="headerlink" href="#example-using-box-space-functions-to-read-space-tuples" title="Permalink to this headline">¶</a></h2>
<p>This function will illustrate how to look at all the spaces, and for each
display: approximately how many tuples it contains, and the first field of
its first tuple. The function uses Tarantool <code class="docutils literal notranslate"><span class="pre">box.space</span></code> functions <code class="docutils literal notranslate"><span class="pre">len()</span></code>
and <code class="docutils literal notranslate"><span class="pre">pairs()</span></code>. The iteration through the spaces is coded as a scan of the
<code class="docutils literal notranslate"><span class="pre">_space</span></code> system space, which contains metadata. The third field in
<code class="docutils literal notranslate"><span class="pre">_space</span></code> contains the space name, so the key instruction
<code class="docutils literal notranslate"><span class="pre">space_name</span> <span class="pre">=</span> <span class="pre">v[3]</span></code> means <code class="docutils literal notranslate"><span class="pre">space_name</span></code> is the <code class="docutils literal notranslate"><span class="pre">space_name</span></code> field in
the tuple of <code class="docutils literal notranslate"><span class="pre">_space</span></code> that we’ve just fetched with <code class="docutils literal notranslate"><span class="pre">pairs()</span></code>. The function
returns a table:</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="kr">function</span> <span class="nf">example</span><span class="p">()</span>
  <span class="kd">local</span> <span class="n">tuple_count</span><span class="p">,</span> <span class="n">space_name</span><span class="p">,</span> <span class="n">line</span>
  <span class="kd">local</span> <span class="n">ta</span> <span class="o">=</span> <span class="p">{}</span>
  <span class="kr">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="kr">in</span> <span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">_space</span><span class="p">:</span><span class="nb">pairs</span><span class="p">()</span> <span class="kr">do</span>
    <span class="n">space_name</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
    <span class="kr">if</span> <span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">[</span><span class="n">space_name</span><span class="p">].</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">~=</span> <span class="kc">nil</span> <span class="kr">then</span>
      <span class="n">tuple_count</span> <span class="o">=</span> <span class="s1">&#39;1 or more&#39;</span>
    <span class="kr">else</span>
      <span class="n">tuple_count</span> <span class="o">=</span> <span class="s1">&#39;0&#39;</span>
    <span class="kr">end</span>
    <span class="n">line</span> <span class="o">=</span> <span class="n">space_name</span> <span class="o">..</span> <span class="s1">&#39; tuple_count =&#39;</span> <span class="o">..</span> <span class="n">tuple_count</span>
    <span class="kr">if</span> <span class="n">tuple_count</span> <span class="o">==</span> <span class="s1">&#39;1 or more&#39;</span> <span class="kr">then</span>
      <span class="kr">for</span> <span class="n">k1</span><span class="p">,</span> <span class="n">v1</span> <span class="kr">in</span> <span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">[</span><span class="n">space_name</span><span class="p">]:</span><span class="nb">pairs</span><span class="p">()</span> <span class="kr">do</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">line</span> <span class="o">..</span> <span class="s1">&#39;. first field in first tuple = &#39;</span> <span class="o">..</span> <span class="n">v1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="kr">break</span>
      <span class="kr">end</span>
    <span class="kr">end</span>
    <span class="nb">table.insert</span><span class="p">(</span><span class="n">ta</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
  <span class="kr">end</span>
  <span class="kr">return</span> <span class="n">ta</span>
<span class="kr">end</span>
</pre></div>
</div>
<p>And here is what happens when one invokes the function:</p>
<div class="highlight-tarantoolsession notranslate"><div class="highlight"><pre><span></span>tarantool&gt; example()
---
- - _schema tuple_count =1 or more. first field in first tuple = cluster
  - _space tuple_count =1 or more. first field in first tuple = 272
  - _vspace tuple_count =1 or more. first field in first tuple = 272
  - _index tuple_count =1 or more. first field in first tuple = 272
  - _vindex tuple_count =1 or more. first field in first tuple = 272
  - _func tuple_count =1 or more. first field in first tuple = 1
  - _vfunc tuple_count =1 or more. first field in first tuple = 1
  - _user tuple_count =1 or more. first field in first tuple = 0
  - _vuser tuple_count =1 or more. first field in first tuple = 0
  - _priv tuple_count =1 or more. first field in first tuple = 1
  - _vpriv tuple_count =1 or more. first field in first tuple = 1
  - _cluster tuple_count =1 or more. first field in first tuple = 1
...
</pre></div>
</div>
</div>
<div class="section" id="example-using-box-space-functions-to-organize-a-space-tuple">
<h2>Example: using box.space functions to organize a _space tuple<a class="headerlink" href="#example-using-box-space-functions-to-organize-a-space-tuple" title="Permalink to this headline">¶</a></h2>
<p>The objective is to display field names and field types of a system space –
using metadata to find metadata.</p>
<p>To begin: how can one select the <code class="docutils literal notranslate"><span class="pre">_space</span></code> tuple that describes <code class="docutils literal notranslate"><span class="pre">_space</span></code>?</p>
<p>A simple way is to look at the constants in <code class="docutils literal notranslate"><span class="pre">box.schema</span></code>,
which tell us that there is an item named SPACE_ID == 288,
so these statements will retrieve the correct tuple:</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">_space</span><span class="p">:</span><span class="nb">select</span><span class="p">{</span> <span class="mi">288</span> <span class="p">}</span>
<span class="c1">-- or --</span>
<span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">_space</span><span class="p">:</span><span class="nb">select</span><span class="p">{</span> <span class="n">box</span><span class="p">.</span><span class="n">schema</span><span class="p">.</span><span class="n">SPACE_ID</span> <span class="p">}</span>
</pre></div>
</div>
<p>Another way is to look at the tuples in <code class="docutils literal notranslate"><span class="pre">box.space._index</span></code>,
which tell us that there is a secondary index named ‘name’ for space
number 288, so this statement also will retrieve the correct tuple:</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">_space</span><span class="p">.</span><span class="n">index</span><span class="p">.</span><span class="n">name</span><span class="p">:</span><span class="nb">select</span><span class="p">{</span> <span class="s1">&#39;_space&#39;</span> <span class="p">}</span>
</pre></div>
</div>
<p>However, the retrieved tuple is not easy to read:</p>
<div class="highlight-tarantoolsession notranslate"><div class="highlight"><pre><span></span>tarantool&gt; box.space._space.index.name:select{&#39;_space&#39;}
---
- - [280, 1, &#39;_space&#39;, &#39;memtx&#39;, 0, {}, [{&#39;name&#39;: &#39;id&#39;, &#39;type&#39;: &#39;num&#39;}, {&#39;name&#39;: &#39;owner&#39;,
        &#39;type&#39;: &#39;num&#39;}, {&#39;name&#39;: &#39;name&#39;, &#39;type&#39;: &#39;str&#39;}, {&#39;name&#39;: &#39;engine&#39;, &#39;type&#39;: &#39;str&#39;},
      {&#39;name&#39;: &#39;field_count&#39;, &#39;type&#39;: &#39;num&#39;}, {&#39;name&#39;: &#39;flags&#39;, &#39;type&#39;: &#39;str&#39;}, {
        &#39;name&#39;: &#39;format&#39;, &#39;type&#39;: &#39;*&#39;}]]
...
</pre></div>
</div>
<p>It looks disorganized because field number 7 has been formatted with recommended
names and data types. How can one get those specific sub-fields? Since it’s
visible that field number 7 is an array of maps, this <cite>for</cite> loop will do the
organizing:</p>
<div class="highlight-tarantoolsession notranslate"><div class="highlight"><pre><span></span>tarantool&gt; do
         &gt;   local tuple_of_space = box.space._space.index.name:get{&#39;_space&#39;}
         &gt;   for _, field in ipairs(tuple_of_space[7]) do
         &gt;     print(field.name .. &#39;, &#39; .. field.type)
         &gt;   end
         &gt; end
id, num
owner, num
name, str
engine, str
field_count, num
flags, str
format, *
---
...
</pre></div>
</div>
<span class="target" id="box-space-vuser"></span><dl class="data">
<dt id="box.space._vuser">
<code class="descclassname">box.space.</code><code class="descname">_vuser</code><a class="headerlink" href="#box.space._vuser" title="Permalink to this definition">¶</a></dt>
<dd><p><code class="docutils literal notranslate"><span class="pre">_vuser</span></code> is a system space that represents a virtual view. The structure
of its tuples is identical to that of <a class="reference internal" href="box_space_index.html#box-space-user"><span class="std std-ref">_user</span></a>, but
permissions for certain tuples are limited in accordance with user privileges.
<code class="docutils literal notranslate"><span class="pre">_vuser</span></code> contains only those tuples that are accessible to the current user.
See <a class="reference internal" href="../../book/box/authentication.html#authentication"><span class="std std-ref">Access control</span></a> for details about user privileges.</p>
<p>If the user has the full set of privileges (like ‘admin’), the contents
of <code class="docutils literal notranslate"><span class="pre">_vuser</span></code> match the contents of <code class="docutils literal notranslate"><span class="pre">_user</span></code>. If the user has limited
access, <code class="docutils literal notranslate"><span class="pre">_vuser</span></code> contains only tuples accessible to this user.</p>
<p>To see how <code class="docutils literal notranslate"><span class="pre">_vuser</span></code> works,
<a class="reference internal" href="../../getting_started/using_binary.html#connecting-remotely"><span class="std std-ref">connect to a Tarantool database remotely</span></a>
via <code class="docutils literal notranslate"><span class="pre">tarantoolctl</span></code> and select all tuples from the <code class="docutils literal notranslate"><span class="pre">_user</span></code>
space, both when the ‘guest’ user <em>is</em> and <em>is not</em> allowed to read from the
database.</p>
<p>First, start Tarantool and grant the ‘guest’ user with read, write and execute
privileges:</p>
<div class="highlight-tarantoolsession notranslate"><div class="highlight"><pre><span></span>tarantool&gt; box.cfg{listen = 3301}
---
...
tarantool&gt; box.schema.user.grant(&#39;guest&#39;, &#39;read,write,execute&#39;, &#39;universe&#39;)
---
...
</pre></div>
</div>
<p>Switch to the other terminal, connect to the Tarantool instance and select all
tuples from the <code class="docutils literal notranslate"><span class="pre">_user</span></code> space:</p>
<div class="highlight-tarantoolsession notranslate"><div class="highlight"><pre><span></span>$ tarantoolctl connect 3301
localhost:3301&gt; box.space._user:select{}
---
- - [0, 1, &#39;guest&#39;, &#39;user&#39;, {}]
  - [1, 1, &#39;admin&#39;, &#39;user&#39;, {}]
  - [2, 1, &#39;public&#39;, &#39;role&#39;, {}]
  - [3, 1, &#39;replication&#39;, &#39;role&#39;, {}]
  - [31, 1, &#39;super&#39;, &#39;role&#39;, {}]
...
</pre></div>
</div>
<p>This result contains the same set of users as if you made the request from your
Tarantool instance as ‘admin’.</p>
<p>Switch to the first terminal and revoke the read privileges from the ‘guest’ user:</p>
<div class="highlight-tarantoolsession notranslate"><div class="highlight"><pre><span></span>tarantool&gt; box.schema.user.revoke(&#39;guest&#39;, &#39;read&#39;, &#39;universe&#39;)
---
...
</pre></div>
</div>
<p>Switch to the other terminal, stop the session (to stop <code class="docutils literal notranslate"><span class="pre">tarantoolctl</span></code>, type Ctrl+C
or Ctrl+D) and repeat the <code class="docutils literal notranslate"><span class="pre">box.space._user:select{}</span></code> request. The access is
denied:</p>
<div class="highlight-tarantoolsession notranslate"><div class="highlight"><pre><span></span>$ tarantoolctl connect 3301
localhost:3301&gt; box.space._user:select{}
---
- error: Read access to space &#39;_user&#39; is denied for user &#39;guest&#39;
...
</pre></div>
</div>
<p>However, if you select from <code class="docutils literal notranslate"><span class="pre">_vuser</span></code> instead, the users’ data available for the
‘guest’ user is displayed:</p>
<div class="highlight-tarantoolsession notranslate"><div class="highlight"><pre><span></span>localhost:3301&gt; box.space._vuser:select{}
---
- - [0, 1, &#39;guest&#39;, &#39;user&#39;, {}]
...
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li><code class="docutils literal notranslate"><span class="pre">_vuser</span></code> is a system view, so it allows only read requests.</li>
<li>While the <code class="docutils literal notranslate"><span class="pre">_user</span></code> space requires proper access privileges, any user
can always read from <code class="docutils literal notranslate"><span class="pre">_vuser</span></code>.</li>
</ul>
</div>
</dd></dl>

</div>
<div class="section" id="example-using-data-operations">
<span id="box-space-operations-detailed-examples"></span><h2>Example: using data operations<a class="headerlink" href="#example-using-data-operations" title="Permalink to this headline">¶</a></h2>
<p>This example demonstrates all legal scenarios – as well as typical errors –
for each <a class="reference internal" href="../../book/box/data_model.html#index-box-data-operations"><span class="std std-ref">data operation</span></a> in Tarantool:
<a class="reference internal" href="box_space_index.html#box-space-operations-insert"><span class="std std-ref">INSERT</span></a>,
<a class="reference internal" href="box_space_index.html#box-space-operations-delete"><span class="std std-ref">DELETE</span></a>,
<a class="reference internal" href="box_space_index.html#box-space-operations-update"><span class="std std-ref">UPDATE</span></a>,
<a class="reference internal" href="box_space_index.html#box-space-operations-upsert"><span class="std std-ref">UPSERT</span></a>,
<a class="reference internal" href="box_space_index.html#box-space-operations-replace"><span class="std std-ref">REPLACE</span></a>, and
<a class="reference internal" href="box_space_index.html#box-space-operations-select"><span class="std std-ref">SELECT</span></a>.</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="c1">-- Bootstrap the database --</span>
<span class="n">box</span><span class="p">.</span><span class="n">cfg</span><span class="p">{}</span>
<span class="n">format</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">format</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;field1&#39;</span><span class="p">,</span> <span class="s1">&#39;unsigned&#39;</span><span class="p">}</span>
<span class="n">format</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;field2&#39;</span><span class="p">,</span> <span class="s1">&#39;unsigned&#39;</span><span class="p">}</span>
<span class="n">format</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;field3&#39;</span><span class="p">,</span> <span class="s1">&#39;unsigned&#39;</span><span class="p">}</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">box</span><span class="p">.</span><span class="n">schema</span><span class="p">.</span><span class="n">create_space</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="p">{</span><span class="n">format</span> <span class="o">=</span> <span class="n">format</span><span class="p">})</span>
<span class="c1">-- Create a primary index --</span>
<span class="n">pk</span> <span class="o">=</span> <span class="n">s</span><span class="p">:</span><span class="n">create_index</span><span class="p">(</span><span class="s1">&#39;pk&#39;</span><span class="p">,</span> <span class="p">{</span><span class="n">parts</span> <span class="o">=</span> <span class="p">{{</span><span class="s1">&#39;field1&#39;</span><span class="p">}}})</span>
<span class="c1">-- Create a unique secondary index --</span>
<span class="n">sk_uniq</span> <span class="o">=</span> <span class="n">s</span><span class="p">:</span><span class="n">create_index</span><span class="p">(</span><span class="s1">&#39;sk_uniq&#39;</span><span class="p">,</span> <span class="p">{</span><span class="n">parts</span> <span class="o">=</span> <span class="p">{{</span><span class="s1">&#39;field2&#39;</span><span class="p">}}})</span>
<span class="c1">-- Create a non-unique secondary index --</span>
<span class="n">sk_non_uniq</span> <span class="o">=</span> <span class="n">s</span><span class="p">:</span><span class="n">create_index</span><span class="p">(</span><span class="s1">&#39;sk_non_uniq&#39;</span><span class="p">,</span> <span class="p">{</span><span class="n">parts</span> <span class="o">=</span> <span class="p">{{</span><span class="s1">&#39;field3&#39;</span><span class="p">}},</span> <span class="n">unique</span> <span class="o">=</span> <span class="kc">false</span><span class="p">})</span>
</pre></div>
</div>
<div class="section" id="insert">
<span id="box-space-operations-insert"></span><h3>INSERT<a class="headerlink" href="#insert" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">insert</span></code> accepts a well-formatted tuple and checks all keys for duplicates.</p>
<div class="highlight-tarantoolsession notranslate"><div class="highlight"><pre><span></span>tarantool&gt; -- Unique indexes: ok --
tarantool&gt; s:insert({1, 1, 1})
---
- [1, 1, 1]
...
tarantool&gt; -- Conflicting primary key: error --
tarantool&gt; s:insert({1, 1, 1})
---
- error: Duplicate key exists in unique index &#39;pk&#39; in space &#39;test&#39;
...
tarantool&gt; -- Conflicting unique secondary key: error --
tarantool&gt; s:insert({2, 1, 1})
---
- error: Duplicate key exists in unique index &#39;sk_uniq&#39; in space &#39;test&#39;
...
tarantool&gt; -- Key {1} exists in sk_non_uniq index, but it is not unique: ok --
tarantool&gt; s:insert({2, 2, 1})
---
- [2, 2, 1]
...
tarantool&gt; s:truncate()
---
...
</pre></div>
</div>
</div>
<div class="section" id="delete">
<span id="box-space-operations-delete"></span><h3>DELETE<a class="headerlink" href="#delete" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">delete</span></code> accepts a full key of any unique index.</p>
<p><code class="docutils literal notranslate"><span class="pre">space:delete</span></code> is an alias for “delete by primary key”.</p>
<div class="highlight-tarantoolsession notranslate"><div class="highlight"><pre><span></span>tarantool&gt; -- Insert some test data --
tarantool&gt; s:insert{3, 4, 5}
---
- [3, 4, 5]
...
tarantool&gt; s:insert{6, 7, 8}
---
- [6, 7, 8]
...
tarantool&gt; s:insert{9, 10, 11}
---
- [9, 10, 11]
...
tarantool&gt; s:insert{12, 13, 14}
---
- [12, 13, 14]
...
tarantool&gt; -- Nothing done here: no {4} key in pk index --
tarantool&gt; s:delete{4}
---
...
tarantool&gt; s:select{}
---
- - [3, 4, 5]
  - [6, 7, 8]
  - [9, 10, 11]
  - [12, 13, 14]
...
tarantool&gt; -- Delete by a primary key: ok --
tarantool&gt; s:delete{3}
---
- [3, 4, 5]
...
tarantool&gt; s:select{}
---
- - [6, 7, 8]
  - [9, 10, 11]
  - [12, 13, 14]
...
tarantool&gt; -- Explicitly delete by a primary key: ok --
tarantool&gt; s.index.pk:delete{6}
---
- [6, 7, 8]
...
tarantool&gt; s:select{}
---
- - [9, 10, 11]
  - [12, 13, 14]
...
tarantool&gt; -- Delete by a unique secondary key: ok --
s.index.sk_uniq:delete{10}
---
- [9, 10, 11]
...
s:select{}
---
- - [12, 13, 14]
...
tarantool&gt; -- Delete by a non-unique secondary index: error --
tarantool&gt; s.index.sk_non_uniq:delete{14}
---
- error: Get() doesn&#39;t support partial keys and non-unique indexes
...
tarantool&gt; s:select{}
---
- - [12, 13, 14]
...
tarantool&gt; s:truncate()
---
...
</pre></div>
</div>
<p>The key must be full: <code class="docutils literal notranslate"><span class="pre">delete</span></code> cannot work with partial keys.</p>
<div class="highlight-tarantoolsession notranslate"><div class="highlight"><pre><span></span>tarantool&gt; s2 = box.schema.create_space(&#39;test2&#39;)
---
...
tarantool&gt; pk2 = s2:create_index(&#39;pk2&#39;, {parts = {{1, &#39;unsigned&#39;}, {2, &#39;unsigned&#39;}}})
---
...
tarantool&gt; s2:insert{1, 1}
---
- [1, 1]
...
tarantool&gt; -- Delete by a partial key: error --
tarantool&gt; s2:delete{1}
---
- error: Invalid key part count in an exact match (expected 2, got 1)
...
tarantool&gt; -- Delete by a full key: ok --
tarantool&gt; s2:delete{1, 1}
---
- [1, 1]
...
tarantool&gt; s2:select{}
---
- []
...
tarantool&gt; s2:drop()
---
...
</pre></div>
</div>
</div>
<div class="section" id="update">
<span id="box-space-operations-update"></span><h3>UPDATE<a class="headerlink" href="#update" title="Permalink to this headline">¶</a></h3>
<p>Similarly to <code class="docutils literal notranslate"><span class="pre">delete</span></code>, <code class="docutils literal notranslate"><span class="pre">update</span></code> accepts a full key of any unique index,
and also the operations to execute.</p>
<p><code class="docutils literal notranslate"><span class="pre">space:update</span></code> is an alias for “update by primary key”.</p>
<div class="highlight-tarantoolsession notranslate"><div class="highlight"><pre><span></span>tarantool&gt; -- Insert some test data --
tarantool&gt; s:insert{3, 4, 5}
---
- [3, 4, 5]
...
tarantool&gt; s:insert{6, 7, 8}
---
- [6, 7, 8]
...
tarantool&gt; s:insert{9, 10, 11}
---
- [9, 10, 11]
...
tarantool&gt; s:insert{12, 13, 14}
---
- [12, 13, 14]
...
tarantool&gt; -- Nothing done here: no {4} key in pk index --
s:update({4}, {{&#39;=&#39;, 2, 400}})
---
...
tarantool&gt; s:select{}
---
- - [3, 4, 5]
  - [6, 7, 8]
  - [9, 10, 11]
  - [12, 13, 14]
...
tarantool&gt; -- Update by a primary key: ok --
tarantool&gt; s:update({3}, {{&#39;=&#39;, 2, 400}})
---
- [3, 400, 5]
...
tarantool&gt; s:select{}
---
- - [3, 400, 5]
  - [6, 7, 8]
  - [9, 10, 11]
  - [12, 13, 14]
...
tarantool&gt; -- Explicitly update by a primary key: ok --
tarantool&gt; s.index.pk:update({6}, {{&#39;=&#39;, 2, 700}})
---
- [6, 700, 8]
...
tarantool&gt; s:select{}
---
- - [3, 400, 5]
  - [6, 700, 8]
  - [9, 10, 11]
  - [12, 13, 14]
...
tarantool&gt; -- Update by a unique secondary key: ok --
tarantool&gt; s.index.sk_uniq:update({10}, {{&#39;=&#39;, 2, 1000}})
---
- [9, 1000, 11]
...
tarantool&gt; s:select{}
---
- - [3, 400, 5]
  - [6, 700, 8]
  - [9, 1000, 11]
  - [12, 13, 14]
...
tarantool&gt; -- Update by a non-unique secondary key: error --
tarantool&gt; s.index.sk_non_uniq:update({14}, {{&#39;=&#39;, 2, 1300}})
---
- error: Get() doesn&#39;t support partial keys and non-unique indexes
...
tarantool&gt; s:select{}
---
- - [3, 400, 5]
  - [6, 700, 8]
  - [9, 1000, 11]
  - [12, 13, 14]
...
tarantool&gt; s:truncate()
---
...
</pre></div>
</div>
</div>
<div class="section" id="upsert">
<span id="box-space-operations-upsert"></span><h3>UPSERT<a class="headerlink" href="#upsert" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">upsert</span></code> accepts a well-formatted tuple and update operations.</p>
<p>If an old tuple is found by the primary key of the specified tuple,
then the update operations are applied to the old tuple,
and the new tuple is ignored.</p>
<p>If no old tuple is found, then the new tuple is inserted, and the
update operations are <strong>ignored</strong>.</p>
<p>Indexes have no <code class="docutils literal notranslate"><span class="pre">upsert</span></code> method - this is a method of a space.</p>
<div class="highlight-tarantoolsession notranslate"><div class="highlight"><pre><span></span>tarantool&gt; s.index.pk.upsert == nil
---
- true
...
tarantool&gt; s.index.sk_uniq.upsert == nil
---
- true
...
tarantool&gt; s.upsert ~= nil
---
- true
...
tarantool&gt; -- As the first argument, upsert accepts --
tarantool&gt; -- a well-formatted tuple, NOT a key! --
tarantool&gt; s:insert{1, 2, 3}
---
- [1, 2, 3]
...
tarantool&gt; s:upsert({1}, {{&#39;=&#39;, 2, 200}})
---
- error: Tuple field count 1 is less than required by space format or defined indexes
    (expected at least 3)
...
tarantool&gt; s:select{}
---
- - [1, 2, 3]
...
tarantool&gt; s:delete{1}
---
- [1, 2, 3]
...
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">upsert</span></code> turns into <code class="docutils literal notranslate"><span class="pre">insert</span></code> when no old tuple is found by the primary key.</p>
<div class="highlight-tarantoolsession notranslate"><div class="highlight"><pre><span></span>tarantool&gt; s:upsert({1, 2, 3}, {{&#39;=&#39;, 2, 200}})
---
...
tarantool&gt; -- As you can see, {1, 2, 3} were inserted, --
tarantool&gt; -- and the update operations were not applied. --
s:select{}
---
- - [1, 2, 3]
...
tarantool&gt; -- Performing another upsert with the same primary key, --
tarantool&gt; -- but different values in the other fields. --
s:upsert({1, 20, 30}, {{&#39;=&#39;, 2, 200}})
---
...
tarantool&gt; -- The old tuple was found by the primary key {1} --
tarantool&gt; -- and update operations were applied. --
tarantool&gt; -- The new tuple was ignored. --
tarantool&gt; s:select{}
---
- - [1, 200, 3]
...
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">upsert</span></code> searches for an old tuple by the primary index,
NOT by a secondary index. This can lead to a duplication error
if the new tuple ruins the uniqueness of a secondary index.</p>
<div class="highlight-tarantoolsession notranslate"><div class="highlight"><pre><span></span>tarantool&gt; s:upsert({2, 200, 3}, {{&#39;=&#39;, 3, 300}})
---
- error: Duplicate key exists in unique index &#39;sk_uniq&#39; in space &#39;test&#39;
...
s:select{}
---
- - [1, 200, 3]
...
tarantool&gt; -- But this works, when uniqueness is preserved. --
tarantool&gt; s:upsert({2, 0, 0}, {{&#39;=&#39;, 3, 300}})
---
...
tarantool&gt; s:select{}
---
- - [1, 200, 3]
  - [2, 0, 0]
...
tarantool&gt; s:truncate()
---
...
</pre></div>
</div>
</div>
<div class="section" id="replace">
<span id="box-space-operations-replace"></span><h3>REPLACE<a class="headerlink" href="#replace" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">replace</span></code> accepts a well-formatted tuple and searches for an old tuple
by the primary key of the new tuple.</p>
<p>If the old tuple is found, then it is deleted, and the new tuple is inserted.</p>
<p>If the old tuple was not found, then just the new tuple is inserted.</p>
<div class="highlight-tarantoolsession notranslate"><div class="highlight"><pre><span></span>tarantool&gt; s:replace{1, 2, 3}
---
- [1, 2, 3]
...
tarantool&gt; s:select{}
---
- - [1, 2, 3]
...
tarantool&gt; s:replace{1, 3, 4}
---
- [1, 3, 4]
...
tarantool&gt; s:select{}
---
- - [1, 3, 4]
...
tarantool&gt; s:truncate()
---
...
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">replace</span></code> can ruin unique constraints, like <code class="docutils literal notranslate"><span class="pre">upsert</span></code> does.</p>
<div class="highlight-tarantoolsession notranslate"><div class="highlight"><pre><span></span>tarantool&gt; s:insert{1, 1, 1}
---
- [1, 1, 1]
...
tarantool&gt; s:insert{2, 2, 2}
---
- [2, 2, 2]
...
tarantool&gt; -- This replace fails, because if the new tuple {1, 2, 0} replaces --
tarantool&gt; -- the old tuple by the primary key from &#39;pk&#39; index {1, 1, 1}, --
tarantool&gt; -- this results in a duplicate unique secondary key in &#39;sk_uniq&#39; index: --
tarantool&gt; -- key {2} is used both in the new tuple and in {2, 2, 2}. --
tarantool&gt; s:replace{1, 2, 0}
---
- error: Duplicate key exists in unique index &#39;sk_uniq&#39; in space &#39;test&#39;
...
tarantool&gt; s:truncate()
---
...
</pre></div>
</div>
</div>
<div class="section" id="select">
<span id="box-space-operations-select"></span><h3>SELECT<a class="headerlink" href="#select" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">select</span></code> works with any indexes (primary/secondary) and with any keys
(unique/non-unique, full/partial).</p>
<p>If a key is partial, then <code class="docutils literal notranslate"><span class="pre">select</span></code> searches by all keys, where the prefix
matches the specified key part.</p>
<div class="highlight-tarantoolsession notranslate"><div class="highlight"><pre><span></span>tarantool&gt; s:insert{1, 2, 3}
---
- [1, 2, 3]
...
tarantool&gt; s:insert{4, 5, 6}
---
- [4, 5, 6]
...
tarantool&gt; s:insert{7, 8, 9}
---
- [7, 8, 9]
...
tarantool&gt; s:insert{10, 11, 9}
---
- [10, 11, 9]
...
tarantool&gt; s:select{1}
---
- - [1, 2, 3]
...
tarantool&gt; s:select{}
---
- - [1, 2, 3]
  - [4, 5, 6]
  - [7, 8, 9]
  - [10, 11, 9]
...
tarantool&gt; s.index.pk:select{4}
---
- - [4, 5, 6]
...
tarantool&gt; s.index.sk_uniq:select{8}
---
- - [7, 8, 9]
...
tarantool&gt; s.index.sk_non_uniq:select{9}
---
- - [7, 8, 9]
  - [10, 11, 9]
...
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Tarantool Core Team

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>