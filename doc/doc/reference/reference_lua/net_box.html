

<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Module net.box &mdash; Tarantool Dev Docs  documentation</title>
  

  
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../../_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../index.html" class="icon icon-home" alt="Documentation Home"> Tarantool Dev Docs
          

          
            
            <img src="../../../../_static/logo_white_text.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../dev_guide/index.html">Contributor’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/index.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../internals/source/index.html">Tarantool internals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../internals/source/index.html#indices-and-tables">Indices and tables</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">Tarantool Dev Docs</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Module <cite>net.box</cite></li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../../_sources/doc/doc/reference/reference_lua/net_box.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="module-net-box">
<span id="net-box-module"></span><h1>Module <cite>net.box</cite><a class="headerlink" href="#module-net-box" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">net.box</span></code> module contains connectors to remote database systems. One
variant, to be discussed later, is for connecting to MySQL or MariaDB or PostgreSQL
(see <a class="reference internal" href="../reference_rock/dbms.html#dbms-modules"><span class="std std-ref">SQL DBMS modules</span></a> reference). The other variant, which
is discussed in this section, is for connecting to Tarantool server instances via a
network.</p>
<p>You can call the following methods:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">require('net.box')</span></code> to get a <code class="docutils literal notranslate"><span class="pre">net.box</span></code> object
(named <code class="docutils literal notranslate"><span class="pre">net_box</span></code> for examples in this section),</li>
<li><code class="docutils literal notranslate"><span class="pre">net_box.connect()</span></code> to connect and get a connection object
(named <code class="docutils literal notranslate"><span class="pre">conn</span></code> for examples in this section),</li>
<li>other <code class="docutils literal notranslate"><span class="pre">net.box()</span></code> routines, passing <code class="docutils literal notranslate"><span class="pre">conn:</span></code>, to execute requests on
the remote database system,</li>
<li><code class="docutils literal notranslate"><span class="pre">conn:close</span></code> to disconnect.</li>
</ul>
<p>All <code class="docutils literal notranslate"><span class="pre">net.box</span></code> methods are fiber-safe, that is, it is safe to share and use the
same connection object across multiple concurrent fibers. In fact that is perhaps
the best programming practice with Tarantool. When multiple fibers use the same
connection, all requests are pipelined through the same network socket, but each
fiber gets back a correct response. Reducing the number of active sockets lowers
the overhead of system calls and increases the overall server performance. However
for some cases a single connection is not enough —- for example, when
it is necessary to prioritize requests or to use different authentication IDs.</p>
<p id="net-box-options">Most <code class="docutils literal notranslate"><span class="pre">net.box</span></code> methods allow a final <code class="docutils literal notranslate"><span class="pre">{options}</span></code> argument, which can be:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">{timeout=...}</span></code>. For example, a method whose final argument is
<code class="docutils literal notranslate"><span class="pre">{timeout=1.5}</span></code> will stop after 1.5 seconds on the local node, although this
does not guarantee that execution will stop on the remote server node.</li>
<li><code class="docutils literal notranslate"><span class="pre">{buffer=...}</span></code>. For an example see <a class="reference internal" href="buffer.html#buffer-module"><span class="std std-ref">buffer module</span></a>.</li>
<li><code class="docutils literal notranslate"><span class="pre">{is_async=...}</span></code>. For example, a method whose final argument is
<code class="docutils literal notranslate"><span class="pre">{is_async=true}</span></code> will not wait for the result of a request. See the
<a class="reference internal" href="#net-box-is-async"><span class="std std-ref">is_async</span></a> description.</li>
<li><code class="docutils literal notranslate"><span class="pre">{on_push=...</span> <span class="pre">on_push_ctx=...}</span></code>. For receiving out-of-band messages.
See the <a class="reference internal" href="box_session.html#box-session-push"><span class="std std-ref">box.session.push</span></a> description.</li>
</ul>
<p>The diagram below shows possible connection states and transitions:</p>
<p>On this diagram:</p>
<ul class="simple">
<li>The state machine starts in the ‘initial’ state.</li>
<li><code class="docutils literal notranslate"><span class="pre">net_box.connect()</span></code> method changes the state to ‘connecting’ and spawns a worker fiber.</li>
<li>If authentication and schema upload are required, it’s possible later on to re-enter
the ‘fetch_schema’ state from ‘active’ if a request fails due to a schema version
mismatch error, so schema reload is triggered.</li>
<li><code class="docutils literal notranslate"><span class="pre">conn.close()</span></code> method sets the state to ‘closed’ and kills the worker.
If the transport is already in the ‘error’ state, <code class="docutils literal notranslate"><span class="pre">close()</span></code> does nothing.</li>
</ul>
</div>
<div class="section" id="index">
<h2>Index<a class="headerlink" href="#index" title="Permalink to this headline">¶</a></h2>
<p>Below is a list of all <code class="docutils literal notranslate"><span class="pre">net.box</span></code> functions.</p>
<div class="table docutils container">
<table border="1" class="left-align-column-1 left-align-column-2 docutils">
<colgroup>
<col width="66%" />
<col width="34%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Use</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><a class="reference internal" href="#net-box-connect"><span class="std std-ref">net_box.connect()</span></a> <a href="#id1"><span class="problematic" id="id2">|br|</span></a>
<a class="reference internal" href="#net-box-new"><span class="std std-ref">net_box.new()</span></a> <a href="#id3"><span class="problematic" id="id4">|br|</span></a>
<a class="reference internal" href="#net-box-self"><span class="std std-ref">net_box.self</span></a></td>
<td>Create a connection</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#conn-ping"><span class="std std-ref">conn:ping()</span></a></td>
<td>Execute a PING command</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#conn-wait-connected"><span class="std std-ref">conn:wait_connected()</span></a></td>
<td>Wait for a connection to
be active or closed</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#conn-is-connected"><span class="std std-ref">conn:is_connected()</span></a></td>
<td>Check if a connection
is active or closed</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#conn-wait-state"><span class="std std-ref">conn:wait_state()</span></a></td>
<td>Wait for a target state</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#conn-close"><span class="std std-ref">conn:close()</span></a></td>
<td>Close a connection</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#conn-select"><span class="std std-ref">conn.space.space-name:select{field-value}</span></a></td>
<td>Select one or more tuples</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#conn-get"><span class="std std-ref">conn.space.space-name:get{field-value}</span></a></td>
<td>Select a tuple</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#conn-insert"><span class="std std-ref">conn.space.space-name:insert{field-value}</span></a></td>
<td>Insert a tuple</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#conn-replace"><span class="std std-ref">conn.space.space-name:replace{field-value}</span></a></td>
<td>Insert or replace a tuple</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#conn-update"><span class="std std-ref">conn.space.space-name:update{field-value}</span></a></td>
<td>Update a tuple</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#conn-upsert"><span class="std std-ref">conn.space.space-name:upsert{field-value}</span></a></td>
<td>Update a tuple</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#conn-delete"><span class="std std-ref">conn.space.space-name:delete{field-value}</span></a></td>
<td>Delete a tuple</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#net-box-eval"><span class="std std-ref">conn:eval()</span></a></td>
<td>Evaluate and execute the
expression in a string</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#net-box-call"><span class="std std-ref">conn:call()</span></a></td>
<td>Call a stored procedure</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#conn-timeout"><span class="std std-ref">conn:timeout()</span></a></td>
<td>Set a timeout</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#net-box-on-connect"><span class="std std-ref">conn:on_connect()</span></a></td>
<td>Define a connect
trigger</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#net-box-on-disconnect"><span class="std std-ref">conn:on_disconnect()</span></a></td>
<td>Define a disconnect
trigger</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#net-box-on-schema-reload"><span class="std std-ref">conn:on_schema_reload()</span></a></td>
<td>Define a trigger when
schema is modified</td>
</tr>
</tbody>
</table>
</div>
<span class="target" id="module-net_box"></span><span class="target" id="net-box-connect"></span><dl class="function">
<dt id="net_box.connect">
<code class="descclassname">net_box.</code><code class="descname">connect</code><span class="sig-paren">(</span><em>URI</em><span class="optional">[</span>, <em>{option[s]}</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#net_box.connect" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<span class="target" id="net-box-new"></span><dl class="function">
<dt id="net_box.new">
<code class="descclassname">net_box.</code><code class="descname">new</code><span class="sig-paren">(</span><em>URI</em><span class="optional">[</span>, <em>{option[s]}</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#net_box.new" title="Permalink to this definition">¶</a></dt>
<dd><div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The names <code class="docutils literal notranslate"><span class="pre">connect()</span></code> and <code class="docutils literal notranslate"><span class="pre">new()</span></code> are synonyms: <code class="docutils literal notranslate"><span class="pre">connect()</span></code> is
preferred; <code class="docutils literal notranslate"><span class="pre">new()</span></code> is retained for backward compatibility.</p>
</div>
<p>Create a new connection. The connection is established on demand, at the
time of the first request. It can be re-established automatically after a
disconnect (see <code class="docutils literal notranslate"><span class="pre">reconnect_after</span></code> option below).
The returned <code class="docutils literal notranslate"><span class="pre">conn</span></code> object supports methods for making remote requests,
such as select, update or delete.</p>
<p>Possible options:</p>
<ul>
<li><p class="first"><cite>user/password</cite>: you have two ways to connect to a remote host:
using <a class="reference internal" href="../configuration/index.html#index-uri"><span class="std std-ref">URI</span></a> or using the options <cite>user</cite> and <cite>password</cite>. For
example, instead of <code class="docutils literal notranslate"><span class="pre">connect('username:userpassword&#64;localhost:33301')</span></code> you
can write <code class="docutils literal notranslate"><span class="pre">connect('localhost:33301',</span> <span class="pre">{user</span> <span class="pre">=</span> <span class="pre">'username',</span> <span class="pre">password='userpassword'})</span></code>.</p>
</li>
<li><p class="first"><cite>wait_connected</cite>: by default, connection creation is blocked until the connection is established,
but passing <code class="docutils literal notranslate"><span class="pre">wait_connected=false</span></code> makes it return immediately. Also, passing a timeout
makes it wait before returning (e.g. <code class="docutils literal notranslate"><span class="pre">wait_connected=1.5</span></code> makes it wait at most 1.5 seconds).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If <code class="docutils literal notranslate"><span class="pre">reconnect_after</span></code> is greater than zero, then <code class="docutils literal notranslate"><span class="pre">wait_connected</span></code> ignores transient failures.
The wait completes once the connection is established or is closed explicitly.</p>
</div>
</li>
<li><p class="first"><cite>reconnect_after</cite>: if <code class="docutils literal notranslate"><span class="pre">reconnect_after</span></code> is greater than zero, then a <code class="docutils literal notranslate"><span class="pre">net.box</span></code> instance
will try to reconnect if a connection is broken or if a connection attempt fails.
This makes transient network failures become transparent to the application.
Reconnect happens automatically in the background, so requests that
initially fail due to connectivity loss are transparently retried.
The number of retries is unlimited, connection attempts are made after each
specified interval (for example <code class="docutils literal notranslate"><span class="pre">reconnect_after=5</span></code> means try to reconnect every 5 seconds).
When a connection is explicitly closed, or when the Lua garbage collector
removes it, then reconnect attempts stop.
The default value of <code class="docutils literal notranslate"><span class="pre">reconnect_after</span></code>, as with other <code class="docutils literal notranslate"><span class="pre">connect</span></code> options, is <code class="docutils literal notranslate"><span class="pre">nil</span></code>.</p>
</li>
<li><p class="first"><cite>call_16</cite>: [since 1.7.2] by default, <code class="docutils literal notranslate"><span class="pre">net.box</span></code> connections comply with a new
binary protocol command for CALL, which is not backward compatible with previous versions.
The new CALL no longer restricts a function to returning an array of tuples
and allows returning an arbitrary MsgPack/JSON result, including scalars, nil and void (nothing).
The old CALL is left intact for backward compatibility.
It will be removed in the next major release.
All programming language drivers will be gradually changed to use the new CALL.
To connect to a Tarantool instance that uses the old CALL, specify <code class="docutils literal notranslate"><span class="pre">call_16=true</span></code>.</p>
</li>
<li><p class="first"><cite>console</cite>: depending on the option’s value, the connection supports different methods
(as if instances of different classes were returned). With <code class="docutils literal notranslate"><span class="pre">console</span> <span class="pre">=</span> <span class="pre">true</span></code>, you can use
<code class="docutils literal notranslate"><span class="pre">conn</span></code> methods <code class="docutils literal notranslate"><span class="pre">close()</span></code>, <code class="docutils literal notranslate"><span class="pre">is_connected()</span></code>, <code class="docutils literal notranslate"><span class="pre">wait_state()</span></code>, <code class="docutils literal notranslate"><span class="pre">eval()</span></code> (in this case, both
binary and Lua console network protocols are supported). With <code class="docutils literal notranslate"><span class="pre">console</span> <span class="pre">=</span> <span class="pre">false</span></code> (default), you can
also use <code class="docutils literal notranslate"><span class="pre">conn</span></code> database methods (in this case, only the binary protocol is supported).
Deprecation notice: <code class="docutils literal notranslate"><span class="pre">console</span> <span class="pre">=</span> <span class="pre">true</span></code> is deprecated, users should use
<a class="reference internal" href="console.html#console-connect"><span class="std std-ref">console.connect()</span></a> instead.</p>
</li>
<li><p class="first"><cite>connect_timeout</cite>: number of seconds to wait before returning “error: Connection timed out”.</p>
</li>
</ul>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>URI</strong> (<em>string</em>) – the <a class="reference internal" href="../configuration/index.html#index-uri"><span class="std std-ref">URI</span></a> of the target for the connection</li>
<li><strong>options</strong> – possible options are <cite>user</cite>, <cite>password</cite>, <cite>wait_connected</cite>,
<cite>reconnect_after</cite>, <cite>call_16</cite>, <cite>console</cite> and <cite>connect_timeout</cite></li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">conn object</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">userdata</p>
</td>
</tr>
</tbody>
</table>
<p><strong>Examples:</strong></p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">conn</span> <span class="o">=</span> <span class="n">net_box</span><span class="p">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;localhost:3301&#39;</span><span class="p">)</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">net_box</span><span class="p">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;127.0.0.1:3302&#39;</span><span class="p">,</span> <span class="p">{</span><span class="n">wait_connected</span> <span class="o">=</span> <span class="kc">false</span><span class="p">})</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">net_box</span><span class="p">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;127.0.0.1:3303&#39;</span><span class="p">,</span> <span class="p">{</span><span class="n">reconnect_after</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">call_16</span> <span class="o">=</span> <span class="kc">true</span><span class="p">})</span>
</pre></div>
</div>
</dd></dl>

<span class="target" id="net-box-self"></span><dl class="class">
<dt id="net_box.self">
<em class="property">class </em><code class="descclassname">net_box.</code><code class="descname">self</code><a class="headerlink" href="#net_box.self" title="Permalink to this definition">¶</a></dt>
<dd><p>For a local Tarantool server, there is a pre-created always-established
connection object named <code class="samp docutils literal notranslate"><em><span class="pre">net_box</span></em><span class="pre">.self</span></code>. Its purpose is to make
polymorphic use of the <code class="docutils literal notranslate"><span class="pre">net_box</span></code> API easier. Therefore
<code class="samp docutils literal notranslate"><span class="pre">conn</span> <span class="pre">=</span> <em><span class="pre">net_box</span></em><span class="pre">.connect('localhost:3301')</span></code>
can be replaced by <code class="samp docutils literal notranslate"><span class="pre">conn</span> <span class="pre">=</span> <em><span class="pre">net_box</span></em><span class="pre">.self</span></code>.</p>
<p>However, there is an important difference between the embedded connection
and a remote one:</p>
<ul class="simple">
<li>With the embedded connection, requests which do not modify data do not yield.
When using a remote connection, due to
<a class="reference internal" href="../../book/box/atomic_index.html#atomic-implicit-yields"><span class="std std-ref">the implicit rules</span></a>
any request can yield, and the database state may have changed by the
time it regains control.</li>
<li>All the options passed to a request (as <code class="docutils literal notranslate"><span class="pre">is_async</span></code>, <code class="docutils literal notranslate"><span class="pre">on_push</span></code>, <code class="docutils literal notranslate"><span class="pre">timeout</span></code>)
will be ignored.</li>
</ul>
</dd></dl>

<dl class="class">
<dt id="net_box.conn">
<em class="property">class </em><code class="descclassname">net_box.</code><code class="descname">conn</code><a class="headerlink" href="#net_box.conn" title="Permalink to this definition">¶</a></dt>
<dd><span class="target" id="conn-ping"></span><dl class="method">
<dt id="net_box.conn.ping">
<code class="descname">ping</code><span class="sig-paren">(</span><span class="optional">[</span><em>options</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#net_box.conn.ping" title="Permalink to this definition">¶</a></dt>
<dd><p>Execute a PING command.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>options</strong> (<em>table</em>) – the supported option is <code class="samp docutils literal notranslate"><span class="pre">timeout=</span><em><span class="pre">seconds</span></em></code></td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">true on success, false on error</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">boolean</td>
</tr>
</tbody>
</table>
<p><strong>Example:</strong></p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">net_box</span><span class="p">.</span><span class="n">self</span><span class="p">:</span><span class="n">ping</span><span class="p">({</span><span class="n">timeout</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">})</span>
</pre></div>
</div>
</dd></dl>

<span class="target" id="conn-wait-connected"></span><dl class="method">
<dt id="net_box.conn.wait_connected">
<code class="descname">wait_connected</code><span class="sig-paren">(</span><span class="optional">[</span><em>timeout</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#net_box.conn.wait_connected" title="Permalink to this definition">¶</a></dt>
<dd><p>Wait for connection to be active or closed.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>timeout</strong> (<em>number</em>) – in seconds</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">true when connected, false on failure.</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">boolean</td>
</tr>
</tbody>
</table>
<p><strong>Example:</strong></p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">net_box</span><span class="p">.</span><span class="n">self</span><span class="p">:</span><span class="n">wait_connected</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<span class="target" id="conn-is-connected"></span><dl class="method">
<dt id="net_box.conn.is_connected">
<code class="descname">is_connected</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#net_box.conn.is_connected" title="Permalink to this definition">¶</a></dt>
<dd><p>Show whether connection is active or closed.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">true if connected, false on failure.</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">boolean</td>
</tr>
</tbody>
</table>
<p><strong>Example:</strong></p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">net_box</span><span class="p">.</span><span class="n">self</span><span class="p">:</span><span class="n">is_connected</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<span class="target" id="conn-wait-state"></span><dl class="method">
<dt id="net_box.conn.wait_state">
<code class="descname">wait_state</code><span class="sig-paren">(</span><em>state[s]</em><span class="optional">[</span>, <em>timeout</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#net_box.conn.wait_state" title="Permalink to this definition">¶</a></dt>
<dd><p>[since 1.7.2] Wait for a target state.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>states</strong> (<em>string</em>) – target states</li>
<li><strong>timeout</strong> (<em>number</em>) – in seconds</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">true when a target state is reached, false on timeout or connection closure</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">boolean</p>
</td>
</tr>
</tbody>
</table>
<p><strong>Examples:</strong></p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="c1">-- wait infinitely for &#39;active&#39; state:</span>
<span class="n">conn</span><span class="p">:</span><span class="n">wait_state</span><span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">)</span>

<span class="c1">-- wait for 1.5 secs at most:</span>
<span class="n">conn</span><span class="p">:</span><span class="n">wait_state</span><span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)</span>

<span class="c1">-- wait infinitely for either `active` or `fetch_schema` state:</span>
<span class="n">conn</span><span class="p">:</span><span class="n">wait_state</span><span class="p">({</span><span class="n">active</span><span class="o">=</span><span class="kc">true</span><span class="p">,</span> <span class="n">fetch_schema</span><span class="o">=</span><span class="kc">true</span><span class="p">})</span>
</pre></div>
</div>
</dd></dl>

<span class="target" id="conn-close"></span><dl class="method">
<dt id="net_box.conn.close">
<code class="descname">close</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#net_box.conn.close" title="Permalink to this definition">¶</a></dt>
<dd><p>Close a connection.</p>
<p>Connection objects are destroyed by the Lua garbage collector, just like any other objects in Lua, so
an explicit destruction is not mandatory. However, since close() is a system
call, it is good programming practice to close a connection explicitly when it
is no longer needed, to avoid lengthy stalls of the garbage collector.</p>
<p><strong>Example:</strong></p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">conn</span><span class="p">:</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<span class="target" id="conn-select"></span><dl class="method">
<dt>
<code class="descname">conn.space.&lt;space-name&gt;:select({field-value, ...} [, {options}])</code></dt>
<dd><p><code class="samp docutils literal notranslate"><span class="pre">conn.space.</span><em><span class="pre">space-name</span></em><span class="pre">:select</span></code><code class="code docutils literal notranslate"><span class="pre">({...})</span></code> is the remote-call equivalent
of the local call <code class="samp docutils literal notranslate"><span class="pre">box.space.</span><em><span class="pre">space-name</span></em><span class="pre">:select</span></code><code class="code docutils literal notranslate"><span class="pre">{...}</span></code>
(<a class="reference internal" href="box_space_index.html#box-space-select"><span class="std std-ref">see details</span></a>).</p>
<p><strong>Example:</strong></p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">conn</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">testspace</span><span class="p">:</span><span class="nb">select</span><span class="p">({</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">},</span> <span class="p">{</span><span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">})</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Due to <a class="reference internal" href="../../book/box/atomic_index.html#atomic-implicit-yields"><span class="std std-ref">the implicit yield rules</span></a>
a local <code class="samp docutils literal notranslate"><span class="pre">box.space.</span><em><span class="pre">space-name</span></em><span class="pre">:select</span></code><code class="code docutils literal notranslate"><span class="pre">{...}</span></code> does
not yield, but a remote <code class="samp docutils literal notranslate"><span class="pre">conn.space.</span><em><span class="pre">space-name</span></em><span class="pre">:select</span></code><code class="code docutils literal notranslate"><span class="pre">{...}</span></code>
call does yield, so global variables or database tuples data may
change when a remote <code class="samp docutils literal notranslate"><span class="pre">conn.space.</span><em><span class="pre">space-name</span></em><span class="pre">:select</span></code><code class="code docutils literal notranslate"><span class="pre">{...}</span></code>
occurs.</p>
</div>
</dd></dl>

<span class="target" id="conn-get"></span><dl class="method">
<dt>
<code class="descname">conn.space.&lt;space-name&gt;:get({field-value, ...} [, {options}])</code></dt>
<dd><p><code class="samp docutils literal notranslate"><span class="pre">conn.space.</span><em><span class="pre">space-name</span></em><span class="pre">:get(...)</span></code> is the remote-call equivalent
of the local call <code class="samp docutils literal notranslate"><span class="pre">box.space.</span><em><span class="pre">space-name</span></em><span class="pre">:get(...)</span></code>
(<a class="reference internal" href="box_space_index.html#box-space-get"><span class="std std-ref">see details</span></a>).</p>
<p><strong>Example:</strong></p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">conn</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">testspace</span><span class="p">:</span><span class="n">get</span><span class="p">({</span><span class="mi">1</span><span class="p">})</span>
</pre></div>
</div>
</dd></dl>

<span class="target" id="conn-insert"></span><dl class="method">
<dt>
<code class="descname">conn.space.&lt;space-name&gt;:insert({field-value, ...} [, {options}])</code></dt>
<dd><p><code class="samp docutils literal notranslate"><span class="pre">conn.space.</span><em><span class="pre">space-name</span></em><span class="pre">:insert(...)</span></code> is the remote-call equivalent
of the local call <code class="samp docutils literal notranslate"><span class="pre">box.space.</span><em><span class="pre">space-name</span></em><span class="pre">:insert(...)</span></code>
(<a class="reference internal" href="box_space_index.html#box-space-insert"><span class="std std-ref">see details</span></a>).</p>
<p><strong>Example:</strong></p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">conn</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">testspace</span><span class="p">:</span><span class="n">insert</span><span class="p">({</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">},</span> <span class="p">{</span><span class="n">timeout</span><span class="o">=</span><span class="mf">1.1</span><span class="p">})</span>
</pre></div>
</div>
</dd></dl>

<span class="target" id="conn-replace"></span><dl class="method">
<dt>
<code class="descname">conn.space.&lt;space-name&gt;:replace({field-value, ...} [, {options}])</code></dt>
<dd><p><code class="samp docutils literal notranslate"><span class="pre">conn.space.</span><em><span class="pre">space-name</span></em><span class="pre">:replace(...)</span></code> is the remote-call equivalent
of the local call <code class="samp docutils literal notranslate"><span class="pre">box.space.</span><em><span class="pre">space-name</span></em><span class="pre">:replace(...)</span></code>
(<a class="reference internal" href="box_space_index.html#box-space-replace"><span class="std std-ref">see details</span></a>).</p>
<p><strong>Example:</strong></p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">conn</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">testspace</span><span class="p">:</span><span class="n">replace</span><span class="p">({</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">})</span>
</pre></div>
</div>
</dd></dl>

<span class="target" id="conn-update"></span><dl class="method">
<dt>
<code class="descname">conn.space.&lt;space-name&gt;:update({field-value, ...} [, {options}])</code></dt>
<dd><p><code class="samp docutils literal notranslate"><span class="pre">conn.space.</span><em><span class="pre">space-name</span></em><span class="pre">:update(...)</span></code> is the remote-call equivalent
of the local call <code class="samp docutils literal notranslate"><span class="pre">box.space.</span><em><span class="pre">space-name</span></em><span class="pre">:update(...)</span></code>
(<a class="reference internal" href="box_space_index.html#box-space-update"><span class="std std-ref">see details</span></a>).</p>
<p><strong>Example:</strong></p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">conn</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">Q</span><span class="p">:</span><span class="n">update</span><span class="p">({</span><span class="mi">1</span><span class="p">},{{</span><span class="s1">&#39;=&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">}},</span> <span class="p">{</span><span class="n">timeout</span><span class="o">=</span><span class="mi">0</span><span class="p">})</span>
</pre></div>
</div>
</dd></dl>

<span class="target" id="conn-upsert"></span><dl class="method">
<dt>
<code class="descname">conn.space.&lt;space-name&gt;:upsert({field-value, ...} [, {options}])</code></dt>
<dd><p><code class="samp docutils literal notranslate"><span class="pre">conn.space.</span><em><span class="pre">space-name</span></em><span class="pre">:upsert(...)</span></code> is the remote-call equivalent
of the local call <code class="samp docutils literal notranslate"><span class="pre">box.space.</span><em><span class="pre">space-name</span></em><span class="pre">:upsert(...)</span></code>
(<a class="reference internal" href="box_space_index.html#box-space-upsert"><span class="std std-ref">see details</span></a>).</p>
</dd></dl>

<span class="target" id="conn-delete"></span><dl class="method">
<dt>
<code class="descname">conn.space.&lt;space-name&gt;:delete({field-value, ...} [, {options}])</code></dt>
<dd><p><code class="samp docutils literal notranslate"><span class="pre">conn.space.</span><em><span class="pre">space-name</span></em><span class="pre">:delete(...)</span></code> is the remote-call equivalent
of the local call <code class="samp docutils literal notranslate"><span class="pre">box.space.</span><em><span class="pre">space-name</span></em><span class="pre">:delete(...)</span></code>
(<a class="reference internal" href="box_space_index.html#box-space-delete"><span class="std std-ref">see details</span></a>).</p>
</dd></dl>

<span class="target" id="net-box-eval"></span><dl class="method">
<dt id="net_box.conn.eval">
<code class="descname">eval</code><span class="sig-paren">(</span><em>Lua-string</em><span class="optional">[</span>, <em>{arguments}</em><span class="optional">[</span>, <em>{options}</em><span class="optional">]</span><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#net_box.conn.eval" title="Permalink to this definition">¶</a></dt>
<dd><p><code class="samp docutils literal notranslate"><span class="pre">conn:eval(</span><em><span class="pre">Lua-string</span></em><span class="pre">)</span></code> evaluates and executes the expression
in Lua-string, which may be any statement or series of statements.
An <a class="reference internal" href="../../book/box/authentication_index.html#authentication-owners-privileges"><span class="std std-ref">execute privilege</span></a> is required;
if the user does not have it, an administrator may grant it with
<code class="samp docutils literal notranslate"><span class="pre">box.schema.user.grant(</span><em><span class="pre">username</span></em><span class="pre">,</span> <span class="pre">'execute',</span> <span class="pre">'universe')</span></code>.</p>
<p>To ensure that the return from <code class="docutils literal notranslate"><span class="pre">conn:eval</span></code> is whatever the Lua expression returns,
begin the Lua-string with the word “return”.</p>
<p><strong>Examples:</strong></p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">tarantool</span><span class="o">&gt;</span> <span class="c1">--Lua-string</span>
<span class="n">tarantool</span><span class="o">&gt;</span> <span class="n">conn</span><span class="p">:</span><span class="n">eval</span><span class="p">(</span><span class="s1">&#39;function f5() return 5+5 end; return f5();&#39;</span><span class="p">)</span>
<span class="c1">---</span>
<span class="o">-</span> <span class="mi">10</span>
<span class="p">...</span>
<span class="n">tarantool</span><span class="o">&gt;</span> <span class="c1">--Lua-string, {arguments}</span>
<span class="n">tarantool</span><span class="o">&gt;</span> <span class="n">conn</span><span class="p">:</span><span class="n">eval</span><span class="p">(</span><span class="s1">&#39;return ...&#39;</span><span class="p">,</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,{</span><span class="mi">3</span><span class="p">,</span><span class="s1">&#39;x&#39;</span><span class="p">}})</span>
<span class="c1">---</span>
<span class="o">-</span> <span class="mi">1</span>
<span class="o">-</span> <span class="mi">2</span>
<span class="o">-</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">]</span>
<span class="p">...</span>
<span class="n">tarantool</span><span class="o">&gt;</span> <span class="c1">--Lua-string, {arguments}, {options}</span>
<span class="n">tarantool</span><span class="o">&gt;</span> <span class="n">conn</span><span class="p">:</span><span class="n">eval</span><span class="p">(</span><span class="s1">&#39;return {nil,5}&#39;</span><span class="p">,</span> <span class="p">{},</span> <span class="p">{</span><span class="n">timeout</span><span class="o">=</span><span class="mf">0.1</span><span class="p">})</span>
<span class="c1">---</span>
<span class="o">-</span> <span class="p">[</span><span class="n">null</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
<span class="p">...</span>
</pre></div>
</div>
</dd></dl>

<span class="target" id="net-box-call"></span><dl class="method">
<dt id="net_box.conn.call">
<code class="descname">call</code><span class="sig-paren">(</span><em>function-name</em><span class="optional">[</span>, <em>{arguments}</em><span class="optional">[</span>, <em>{options}</em><span class="optional">]</span><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#net_box.conn.call" title="Permalink to this definition">¶</a></dt>
<dd><p><code class="docutils literal notranslate"><span class="pre">conn:call('func',</span> <span class="pre">{'1',</span> <span class="pre">'2',</span> <span class="pre">'3'})</span></code> is the remote-call equivalent of
<code class="docutils literal notranslate"><span class="pre">func('1',</span> <span class="pre">'2',</span> <span class="pre">'3')</span></code>. That is, <code class="docutils literal notranslate"><span class="pre">conn:call</span></code> is a remote
stored-procedure call. The return from <code class="docutils literal notranslate"><span class="pre">conn:call</span></code> is whatever the function returns.</p>
<p>Limitation: the called function cannot return a function, for example
if <code class="docutils literal notranslate"><span class="pre">func2</span></code> is defined as <code class="docutils literal notranslate"><span class="pre">function</span> <span class="pre">func2</span> <span class="pre">()</span> <span class="pre">return</span> <span class="pre">func</span> <span class="pre">end</span></code> then
<code class="docutils literal notranslate"><span class="pre">conn:call(func2)</span></code> will return “error: unsupported Lua type ‘function’”.</p>
<p><strong>Examples:</strong></p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">tarantool</span><span class="o">&gt;</span> <span class="c1">-- create 2 functions with conn:eval()</span>
<span class="n">tarantool</span><span class="o">&gt;</span> <span class="n">conn</span><span class="p">:</span><span class="n">eval</span><span class="p">(</span><span class="s1">&#39;function f1() return 5+5 end;&#39;</span><span class="p">)</span>
<span class="n">tarantool</span><span class="o">&gt;</span> <span class="n">conn</span><span class="p">:</span><span class="n">eval</span><span class="p">(</span><span class="s1">&#39;function f2(x,y) return x,y end;&#39;</span><span class="p">)</span>
<span class="n">tarantool</span><span class="o">&gt;</span> <span class="c1">-- call first function with no parameters and no options</span>
<span class="n">tarantool</span><span class="o">&gt;</span> <span class="n">conn</span><span class="p">:</span><span class="n">call</span><span class="p">(</span><span class="s1">&#39;f1&#39;</span><span class="p">)</span>
<span class="c1">---</span>
<span class="o">-</span> <span class="mi">10</span>
<span class="p">...</span>
<span class="n">tarantool</span><span class="o">&gt;</span> <span class="c1">-- call second function with two parameters and one option</span>
<span class="n">tarantool</span><span class="o">&gt;</span> <span class="n">conn</span><span class="p">:</span><span class="n">call</span><span class="p">(</span><span class="s1">&#39;f2&#39;</span><span class="p">,{</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">},{</span><span class="n">timeout</span><span class="o">=</span><span class="mi">99</span><span class="p">})</span>
<span class="c1">---</span>
<span class="o">-</span> <span class="mi">1</span>
<span class="o">-</span> <span class="n">B</span>
<span class="p">...</span>
</pre></div>
</div>
</dd></dl>

<span class="target" id="conn-timeout"></span><dl class="method">
<dt id="net_box.conn.timeout">
<code class="descname">timeout</code><span class="sig-paren">(</span><em>timeout</em><span class="sig-paren">)</span><a class="headerlink" href="#net_box.conn.timeout" title="Permalink to this definition">¶</a></dt>
<dd><p><code class="docutils literal notranslate"><span class="pre">timeout(...)</span></code> is a wrapper which sets a timeout for the request that
follows it. Since version 1.7.4 this method is deprecated – it is better
to pass a timeout value for a method’s <code class="docutils literal notranslate"><span class="pre">{options}</span></code> parameter.</p>
<p><strong>Example:</strong></p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">conn</span><span class="p">:</span><span class="n">timeout</span><span class="p">(</span><span class="mf">0.5</span><span class="p">).</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="n">update</span><span class="p">({</span><span class="mi">1</span><span class="p">},</span> <span class="p">{{</span><span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">15</span><span class="p">}})</span>
</pre></div>
</div>
<p>Although <code class="docutils literal notranslate"><span class="pre">timeout(...)</span></code> is deprecated, all
remote calls support its use. Using a wrapper object makes
the remote connection API compatible with the local one, removing the need
for a separate <code class="docutils literal notranslate"><span class="pre">timeout</span></code> argument, which the local version would ignore. Once
a request is sent, it cannot be revoked from the remote server even if a
timeout expires: the timeout expiration only aborts the wait for the remote
server response, not the request itself.</p>
</dd></dl>

<span class="target" id="net-box-is-async"></span><dl class="method">
<dt id="net_box.conn.request">
<code class="descname">request</code><span class="sig-paren">(</span><em>... {is_async=...}</em><span class="sig-paren">)</span><a class="headerlink" href="#net_box.conn.request" title="Permalink to this definition">¶</a></dt>
<dd><p><code class="docutils literal notranslate"><span class="pre">{is_async=true|false}</span></code> is an option which is applicable for all
<code class="docutils literal notranslate"><span class="pre">net_box</span></code> requests including <code class="docutils literal notranslate"><span class="pre">conn:call</span></code>, <code class="docutils literal notranslate"><span class="pre">conn:eval</span></code>, and the
<code class="docutils literal notranslate"><span class="pre">conn.space.space-name</span></code> requests.</p>
<p>The default is <code class="docutils literal notranslate"><span class="pre">is_async=false</span></code>, meaning requests are synchronous
for the fiber. The fiber is blocked, waiting until there is a
reply to the request or until timeout expires. Before Tarantool
version 1.10, the only way to make asynchronous requests was to
put them in separate fibers.</p>
<p>The non-default is <code class="docutils literal notranslate"><span class="pre">is_async=true</span></code>, meaning requests are asynchronous
for the fiber. The request causes a yield but there is no waiting.
The immediate return is not the result of the request, instead it is
an object that the calling program can use later to get the result of the
request.</p>
<p>This immediately-returned object, which we’ll call “future”,
has its own methods:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">future:is_ready()</span></code> which will return true
when the result of the request is available,</li>
<li><code class="docutils literal notranslate"><span class="pre">future:result()</span></code> to get the result of the request (returns the
response or <strong>nil</strong> in case it’s not ready yet or there has been an error),</li>
<li><code class="docutils literal notranslate"><span class="pre">future:wait_result(timeout)</span></code> to
wait until the result of the request is available and then get it, or
throw an error if there is no result after the timeout exceeded,</li>
<li><code class="docutils literal notranslate"><span class="pre">future:discard()</span></code> to abandon the object.</li>
</ul>
<p>Typically a user would say <code class="docutils literal notranslate"><span class="pre">future=request-name(...{is_async=true})</span></code>,
then either loop checking <code class="docutils literal notranslate"><span class="pre">future:is_ready()</span></code> until it is true and
then say <code class="docutils literal notranslate"><span class="pre">request_result=future:result()</span></code>,
or say <code class="docutils literal notranslate"><span class="pre">request_result=future:wait_result(...)</span></code>.
Alternatively the client could check for “out-of-band” messages from the server
by calling <code class="docutils literal notranslate"><span class="pre">pairs()</span></code> in a loop – see <a class="reference internal" href="box_session.html#box-session-push"><span class="std std-ref">box.session.push()</span></a>.</p>
<p>A user would say <code class="docutils literal notranslate"><span class="pre">future:discard()</span></code> to make a connection forget about the response –
if a response for a discarded object is received then it will be ignored, so that
the size of the requests table will be reduced and other requests will be faster.</p>
<p><strong>Example:</strong></p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">tarantool</span><span class="o">&gt;</span> <span class="n">future</span> <span class="o">=</span> <span class="n">conn</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="n">insert</span><span class="p">({</span><span class="mi">900</span><span class="p">},{</span><span class="n">is_async</span><span class="o">=</span><span class="kc">true</span><span class="p">})</span>
<span class="c1">---</span>
<span class="p">...</span>
<span class="n">tarantool</span><span class="o">&gt;</span> <span class="n">future</span>
<span class="c1">---</span>
<span class="o">-</span> <span class="n">method</span><span class="p">:</span> <span class="n">insert</span>
  <span class="n">response</span><span class="p">:</span> <span class="p">[</span><span class="mi">900</span><span class="p">]</span>
  <span class="n">cond</span><span class="p">:</span> <span class="n">cond</span>
  <span class="n">on_push_ctx</span><span class="p">:</span> <span class="p">[]</span>
  <span class="n">on_push</span><span class="p">:</span> <span class="s1">&#39;function: builtin#91&#39;</span>
<span class="p">...</span>
<span class="n">tarantool</span><span class="o">&gt;</span> <span class="n">future</span><span class="p">:</span><span class="n">is_ready</span><span class="p">()</span>
<span class="c1">---</span>
<span class="o">-</span> <span class="kc">true</span>
<span class="p">...</span>
<span class="n">tarantool</span><span class="o">&gt;</span> <span class="n">future</span><span class="p">:</span><span class="n">result</span><span class="p">()</span>
<span class="c1">---</span>
<span class="o">-</span> <span class="p">[</span><span class="mi">900</span><span class="p">]</span>
<span class="p">...</span>
</pre></div>
</div>
<p>Typically <code class="docutils literal notranslate"><span class="pre">{is_async=true}</span></code> is used only if the load is
large (more than 100,000 requests per second) and latency
is large (more than 1 second), or when it is necessary to
send multiple requests in parallel then collect responses
(sometimes called a “map-reduce” scenario).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Although the final result of an async request is the same as
the result of a sync request, it is structured differently: as a
table, instead of as the unpacked values.</p>
</div>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="triggers">
<span id="net-box-triggers"></span><h2>Triggers<a class="headerlink" href="#triggers" title="Permalink to this headline">¶</a></h2>
<p>With the <code class="docutils literal notranslate"><span class="pre">net.box</span></code> module, you can use the following
<a class="reference internal" href="../../book/box/triggers.html#triggers-box-triggers"><span class="std std-ref">triggers</span></a>:</p>
<span class="target" id="net-box-on-connect"></span><dl class="function">
<dt>
<code class="descname">conn:on_connect([trigger-function[, old-trigger-function]])</code></dt>
<dd><p>Define a trigger for execution when a new connection is established, and authentication
and schema fetch are completed due to an event such as <code class="docutils literal notranslate"><span class="pre">net_box.connect</span></code>.
If the trigger execution fails and an exception happens, the connection’s
state changes to ‘error’. In this case, the connection is terminated, regardless of the
<code class="docutils literal notranslate"><span class="pre">reconnect_after</span></code> option’s value. Can be called as many times as
reconnection happens, if <code class="docutils literal notranslate"><span class="pre">reconnect_after</span></code> is greater than zero.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>trigger-function</strong> (<em>function</em>) – function which will become the trigger
function. Takes the <code class="docutils literal notranslate"><span class="pre">conn</span></code>
object as the first argument</li>
<li><strong>old-trigger-function</strong> (<em>function</em>) – existing trigger function which will
be replaced by trigger-function</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">nil or function pointer</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<span class="target" id="net-box-on-disconnect"></span><dl class="function">
<dt>
<code class="descname">conn:on_disconnect([trigger-function[, old-trigger-function]])</code></dt>
<dd><p>Define a trigger for execution after a connection is closed. If the trigger
function causes an error, the error is logged but otherwise is ignored.
Execution stops after a connection is explicitly closed, or once the Lua
garbage collector removes it.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>trigger-function</strong> (<em>function</em>) – function which will become the trigger
function. Takes the <code class="docutils literal notranslate"><span class="pre">conn</span></code>
object as the first argument</li>
<li><strong>old-trigger-function</strong> (<em>function</em>) – existing trigger function which will
be replaced by trigger-function</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">nil or function pointer</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<span class="target" id="net-box-on-schema-reload"></span><dl class="function">
<dt>
<code class="descname">conn:on_schema_reload([trigger-function[, old-trigger-function]])</code></dt>
<dd><p>Define a trigger executed when some operation has been performed on the remote
server after schema has been updated. So, if a server request fails due to a
schema version mismatch error, schema reload is triggered.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>trigger-function</strong> (<em>function</em>) – function which will become the trigger
function. Takes the <code class="docutils literal notranslate"><span class="pre">conn</span></code>
object as the first argument</li>
<li><strong>old-trigger-function</strong> (<em>function</em>) – existing trigger function which will
be replaced by trigger-function</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">nil or function pointer</p>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>If the parameters are <code class="docutils literal notranslate"><span class="pre">(nil,</span> <span class="pre">old-trigger-function)</span></code>,
then the old trigger is deleted.</p>
<p>If both parameters are omitted, then the response is a list of
existing trigger functions.</p>
<p class="last">Details about trigger characteristics are in the
<a class="reference internal" href="../../book/box/triggers.html#triggers-box-triggers"><span class="std std-ref">triggers</span></a> section.</p>
</div>
</dd></dl>

</div>
<div class="section" id="example">
<h2>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h2>
<p>This example shows the use of most of the <code class="docutils literal notranslate"><span class="pre">net.box</span></code> methods.</p>
<p>The sandbox configuration for this example assumes that:</p>
<ul class="simple">
<li>the Tarantool instance is running on <code class="docutils literal notranslate"><span class="pre">localhost</span> <span class="pre">127.0.0.1:3301</span></code>,</li>
<li>there is a space named <code class="docutils literal notranslate"><span class="pre">tester</span></code> with a numeric primary key and with a tuple
that contains a key value = 800,</li>
<li>the current user has read, write and execute privileges.</li>
</ul>
<p>Here are commands for a quick sandbox setup:</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">box</span><span class="p">.</span><span class="n">cfg</span><span class="p">{</span><span class="n">listen</span> <span class="o">=</span> <span class="mi">3301</span><span class="p">}</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">box</span><span class="p">.</span><span class="n">schema</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="s1">&#39;tester&#39;</span><span class="p">)</span>
<span class="n">s</span><span class="p">:</span><span class="n">create_index</span><span class="p">(</span><span class="s1">&#39;primary&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nb">type</span> <span class="o">=</span> <span class="s1">&#39;hash&#39;</span><span class="p">,</span> <span class="n">parts</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;unsigned&#39;</span><span class="p">}})</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">s</span><span class="p">:</span><span class="n">insert</span><span class="p">({</span><span class="mi">800</span><span class="p">,</span> <span class="s1">&#39;TEST&#39;</span><span class="p">})</span>
<span class="n">box</span><span class="p">.</span><span class="n">schema</span><span class="p">.</span><span class="n">user</span><span class="p">.</span><span class="n">grant</span><span class="p">(</span><span class="s1">&#39;guest&#39;</span><span class="p">,</span> <span class="s1">&#39;read,write,execute&#39;</span><span class="p">,</span> <span class="s1">&#39;universe&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>And here starts the example:</p>
<div class="highlight-tarantoolsession notranslate"><div class="highlight"><pre><span></span>tarantool&gt; net_box = require(&#39;net.box&#39;)
---
...
tarantool&gt; function example()
         &gt;   local conn, wtuple
         &gt;   if net_box.self:ping() then
         &gt;     table.insert(ta, &#39;self:ping() succeeded&#39;)
         &gt;     table.insert(ta, &#39;  (no surprise -- self connection is pre-established)&#39;)
         &gt;   end
         &gt;   if box.cfg.listen == &#39;3301&#39; then
         &gt;     table.insert(ta,&#39;The local server listen address = 3301&#39;)
         &gt;   else
         &gt;     table.insert(ta, &#39;The local server listen address is not 3301&#39;)
         &gt;     table.insert(ta, &#39;(  (maybe box.cfg{...listen=&quot;3301&quot;...} was not stated)&#39;)
         &gt;     table.insert(ta, &#39;(  (so connect will fail)&#39;)
         &gt;   end
         &gt;   conn = net_box.connect(&#39;127.0.0.1:3301&#39;)
         &gt;   conn.space.tester:delete({800})
         &gt;   table.insert(ta, &#39;conn delete done on tester.&#39;)
         &gt;   conn.space.tester:insert({800, &#39;data&#39;})
         &gt;   table.insert(ta, &#39;conn insert done on tester, index 0&#39;)
         &gt;   table.insert(ta, &#39;  primary key value = 800.&#39;)
         &gt;   wtuple = conn.space.tester:select({800})
         &gt;   table.insert(ta, &#39;conn select done on tester, index 0&#39;)
         &gt;   table.insert(ta, &#39;  number of fields = &#39; .. #wtuple)
         &gt;   conn.space.tester:delete({800})
         &gt;   table.insert(ta, &#39;conn delete done on tester&#39;)
         &gt;   conn.space.tester:replace({800, &#39;New data&#39;, &#39;Extra data&#39;})
         &gt;   table.insert(ta, &#39;conn:replace done on tester&#39;)
         &gt;   conn.space.tester:update({800}, {{&#39;=&#39;, 2, &#39;Fld#1&#39;}})
         &gt;   table.insert(ta, &#39;conn update done on tester&#39;)
         &gt;   conn:close()
         &gt;   table.insert(ta, &#39;conn close done&#39;)
         &gt; end
---
...
tarantool&gt; ta = {}
---
...
tarantool&gt; example()
---
...
tarantool&gt; ta
---
- - self:ping() succeeded
  - &#39;  (no surprise -- self connection is pre-established)&#39;
  - The local server listen address = 3301
  - conn delete done on tester.
  - conn insert done on tester, index 0
  - &#39;  primary key value = 800.&#39;
  - conn select done on tester, index 0
  - &#39;  number of fields = 1&#39;
  - conn delete done on tester
  - conn:replace done on tester
  - conn update done on tester
  - conn close done
...
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Tarantool Core Team

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>