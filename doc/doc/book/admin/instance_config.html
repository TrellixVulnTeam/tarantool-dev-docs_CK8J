

<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Instance configuration &mdash; Tarantool Dev Docs  documentation</title>
  

  
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../../_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../index.html" class="icon icon-home" alt="Documentation Home"> Tarantool Dev Docs
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../dev_guide/index.html">Contributor’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/index.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../internals/source/index.html">Tarantool internals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../internals/source/index.html#indices-and-tables">Indices and tables</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">Tarantool Dev Docs</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Instance configuration</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../../_sources/doc/doc/book/admin/instance_config.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="instance-configuration">
<span id="admin-instance-config"></span><h1>Instance configuration<a class="headerlink" href="#instance-configuration" title="Permalink to this headline">¶</a></h1>
<p>For each Tarantool instance, you need two files:</p>
<ul>
<li><p class="first">[Optional] An <a class="reference internal" href="../app_server/launching_app.html#app-server-launching-app"><span class="std std-ref">application file</span></a> with
instance-specific logic. Put this file into the <code class="docutils literal notranslate"><span class="pre">/usr/share/tarantool/</span></code>
directory.</p>
<p>For example, <code class="docutils literal notranslate"><span class="pre">/usr/share/tarantool/my_app.lua</span></code> (here we implement it as a
<a class="reference internal" href="../app_server/creating_app.html#app-server-modules"><span class="std std-ref">Lua module</span></a> that bootstraps the database and
exports <code class="docutils literal notranslate"><span class="pre">start()</span></code> function for API calls):</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="kd">local</span> <span class="kr">function</span> <span class="nf">start</span><span class="p">()</span>
    <span class="n">box</span><span class="p">.</span><span class="n">schema</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="s2">&quot;somedata&quot;</span><span class="p">)</span>
    <span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">somedata</span><span class="p">:</span><span class="n">create_index</span><span class="p">(</span><span class="s2">&quot;primary&quot;</span><span class="p">)</span>
    <span class="o">&lt;</span><span class="p">...</span><span class="o">&gt;</span>
<span class="kr">end</span>

<span class="kr">return</span> <span class="p">{</span>
  <span class="n">start</span> <span class="o">=</span> <span class="n">start</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p class="first">An <a class="reference internal" href="#admin-instance-file"><span class="std std-ref">instance file</span></a> with
instance-specific initialization logic and parameters. Put this file, or a
symlink to it, into the <strong>instance directory</strong>
(see <a class="reference internal" href="#admin-instance-dir"><span class="std std-ref">instance_dir</span></a> parameter in <code class="docutils literal notranslate"><span class="pre">tarantoolctl</span></code>
configuration file).</p>
<p>For example, <code class="docutils literal notranslate"><span class="pre">/etc/tarantool/instances.enabled/my_app.lua</span></code> (here we load
<code class="docutils literal notranslate"><span class="pre">my_app.lua</span></code> module and make a call to <code class="docutils literal notranslate"><span class="pre">start()</span></code> function from that
module):</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="cp">#!/usr/bin/env tarantool</span>

<span class="n">box</span><span class="p">.</span><span class="n">cfg</span> <span class="p">{</span>
    <span class="n">listen</span> <span class="o">=</span> <span class="mi">3301</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">-- load my_app module and call start() function</span>
<span class="c1">-- with some app options controlled by sysadmins</span>
<span class="kd">local</span> <span class="n">m</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s1">&#39;my_app&#39;</span><span class="p">).</span><span class="n">start</span><span class="p">({...})</span>
</pre></div>
</div>
</li>
</ul>
<div class="section" id="instance-file">
<span id="admin-instance-file"></span><h2>Instance file<a class="headerlink" href="#instance-file" title="Permalink to this headline">¶</a></h2>
<p>After this short introduction, you may wonder what an instance file is, what it
is for, and how <code class="docutils literal notranslate"><span class="pre">tarantoolctl</span></code> uses it. After all, Tarantool is an application
server, so why not start the application stored in <code class="docutils literal notranslate"><span class="pre">/usr/share/tarantool</span></code>
directly?</p>
<p>A typical Tarantool application is not a script, but a daemon running in
background mode and processing requests, usually sent to it over a TCP/IP
socket. This daemon needs to be started automatically when the operating system
starts, and managed with the operating system standard tools for service
management – such as <code class="docutils literal notranslate"><span class="pre">systemd</span></code> or <code class="docutils literal notranslate"><span class="pre">init.d</span></code>. To serve this very purpose, we
created <strong>instance files</strong>.</p>
<p>You can have more than one instance file. For example, a single application in
<code class="docutils literal notranslate"><span class="pre">/usr/share/tarantool</span></code> can run in multiple instances, each of them having its
own instance file. Or you can have multiple applications in
<code class="docutils literal notranslate"><span class="pre">/usr/share/tarantool</span></code> – again, each of them having its own instance file.</p>
<p>An instance file is typically created by a system administrator. An application
file is often provided by a developer, in a Lua rock or an rpm/deb package.</p>
<p>An instance file is designed to not differ in any way from a Lua application.
It must, however, configure the database, i.e. contain a call to
<a class="reference internal" href="../../reference/reference_lua/box_introspection.html#box-introspection-box-cfg"><span class="std std-ref">box.cfg{}</span></a> somewhere in it, because it’s the
only way to turn a Tarantool script into a background process, and
<code class="docutils literal notranslate"><span class="pre">tarantoolctl</span></code> is a tool to manage background processes. Other than that, an
instance file may contain arbitrary Lua code, and, in theory, even include the
entire application business logic in it. We, however, do not recommend this,
since it clutters the instance file and leads to unnecessary copy-paste when
you need to run multiple instances of an application.</p>
</div>
<div class="section" id="tarantoolctl-configuration-file">
<span id="admin-tarantoolctl-config-file"></span><h2><cite>tarantoolctl</cite> configuration file<a class="headerlink" href="#tarantoolctl-configuration-file" title="Permalink to this headline">¶</a></h2>
<p>While instance files contain instance configuration, the <code class="docutils literal notranslate"><span class="pre">tarantoolctl</span></code>
configuration file contains the configuration that <code class="docutils literal notranslate"><span class="pre">tarantoolctl</span></code> uses to
override instance configuration. In other words, it contains system-wide
configuration defaults. If <code class="docutils literal notranslate"><span class="pre">tarantoolctl</span></code> fails to find this file with
the method described in section
<a class="reference internal" href="start_stop_instance.html#admin-start-stop-instance"><span class="std std-ref">Starting/stopping an instance</span></a>, it uses
default settings.</p>
<p>Most of the parameters are similar to those used by
<a class="reference internal" href="../../reference/reference_lua/box_introspection.html#box-introspection-box-cfg"><span class="std std-ref">box.cfg{}</span></a>. Here are the default settings
(possibly installed in <code class="docutils literal notranslate"><span class="pre">/etc/default/tarantool</span></code> or <code class="docutils literal notranslate"><span class="pre">/etc/sysconfig/tarantool</span></code>
as part of Tarantool distribution – see OS-specific default paths in
<a class="reference internal" href="os_notes.html#admin-os-notes"><span class="std std-ref">Notes for operating systems</span></a>):</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">default_cfg</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">pid_file</span>  <span class="o">=</span> <span class="s2">&quot;/var/run/tarantool&quot;</span><span class="p">,</span>
    <span class="n">wal_dir</span>   <span class="o">=</span> <span class="s2">&quot;/var/lib/tarantool&quot;</span><span class="p">,</span>
    <span class="n">memtx_dir</span> <span class="o">=</span> <span class="s2">&quot;/var/lib/tarantool&quot;</span><span class="p">,</span>
    <span class="n">vinyl_dir</span> <span class="o">=</span> <span class="s2">&quot;/var/lib/tarantool&quot;</span><span class="p">,</span>
    <span class="n">log</span>       <span class="o">=</span> <span class="s2">&quot;/var/log/tarantool&quot;</span><span class="p">,</span>
    <span class="n">username</span>  <span class="o">=</span> <span class="s2">&quot;tarantool&quot;</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">instance_dir</span> <span class="o">=</span> <span class="s2">&quot;/etc/tarantool/instances.enabled&quot;</span>
</pre></div>
</div>
<p>where:</p>
<ul>
<li><div class="first line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">pid_file</span></code></div>
<div class="line">Directory for the pid file and control-socket file; <code class="docutils literal notranslate"><span class="pre">tarantoolctl</span></code> will
add “/instance_name” to the directory name.</div>
</div>
</li>
<li><div class="first line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">wal_dir</span></code></div>
<div class="line">Directory for write-ahead .xlog files; <code class="docutils literal notranslate"><span class="pre">tarantoolctl</span></code> will add
“/instance_name” to the directory name.</div>
</div>
</li>
<li><div class="first line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">memtx_dir</span></code></div>
<div class="line">Directory for snapshot .snap files; <code class="docutils literal notranslate"><span class="pre">tarantoolctl</span></code> will add
“/instance_name” to the directory name.</div>
</div>
</li>
<li><div class="first line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">vinyl_dir</span></code></div>
<div class="line">Directory for vinyl files; <code class="docutils literal notranslate"><span class="pre">tarantoolctl</span></code> will add “/instance_name” to the
directory name.</div>
</div>
</li>
<li><div class="first line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">log</span></code></div>
<div class="line">The place where the application log will go; <code class="docutils literal notranslate"><span class="pre">tarantoolctl</span></code> will add
“/instance_name.log” to the name.</div>
</div>
</li>
<li><div class="first line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">username</span></code></div>
<div class="line">The user that runs the Tarantool instance. This is the operating-system user
name rather than the Tarantool-client user name. Tarantool will change its
effective user to this user after becoming a daemon.</div>
</div>
</li>
</ul>
<ul id="admin-instance-dir">
<li><div class="first line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">instance_dir</span></code></div>
<div class="line">The directory where all instance files for this host are stored. Put
instance files in this directory, or create symbolic links.</div>
</div>
<p>The default instance directory depends on Tarantool’s <code class="docutils literal notranslate"><span class="pre">WITH_SYSVINIT</span></code>
build option: when ON, it is <code class="docutils literal notranslate"><span class="pre">/etc/tarantool/instances.enabled</span></code>,
otherwise (OFF or not set) it is <code class="docutils literal notranslate"><span class="pre">/etc/tarantool/instances.available</span></code>.
The latter case is typical for Tarantool builds for Linux distros with
<code class="docutils literal notranslate"><span class="pre">systemd</span></code>.</p>
<p>To check the build options, say <code class="docutils literal notranslate"><span class="pre">tarantool</span> <span class="pre">--version</span></code>.</p>
</li>
</ul>
<p>As a full-featured example, you can take
<a class="reference external" href="https://github.com/tarantool/tarantool/blob/1.10/extra/dist/example.lua">example.lua</a>
script that ships with Tarantool and defines all configuration options.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Tarantool Core Team

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>