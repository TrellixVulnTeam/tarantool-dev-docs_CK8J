

<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Launching an application &mdash; Tarantool Dev Docs  documentation</title>
  

  
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../../_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../index.html" class="icon icon-home" alt="Documentation Home"> Tarantool Dev Docs
          

          
            
            <img src="../../../../_static/logo_white_text.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../dev_guide/index.html">Contributor’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/index.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../internals/source/index.html">Tarantool internals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../internals/source/index.html#indices-and-tables">Indices and tables</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">Tarantool Dev Docs</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Launching an application</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../../_sources/doc/doc/book/app_server/launching_app.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="launching-an-application">
<span id="app-server-launching-app"></span><h1>Launching an application<a class="headerlink" href="#launching-an-application" title="Permalink to this headline">¶</a></h1>
<p>Using Tarantool as an application server, you can write your own applications.
Tarantool’s native language for writing applications is
<a class="reference external" href="http://www.lua.org/about.html">Lua</a>, so a typical application would be
a file that contains your Lua script. But you can also write applications
in C or C++.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>If you’re new to Lua, we recommend going over the interactive Tarantool
tutorial before proceeding with this chapter. To launch the tutorial, say
<code class="docutils literal notranslate"><span class="pre">tutorial()</span></code> in Tarantool console:</p>
<div class="last highlight-tarantoolsession notranslate"><div class="highlight"><pre><span></span>tarantool&gt; tutorial()
---
- |
 Tutorial -- Screen #1 -- Hello, Moon
 ====================================

 Welcome to the Tarantool tutorial.
 It will introduce you to Tarantool’s Lua application server
 and database server, which is what’s running what you’re seeing.
 This is INTERACTIVE -- you’re expected to enter requests
 based on the suggestions or examples in the screen’s text.
 &lt;...&gt;
</pre></div>
</div>
</div>
<p>Let’s create and launch our first Lua application for Tarantool.
Here’s a simplest Lua application, the good old “Hello, world!”:</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="cp">#!/usr/bin/env tarantool</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Hello, world!&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>We save it in a file. Let it be <code class="docutils literal notranslate"><span class="pre">myapp.lua</span></code> in the current directory.</p>
<p>Now let’s discuss how we can launch our application with Tarantool.</p>
<div class="section" id="launching-in-docker">
<span id="app-server-launching-app-docker"></span><h2>Launching in Docker<a class="headerlink" href="#launching-in-docker" title="Permalink to this headline">¶</a></h2>
<p>If we run Tarantool in a <a class="reference internal" href="../../getting_started/using_docker.html#getting-started-using-docker"><span class="std std-ref">Docker container</span></a>,
the following command will start Tarantool without any application:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="c1"># create a temporary container and run it in interactive mode</span>
<span class="gp">$</span> docker run --rm -t -i tarantool/tarantool:1
</pre></div>
</div>
<p>To run Tarantool with our application, we can say:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="c1"># create a temporary container and</span>
<span class="gp">$</span> <span class="c1"># launch Tarantool with our application</span>
<span class="gp">$</span> docker run --rm -t -i <span class="se">\</span>
             -v <span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>/myapp.lua:/opt/tarantool/myapp.lua <span class="se">\</span>
             -v /data/dir/on/host:/var/lib/tarantool <span class="se">\</span>
             tarantool/tarantool:1 tarantool /opt/tarantool/myapp.lua
</pre></div>
</div>
<p>Here two resources on the host get mounted in the container:</p>
<ul class="simple">
<li>our application file (myapp.lua) and</li>
<li>Tarantool data directory (<code class="docutils literal notranslate"><span class="pre">/data/dir/on/host</span></code>).</li>
</ul>
<p>By convention, the directory for Tarantool application code inside a container
is <code class="docutils literal notranslate"><span class="pre">/opt/tarantool</span></code>, and the directory for data is <code class="docutils literal notranslate"><span class="pre">/var/lib/tarantool</span></code>.</p>
</div>
<div class="section" id="launching-a-binary-program">
<span id="app-server-launching-app-binary"></span><h2>Launching a binary program<a class="headerlink" href="#launching-a-binary-program" title="Permalink to this headline">¶</a></h2>
<p>If we run Tarantool from a <a class="reference internal" href="../../getting_started/using_binary.html#getting-started-using-binary"><span class="std std-ref">binary package</span></a>
or from a <a class="reference internal" href="../../dev_guide/building_from_source.html#building-from-source"><span class="std std-ref">source build</span></a>, we can launch our
application:</p>
<ul class="simple">
<li>in the script mode,</li>
<li>as a server application, or</li>
<li>as a daemon service.</li>
</ul>
<p>The simplest way is to pass the filename to Tarantool at start:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> tarantool myapp.lua
<span class="go">Hello, world!</span>
<span class="gp">$</span>
</pre></div>
</div>
<p>Tarantool starts, executes our script in the <strong>script mode</strong> and exits.</p>
<p>Now let’s turn this script into a <strong>server application</strong>. We use
<a class="reference internal" href="../../reference/reference_lua/box_introspection.html#box-introspection-box-cfg"><span class="std std-ref">box.cfg</span></a> from Tarantool’s built-in
Lua module to:</p>
<ul class="simple">
<li>launch the database (a database has a persistent on-disk state, which needs
to be restored after we start an application) and</li>
<li>configure Tarantool as a server that accepts requests over a TCP port.</li>
</ul>
<p>We also add some simple database logic, using
<a class="reference internal" href="../../reference/reference_lua/box_schema.html#box-schema-space-create"><span class="std std-ref">space.create()</span></a> and
<a class="reference internal" href="../../reference/reference_lua/box_space_index.html#box-space-create-index"><span class="std std-ref">create_index()</span></a> to create a space with a primary
index. We use the function <a class="reference internal" href="../../reference/reference_lua/box_once.html#box-once"><span class="std std-ref">box.once()</span></a> to make sure that our
logic will be executed only once when the database is initialized for the first
time, so we don’t try to create an existing space or index on each invocation
of the script:</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="cp">#!/usr/bin/env tarantool</span>
<span class="c1">-- Configure database</span>
<span class="n">box</span><span class="p">.</span><span class="n">cfg</span> <span class="p">{</span>
   <span class="n">listen</span> <span class="o">=</span> <span class="mi">3301</span>
<span class="p">}</span>
<span class="n">box</span><span class="p">.</span><span class="n">once</span><span class="p">(</span><span class="s2">&quot;bootstrap&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>
   <span class="n">box</span><span class="p">.</span><span class="n">schema</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="s1">&#39;tweedledum&#39;</span><span class="p">)</span>
   <span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tweedledum</span><span class="p">:</span><span class="n">create_index</span><span class="p">(</span><span class="s1">&#39;primary&#39;</span><span class="p">,</span>
       <span class="p">{</span> <span class="nb">type</span> <span class="o">=</span> <span class="s1">&#39;TREE&#39;</span><span class="p">,</span> <span class="n">parts</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;unsigned&#39;</span><span class="p">}})</span>
<span class="kr">end</span><span class="p">)</span>
</pre></div>
</div>
<p>Now we launch our application in the same manner as before:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> tarantool myapp.lua
<span class="go">Hello, world!</span>
<span class="go">2016-12-19 16:07:14.250 [41436] main/101/myapp.lua C&gt; version 1.7.2-146-g021d36b</span>
<span class="go">2016-12-19 16:07:14.250 [41436] main/101/myapp.lua C&gt; log level 5</span>
<span class="go">2016-12-19 16:07:14.251 [41436] main/101/myapp.lua I&gt; mapping 1073741824 bytes for tuple arena...</span>
<span class="go">2016-12-19 16:07:14.255 [41436] main/101/myapp.lua I&gt; recovery start</span>
<span class="go">2016-12-19 16:07:14.255 [41436] main/101/myapp.lua I&gt; recovering from `./00000000000000000000.snap&#39;</span>
<span class="go">2016-12-19 16:07:14.271 [41436] main/101/myapp.lua I&gt; recover from `./00000000000000000000.xlog&#39;</span>
<span class="go">2016-12-19 16:07:14.271 [41436] main/101/myapp.lua I&gt; done `./00000000000000000000.xlog&#39;</span>
<span class="go">2016-12-19 16:07:14.272 [41436] main/102/hot_standby I&gt; recover from `./00000000000000000000.xlog&#39;</span>
<span class="go">2016-12-19 16:07:14.274 [41436] iproto/102/iproto I&gt; binary: started</span>
<span class="go">2016-12-19 16:07:14.275 [41436] iproto/102/iproto I&gt; binary: bound to [::]:3301</span>
<span class="go">2016-12-19 16:07:14.275 [41436] main/101/myapp.lua I&gt; done `./00000000000000000000.xlog&#39;</span>
<span class="go">2016-12-19 16:07:14.278 [41436] main/101/myapp.lua I&gt; ready to accept requests</span>
</pre></div>
</div>
<p>This time, Tarantool executes our script and keeps working as a server,
accepting TCP requests on port 3301. We can see Tarantool in the current
session’s process list:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> ps <span class="p">|</span> grep <span class="s2">&quot;tarantool&quot;</span>
<span class="go">  PID TTY           TIME CMD</span>
<span class="go">41608 ttys001       0:00.47 tarantool myapp.lua &lt;running&gt;</span>
</pre></div>
</div>
<p>But the Tarantool instance will stop if we close the current terminal window.
To detach Tarantool and our application from the terminal window, we can launch
it in the <strong>daemon mode</strong>. To do so, we add some parameters to <code class="docutils literal notranslate"><span class="pre">box.cfg{}</span></code>:</p>
<ul class="simple">
<li><a class="reference internal" href="../../reference/configuration/index.html#cfg-basic-background"><span class="std std-ref">background</span></a> = <code class="docutils literal notranslate"><span class="pre">true</span></code> that actually tells
Tarantool to work as a daemon service,</li>
<li><a class="reference internal" href="../../reference/configuration/index.html#cfg-logging-log"><span class="std std-ref">log</span></a> = <code class="docutils literal notranslate"><span class="pre">'dir-name'</span></code> that tells the Tarantool
daemon where to store its log file (other log settings are available in
Tarantool <a class="reference internal" href="../../reference/reference_lua/log.html#log-module"><span class="std std-ref">log</span></a> module), and</li>
<li><a class="reference internal" href="../../reference/configuration/index.html#cfg-basic-pid-file"><span class="std std-ref">pid_file</span></a> = <code class="docutils literal notranslate"><span class="pre">'file-name'</span></code> that tells the
Tarantool daemon where to store its pid file.</li>
</ul>
<p>For example:</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">box</span><span class="p">.</span><span class="n">cfg</span> <span class="p">{</span>
   <span class="n">listen</span> <span class="o">=</span> <span class="mi">3301</span><span class="p">,</span>
   <span class="n">background</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>
   <span class="n">log</span> <span class="o">=</span> <span class="s1">&#39;1.log&#39;</span><span class="p">,</span>
   <span class="n">pid_file</span> <span class="o">=</span> <span class="s1">&#39;1.pid&#39;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>We launch our application in the same manner as before:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> tarantool myapp.lua
<span class="go">Hello, world!</span>
<span class="gp">$</span>
</pre></div>
</div>
<p>Tarantool executes our script, gets detached from the current shell session
(you won’t see it with <code class="docutils literal notranslate"><span class="pre">ps</span> <span class="pre">|</span> <span class="pre">grep</span> <span class="pre">&quot;tarantool&quot;</span></code>) and continues working in the
background as a daemon attached to the global session (with SID = 0):</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> ps -ef <span class="p">|</span> grep <span class="s2">&quot;tarantool&quot;</span>
<span class="go">  PID SID     TIME  CMD</span>
<span class="go">42178   0  0:00.72 tarantool myapp.lua &lt;running&gt;</span>
</pre></div>
</div>
<p>Now that we have discussed how to create and launch a Lua application for
Tarantool, let’s dive deeper into programming practices.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Tarantool Core Team

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>